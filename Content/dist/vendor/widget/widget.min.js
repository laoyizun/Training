define("widget/ball",["jquery"],function(t){var e=function(e,i){this.$container=e.css("position","relative"),this.options=t.extend(!0,{data:[],color:["#FF6F5C","#6FC5FE","#38DEBA"]},i),this.area={left:0,top:0,right:e.outerWidth(),bottom:e.outerHeight()},this.init()};return e.prototype.init=function(){0!=this.options.data.length&&(this.create(),this.watch())},e.prototype.watch=function(){},e.prototype.create=function(){for(var e,i=[],o=0;o<this.options.data.length;o++)e=this.options.data[o],i.push('<div class="w-ball-wrap">'),i.push('<div class="w-ball red">'),i.push('<span class="w-ball-title">'+e.text+"</span>"),i.push("</div>"),i.push("</div>");this.$balls=t(i.join("")),this.$container.append(this.$balls)},function(t,i){return new e(t,i)}}),define("widget/cross",["jquery","KM","XD","widget/popWin","lodash"],function(t,e,i,o,n){var a=!1,s={setIframeHeight:function(e){var i=e.hash?e.hash.replace("#",""):"",o=t("#iframe_"+i);return 0!=o.length?void o.css("height",e.height):(o=t("iframe"),void o.each(function(){if(this.src==e.url)return t(this).css("height",e.height),!1}))},getPageHeight:function(t){var e=t.body.clientHeight,i=t.body.scrollHeight,o=(t.documentElement.scrollHeight,Math.max(e,i));return o},openWin:function(t){o.setIsCross(),o.open(t)},openForm:function(t){refreshUrl=t.refreshUrl,o.setIsCross(),o.openForm(t)},closeWin:function(e){if(o.close(!0),refreshUrl){var i=refreshUrl.substr(refreshUrl.indexOf("#")+1,refreshUrl.length-refreshUrl.indexOf("#")),n=t("#iframe_"+i);if(n.length!=-1){var a=n.attr("data-url");n.attr("src","about:blank"),setTimeout(function(){n.attr("src",a)},100)}refreshUrl=null}"function"==typeof l.callback.onCloseWin&&l.callback.onCloseWin()},isCross:function(e){var o=(e.url,e.hash);o&&(o=o.replace("#",""));var n=t("#iframe_"+o);0!=n.length&&i.sendMessage(n[0].contentWindow,{isCross:a})}},l={};return l.setIframeHeight=function(t){t=t||s.getPageHeight(document);try{!function(e){var i=e.window.$("iframe[data-url="+location.href+"]");i.css("height",t)}(parent)}catch(e){i.sendMessage(parent,{type:"setIframeHeight",url:location.href,hash:location.hash,height:t})}},l.openWin=function(t){t=t||{},t.type="openWin",i.sendMessage(parent,t)},l.openForm=function(t){t=t||{},t.type="openForm",i.sendMessage(parent,t)},l.closeWin=function(t){t=t||{},t.type="closeWin",i.sendMessage(parent,t)},l.listener=function(){a=!0,i.receiveMessage(function(t){t.type&&s[t.type]&&s[t.type](t)})},l.callback={onCloseWin:t.noop},l}),define("widget/form",["jquery","KM","widget/popForm","widget/popSelect","widget/multipleAutocomplete","ueditor"],function(t,e,i,o,n){return function(a,s){if(a&&0!=a.length){var s=t.extend(!0,{ueditor:{initialFrameWidth:"100%",initialFrameHeight:200},validate:{showSingleError:!0},ajaxConfig:{returnUrl:{enable:!0,url:location.href},redirectEnable:!0,loadingEnable:!0,popTips:{enable:!0,delay:600,inCallback:!0},callback:{beforeSubmit:t.noop,done:t.noop,fail:t.noop,always:t.noop},ajaxConfig:{traditional:!0}}},s),l=[],r=!1,c=new e.ValidateTooltips(a,s.validate);return e.DatePicker.Global(a.find("input[data-module=datepicker]")),e.DropDownTree.Global(a.find("input[data-module=dropdowntree]")),e.Upload.Global(a.find("input[data-module=upload],button[data-module=upload]")),e.DropDownList.Global(a.find("[data-module=dropdownlist]")),e.autoComplete(a.find("[data-module=autocomplete]")),n.Global(a.find("input[data-module=multipleautocomplete]")),i(a.find("[data-module=popform]")),o(a.find("[data-module=popselect]")),a.find("textarea[data-module=ueditor]").each(function(){var e=this,i=UE.getEditor(this.id,s.ueditor);i.addListener("blur",function(){i.sync(),c.validate({target:e,type:"focusout"})}),i.addListener("focus",function(){i.sync(),c.hideError(t(e))}),i.addListener("ready",function(){t(this.container).parent().removeClass("k-input k-form-control")}),l.push(i)}),a.on("submit",function(){if(r)return!1;r=!0;for(var t=0;t<l.length;t++)l[t].sync();return 0!=s.ajaxConfig.callback.beforeSubmit()&&(e.ajax.ajaxForm(a,s.ajaxConfig).done(function(t){s.ajaxConfig.callback.done(t)}).fail(function(){s.ajaxConfig.callback.fail()}).always(function(){s.ajaxConfig.callback.always(),r=!1}),!1)}).on("keyup",function(t){if(13==t.keyCode)return!1}),{validate:c,ueditors:l}}}}),define("widget/grid",["jquery","KM","lodash","widget/popForm","easyui"],function($,KM,_,popForm){function selectChildren(t,e,i,o,n){n&&o&&t.treegrid("expand",e);for(var a=t.treegrid("getChildren",e),s=0;s<a.length;s++){var l=a[s][i];n?t.treegrid("select",l):t.treegrid("unselect",l),selectChildren(t,l,i,o,n)}}function Grid(t,e){var i=this;this.$elm=t,this.options=$.extend(!0,{isTree:!1,addUrl:null,setStatusUrl:null,saveUrl:null,winWidth:800,winHeight:480,autoFull:!0,toolbarExt:{type:"default",callback:{add:function(t,e){method._add.call(i,t,e)},remove:function(){method._setStatus.call(i,"Deleted")},enabled:function(){method._setStatus.call(i,"Enabled")},disabled:function(){method._setStatus.call(i,"Disabled")},edit:function(){method._edit.call(i)},save:function(){method._save.call(i)},cancel:function(){method._cancel.call(i)},setStatus:function(t){method._setStatus.call(i,t)}},appendToolbar:[]},buttonSetting:{add:{id:"idAdd",text:"增加",iconCls:"glyphicon glyphicon-plus"},remove:{id:"idDelete",text:"删除",iconCls:"glyphicon glyphicon-minus"},enable:{id:"idEnable",text:"可用",iconCls:"glyphicon glyphicon-ok"},disable:{id:"idDisable",text:"禁用",iconCls:"glyphicon glyphicon-remove"},edit:{id:"idEdit",text:"编辑",iconCls:"glyphicon glyphicon-pencil"},save:{id:"idSave",text:"保存",iconCls:"glyphicon glyphicon-floppy-disk"},cancel:{id:"idCancle",text:"取消编辑",iconCls:"glyphicon glyphicon-floppy-remove"}},columnsExt:{formatter:{}},searchParams:$.noop,callback:{load:$.noop,submit:$.noop,refresh:$.noop,search:$.noop},easyuiSettings:{treeField:"",method:"POST",gridId:"dataGrid",url:null,loadMsg:"正在加载，请稍候...",width:"auto",height:"auto",idField:"Id",toolbar:[],columns:[[]],rownumbers:!0,singleSelect:!1,cascadeCheck:!0,fitColumns:!0,pagination:!0,pageSize:20,pageList:[20,40,60,80],beforePageText:"第",afterPageText:"页    共 {pages} 页",displayMsg:"当前显示 {from} 到 {to} 条记录， 共 {total} 条记录"}},e),this.options.easyuiSettings.autoFull=this.options.autoFull,this.isLoading=!1,this.$container=this.$elm.parent(),this.tm=null,this.init()}try{"undefined"!=typeof top.KM?KM=top.KM:"undefined"!=typeof parent.KM&&(KM=parent.KM)}catch(e){try{KM=parent.KM||KM}catch(e){}}$.extend($.fn.treegrid.defaults,{onLoadSuccess:function(){var t=$(this),e=$.data(this,"treegrid").options,i=$(this).treegrid("getPanel"),o=i.find("div.datagrid-body"),n=e.idField,a=i.children("div.datagrid-pager");t.parent();o.find("div.datagrid-cell-check input[type=checkbox]").unbind(".treegrid").click(function(i){if(!e.singleSelect&&(e.cascadeCheck||e.deepCascadeCheck)){var o=$(this).parent().parent().parent().attr("node-id");selectChildren(t,o,n,e.deepCascadeCheck,$(this).prop("checked"))}});var s=$(this).treegrid("getData");if(0==s.length){var l="text-align:center;line-height:35px;height:35px;font-size:14px;color:red;width:100px;";l+=e.autoFull?"position:absolute;top:50%;left:50%;margin-top:-17.5px;margin-left:-50px;":"margin:30px auto;",$('<div class="datagrid-empty" style="'+l+'"></div>').html(e.emptyMsg||"暂无相关记录").insertBefore(a)}e.callback.load(),setTimeout(function(){$(window).resize()},100)}}),$.extend($.fn.datagrid.defaults,{onLoadSuccess:function(t){var e=$(this),i=e.datagrid("options"),o=e.datagrid("getPanel"),n=o.children("div.datagrid-pager"),a=(e.parent(),t.rows);if($.each(a,function(t,i){i.IsChecked&&e.datagrid("selectRow",t)}),o.children("div.datagrid-empty").remove(),"0"==t.total){var s="text-align:center;line-height:35px;height:35px;font-size:14px;color:red;width:100px;";s+=i.autoFull?"position:absolute;top:50%;left:50%;margin-top:-17.5px;margin-left:-50px;":"margin:30px auto;",$('<div class="datagrid-empty" style="'+s+'"></div>').html(i.emptyMsg||"暂无相关记录").insertBefore(n)}else i.callback.load();var l=e.prev().find("table.datagrid-btable");l.off("click.gridSelectRow").on("click.gridSelectRow","tbody tr",function(t){var o=$(t.target),n=$(this),a=n.siblings(".datagrid-row-selected");"checkbox"==t.target.type&&0==o.parent().index()||a.length>0&&i.rowClickUnSelectAll&&a.each(function(){var t=$(this).index();e.datagrid("unselectRow",t)})}),setTimeout(function(){$(window).resize()},100)}});var method={_getColumns:function(){var columns=[],$th=this.$elm.find("th"),totalWidth=this.$elm.parent().width(),hasCheckbox=!1,self=this;return this.options.easyuiSettings.column&&this.options.easyuiSettings.column.length>0?this.options.easyuiSettings.column:(totalWidth=this.options.easyuiSettings.rownumbers?totalWidth-=30:totalWidth,$th.each(function(){var $me=$(this),field=eval("(0,"+$me.attr("data-field")+")"),fixWidth=function(t){if(t=String(t),t.indexOf("%")==-1)return parseInt(t);var e=t.substr(0,t.indexOf("%"));return parseInt(e)/100*totalWidth};!field.formatter&&self.options.columnsExt.formatter[field.field]&&(field.formatter=self.options.columnsExt.formatter[field.field]),field.checkbox&&!hasCheckbox&&(totalWidth-=27,hasCheckbox=!0),field.title=field.title||$me.text(),field.width&&(field.width=fixWidth(field.width)),columns.push(field)}),[columns])},_getToolbar:function(){var t=[],e=this.options,i=this;if(this.options.easyuiSettings.toolbar&&this.options.easyuiSettings.toolbar.length>0)return this.options.easyuiSettings.toolbar;if("none"!=this.options.toolbarExt.type&&(t.push({id:e.buttonSetting.add.id,text:e.buttonSetting.add.text,iconCls:e.buttonSetting.add.iconCls,plain:"true",handler:function(){i.options.toolbarExt.callback.add.call(i)}}),t.push({id:e.buttonSetting.remove.id,text:e.buttonSetting.remove.text,iconCls:e.buttonSetting.remove.iconCls,handler:function(){i.options.toolbarExt.callback.remove.call(i,"remove")}}),t.push("-"),t.push({id:e.buttonSetting.enable.id,text:e.buttonSetting.enable.text,iconCls:e.buttonSetting.enable.iconCls,handler:function(){i.options.toolbarExt.callback.enabled.call(i)}}),t.push({id:e.buttonSetting.disable.id,text:e.buttonSetting.disable.text,iconCls:e.buttonSetting.disable.iconCls,handler:function(){i.options.toolbarExt.callback.disabled.call(i)}}),t.push("-")),"simple"==this.options.toolbarExt.type&&(t=[],t.push({id:e.buttonSetting.add.id,text:e.buttonSetting.add.text,iconCls:e.buttonSetting.add.iconCls,plain:"true",handler:function(){i.options.toolbarExt.callback.add.call(i)}}),t.push({id:e.buttonSetting.remove.id,text:e.buttonSetting.remove.text,iconCls:e.buttonSetting.remove.iconCls,handler:function(){i.options.toolbarExt.callback.remove.call(i,"remove")}})),"full"==this.options.toolbarExt.type&&(t.push({id:e.buttonSetting.edit.id,text:e.buttonSetting.edit.text,iconCls:e.buttonSetting.edit.iconCls,handler:function(){i.options.toolbarExt.callback.edit.call(i)}}),t.push("-"),t.push({id:e.buttonSetting.save.id,text:e.buttonSetting.save.text,iconCls:e.buttonSetting.save.iconCls,disabled:!0,handler:function(){i.options.toolbarExt.callback.save.call(i)}}),t.push({id:e.buttonSetting.cancel.id,text:e.buttonSetting.cancel.text,iconCls:e.buttonSetting.cancel.iconCls,disabled:!0,handler:function(){i.options.toolbarExt.callback.cancel.call(i)}}),t.push("-")),this.options.toolbarExt.appendToolbar.length>0)for(var o=0;o<this.options.toolbarExt.appendToolbar.length;o++)t.push(this.options.toolbarExt.appendToolbar[o]);return t},_add:function(t,e){var i={title:"新增",url:this.options.addUrl,width:this.options.winWidth,height:this.options.winHeight};t&&("object"==typeof t?i=$.extend({},i,t):i.url=t),this.win.options.url=i.url,e&&(i.btns=e),i.btns&&this.win.setBtns(i.btns),i.callback&&i.callback.onClose?this.win.on("close",function(){return i.callback.onClose.call(this,$el)}):this.win.on("close",function(){return!0}),this.win.setSize({width:i.width,height:i.height}),this.win.setTitle(i.title),this.win.options.showFooter=!0,this.win.$footer.show(),this.win.open()},_setStatus:function(t){var e=this,i=this.options.isTree?this.$grid.treegrid("getSelections"):this.$grid.datagrid("getSelections"),o=[];if(0==i.length)return void KM.popTips.error("请选择操作的行",600);if(!this.isLoading){this.isLoading=!0,_.forEach(i,function(t){o.push(t[e.options.easyuiSettings.idField])});var n=function(){KM.ajax.post(e.options.setStatusUrl,{status:t,ids:o.join(",")},{popTips:{inCallback:!1}}).done(function(t){t.Status&&e.refresh()}).always(function(){e.isLoading=!1})};"deleted"==t.toLowerCase()?KM.Window.confirm("您确认要执行删除操作吗?",function(){n()},function(){e.isLoading=!1}):n()}},_edit:function(){var t=this,e=this.options.isTree?this.$grid.treegrid("getSelections"):this.$grid.datagrid("getSelections"),i=this.options.easyuiSettings.idField;return 0==e.length?void KM.popTips.error("请选择操作的行",600):(this.editFields=[],_.forEach(e,function(e,o){t.options.isTree?(t.$grid.treegrid("beginEdit",e[i]),t.editFields.push(e[i])):(t.$grid.datagrid("beginEdit",e.rowIndex),t.editFields.push(e.rowIndex))}),void this.$container.find("#idEdit").linkbutton("disable").end().find("#idSave,#idCancle").linkbutton("enable"))},_save:function(){var t,e,i=this;this.options.easyuiSettings.idField;this.$container.find("#idEdit").linkbutton("enable").end().find("#idSave,#idCancle").linkbutton("disable"),_.forEach(this.editFields,function(t){i.options.isTree?i.$grid.treegrid("endEdit",t):i.$grid.datagrid("endEdit",t)}),this.options.isTree?(t=this.$grid.treegrid("getChanges"),e=this.$grid.treegrid("getColumnFields")):(t=this.$grid.datagrid("getChanges"),e=this.$grid.datagrid("getColumnFields")),0!=t.length&&(this.isLoading||(this.isLoading=!0,KM.ajax.post(this.options.saveUrl,{listJsonStr:JSON.stringify(t)},{popTips:{inCallback:!1}}).done(function(t){t.Status&&i.refresh()}).always(function(){i.isLoading=!1})))},_cancel:function(){var t=this;this.$container.find("#idEdit").linkbutton("enable").end().find("#idSave,#idCancle").linkbutton("disable"),_.forEach(this.editFields,function(e){t.options.isTree?t.$grid.treegrid("cancelEdit",e):t.$grid.datagrid("cancelEdit",e)})}};return Grid.prototype.init=function(){var t=this,e=method._getColumns.call(this),i=method._getToolbar.call(this);this.options.easyuiSettings.columns=e,this.options.easyuiSettings.toolbar=i,this.options.easyuiSettings.callback=this.options.callback,this.defaultMethod={add:function(e,i){method._add.call(t,e,i)},remove:function(){method._setStatus.call(t,"Deleted")},enabled:function(){method._setStatus.call(t,"Enabled")},disabled:function(){method._setStatus.call(t,"Disabled")},setStatus:function(e){method._setStatus.call(t,e)},edit:function(){method._edit.call(t)},save:function(){method._save.call(t)},cancel:function(){method._cancel.call(t)}},this.options.isTree?this.$grid=this.$elm.treegrid(this.options.easyuiSettings):this.$grid=this.$elm.datagrid(this.options.easyuiSettings);var o=this.$grid.datagrid("getPager");o&&$(o).pagination({pageSize:this.options.easyuiSettings.pageSize,pageList:this.options.easyuiSettings.pageList,beforePageText:this.options.easyuiSettings.beforePageText,afterPageText:this.options.easyuiSettings.afterPageText,displayMsg:this.options.easyuiSettings.displayMsg}),this.win=new KM.Window({title:"添加",url:this.options.addUrl,width:this.options.winWidth,height:this.options.winHeight,iframe:!0}),this.watch()},Grid.prototype.watch=function(){var self=this;this.$container.off("click.grid").on("click.grid","a[data-module=popform]",function(){var $el=$(this),options=$.data(this,"popFormOptions");options||(options=$el.attr("data-options"),options=eval("(0,"+options+")"),$.data(this,"popFormOptions",options)),self.win.options.url=options.url,self.win.setSize({width:options.width||self.options.winWidth,height:options.height||self.options.winHeight}),self.win.setBtns(options.btns),self.win.setTitle(options.title||"模态窗口"),0==options.showFooter?(self.win.options.showFooter=!1,self.win.$footer.hide()):(self.win.options.showFooter=!0,self.win.$footer.show()),options.callback&&options.callback.onClose?self.win.on("close",function(){return options.callback.onClose.call(this,$el)}):self.win.on("close",function(){return!0}),self.win.open()}),this.win.on("ok",function(){if("function"==typeof this.$iframe[0].contentWindow.formSubmit)return this.$iframe[0].contentWindow.formSubmit(this,function(){self.refresh(),self.options.callback.submit()}),!1}).on("close",function(){}),$(window).off("resize.grid").on("resize.grid",function(){self.tm&&clearTimeout(self.tm);var t=self.$grid.datagrid("getPanel"),e=t.parent(),i=t.find(".datagrid-btable"),o=t.parents(".k-panel-body:eq(0)"),n=e.parent().width(),a=self.options.easyuiSettings.height,s=i.height();self.options.autoFull?(a=o.lenght>0?o.width():$(window).height()-self.$container.offset().top-5,s<a&&(n+=18)):n+=18,self.options.isTree?self.$grid.treegrid("resize",{width:n,height:a}):self.$grid.datagrid("resize",{width:n,height:a}),t.css("width","auto"),e.css("width","auto")})},Grid.prototype.refresh=function(){this.options.isTree?(this.$grid.treegrid("reload"),this.$grid.treegrid("unselectAll")):(this.$grid.datagrid("reload"),this.$grid.datagrid("unselectAll")),this.$container.find("#idEdit").linkbutton("enable").end().find("#idSave,#idCancle").linkbutton("disable"),this.options.callback.refresh()},Grid.prototype.search=function(t){t=t||{};var e=this.options.searchParams(t);if("object"==typeof e&&!$.isArray(e))for(var i in e)t[i]=e[i];this.options.isTree?(this.$grid.treegrid("load",t),this.$grid.treegrid("unselectAll")):(this.$grid.datagrid("load",t),this.$grid.datagrid("unselectAll")),this.$container.find("#idEdit").linkbutton("enable").end().find("#idSave,#idCancle").linkbutton("disable"),this.options.callback.search()},Grid.prototype.getSelectedIds=function(t){var e=this,i=this.options.isTree?this.$grid.treegrid("getSelections"):this.$grid.datagrid("getSelections"),o=[];return t=t||e.options.easyuiSettings.idField,0==i.lenght?[]:(_.forEach(i,function(e){o.push(e[t])}),o)},Grid.Global=function($elms){$elms=$elms||$("table[data-module=grid]"),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),data=$.data($el[0],"grid");data||(options&&options.length>0&&(options=eval("(0,"+options+")")),data=new Grid($el,options),$.data($el[0],"grid",data))})},Grid}),define("widget/list",["jquery","KM","widget/grid","widget/popForm","widget/popSelect"],function(t,e,i,o,n){var a=function(e){this.options=e,this.$searchPanel=e.$searchPanel||t("#searchPanel"),this.$grid=e.$grid||t("#dataGrid"),this.$panelBox=this.$searchPanel.find("div.panel-box"),this.init()};return a.prototype.init=function(){var o=this;e.DatePicker.Global(this.$searchPanel.find("input[data-module=datepicker]")),e.DropDownTree.Global(this.$searchPanel.find("input[data-module=dropdowntree]")),e.Upload.Global(this.$searchPanel.find("input[data-module=upload],button[data-module=upload]")),n(this.$searchPanel.find("[data-module=popselect]"),function(){o.search()}),this.$panelBox.each(function(){var e=t(this),i=e.attr("data-multiple");i&&"true"==i&&e.find("label").prepend('<input type="checkbox"  />')}),data=this.getData(this.$searchPanel),this.options.easyuiSettings.queryParams=t.extend(!0,data,this.options.easyuiSettings.queryParams),this.grid=new i(this.$grid,this.options),this.watch()},a.prototype.watch=function(){var e=this;this.$searchPanel.off("click.list keyup.list").on("click.list","[role=search]",function(){e.search()}).on("keyup.list","input[type=text],textarea",function(t){"13"==t.keyCode&&e.search()}).on("click.list",".items li",function(){var i=t(this),o=i.find("input");if(0==o.length){if(i.hasClass("active"))return;i.addClass("active").siblings().removeClass("active"),e.search()}else checked=o.prop("checked"),checked?i.addClass("active"):i.removeClass("active")})},a.prototype.search=function(){var t=this.getData(this.$searchPanel);this.grid.search(t)},a.prototype.refresh=function(){this.grid.refresh()},a.prototype.getData=function(e){e=e||this.$searchPanel;var i={};return e.find("input[name], textarea[name]").each(function(){var e=t(this);if(e.is("[type=checkbox]")===!1&&e.is("[type=radio]")===!1)i[e.attr("name")]=t.trim(e.val());else if(e.is("[type=radio]:checked"))i[e.attr("name")]=t.trim(e.val());else if(e.is("[type=checkbox]:checked")){var o=e.attr("name");i[o]?i[o]=i[o]+","+e.val():i[o]=e.val()}}),e.find("ul.items").each(function(){var e=t(this),o=e.attr("data-name"),n=e.find("input:checkbox");if(o){var a=[];e.find("li.active").each(function(){a.push(t(this).attr("data-value"))}),i[o]=0==n.length?a.join(""):a}}),e.find("select").each(function(){i[this.name]=t(this).val()}),i.rand=Math.random(),i},a}),define("widget/multipleAutocomplete",["jquery"],function($){var num=1,MultipleAutocomplete=function(t,e){this.$el=t,this.options=$.extend({},{id:null,url:null,data:[],split:",",max:5,width:null,height:null,isBottom:!0,highlight:!0,bindElement:null,formatItem:function(t){return t},formatResult:function(t){return"object"==typeof t?{text:t.text,value:t.value}:t},callback:{setValue:$.noop}},e),this.initData=[],this.selectIndex=-1,this.init()},KEY={LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,ENTER:13};return MultipleAutocomplete.prototype.init=function(){var t=this.options.id,e=$(this.options.bindElement),i=$.trim(this.$el.val()).split(this.options.split),o=$.trim(e.val()).split(this.options.split);t||(t=this.$el[0].id?"autocomplete_"+this.$el[0].id:"autocomplete_"+num++),this.$autocomplete=$('<div id="'+t+'" class="w-autocomplete"></div>').appendTo(this.$el.parent()),this.$el.hide(),this.$inputBox=$('<div class="w-autocomplete-inputbox"><input type="text" data-role="multipInput" /></div>').appendTo(this.$autocomplete),this.$input=this.$inputBox.find("input"),this.$listBox=$('<ul class="w-autocomplete-list"></ul>').appendTo(document.body),this.$bindElement=e;for(var n,a=0;a<i.length;a++)i[a]&&(n=o&&o.length==i.length?{text:i[a],value:o[a]}:{text:i[a],value:i[a]},n&&this.initData.push(n));this.build(),this.watch()},MultipleAutocomplete.prototype.watch=function(){var t=this;this.$autocomplete.on("click",function(){t.$input.focus()}).on("click",".w-autocomplete-item",function(){return $(this).addClass("active").siblings().removeClass("active"),t.selectIndex=$(this).index(),!1}).on("focus",'[data-role="multipInput"]',function(){var e=$.data(t.$el[0],"$form");if(e){var i=$.data(e[0],"validate");i&&i.hideError(t.$el)}}).on("blur",'[data-role="multipInput"]',function(){t.$el.focus().blur()}).on("keydown",'[data-role="multipInput"]',function(e){var i=$(this),o=$.trim(i.val());if(0==o.length&&"8"==e.keyCode&&t.selectIndex==-1&&t.$autocomplete.find(".w-autocomplete-item").length>0)return t.selectIndex=t.$autocomplete.find(".w-autocomplete-item:last").addClass("active").index(),i.blur(),!1}).on("keyup",'[data-role="multipInput"]',function(e){var i=$(this),o=$.trim(i.val());switch(0==o.length&&i.val(""),t.setWidth(),t.cache?t.cache!=o&&(t.cache=o,t.search(o),t.active=0):(t.cache=o,t.search(o),t.active=0),e.keyCode){case KEY.UP:case KEY.LEFT:e.preventDefault(),t.up();break;case KEY.DOWN:case KEY.RIGHT:t.down();break;case KEY.ENTER:case KEY.TAB:t.select()}}),this.$listBox.on("click","li",function(){$(this).addClass("active").siblings().removeClass("active"),t.select()}),$(window).on("resize.multipleautocomplete",function(){t.setPos()}),$(document).on("click.multipleautocomplete",function(e){t.$autocomplete.find(".w-autocomplete-item.active").removeClass("active")}).on("keydown.multipleautocomplete",function(e){if("8"==e.keyCode&&t.selectIndex!=-1)return t.remove(),!1}).on("click.multipleautocomplete",function(){t.hide()})},MultipleAutocomplete.prototype.search=function(val){var self=this;this.cacheData=[];var data=[],flag=0;if(this.keyword=val,0===val.length)return this.ajax&&(this.ajax.abort(),this.ajax=null),void this.hide();if(this.options.url)this.ajax&&(this.ajax.abort(),this.ajax=null),this.ajax=$.get(this.options.url,{keyword:val}).done(function(ret){"object"!=typeof ret&&(ret=eval("(0,"+ret+")"));for(var i=0;i<ret.length&&(self.cacheData.push(ret[i]),flag!==self.options.max-1);i++)flag++;self.show()});else if(this.options.data.length>0){for(var i=0,searchItem,searchText,item;i<this.options.data.length;i++)if(item=this.options.data[i],searchItem=this.options.formatItem(item),searchText="object"!=typeof searchItem?searchItem:searchItem.text,searchText=String(searchText),searchText.toLowerCase().indexOf(val.toLowerCase())>=0){if(this.cacheData.push(item),flag===this.options.max-1)break;flag++}this.show()}},MultipleAutocomplete.prototype.highlight=function(t,e){if(this.options.highlight){var i=new RegExp("("+t+")","ig");return e=e.replace(i,"<strong>$1</strong>")}return e},MultipleAutocomplete.prototype.show=function(){if(!this.cacheData||0==this.cacheData.length)return void this.hide();var t=[];this.$listItem=null;for(var e,i,o,n,a,s=0;s<this.cacheData.length;s++)o=this.cacheData[s],n=this.options.formatItem(o),a=this.options.formatResult(o),"object"!=typeof n?e=i=String(n):(e=n.text,i=n.value),"object"!=typeof a&&(a={text:a,value:a}),a.text||(a={text:e,value:i}),t.push('<li class="'+(0==s?"active":"")+(s+1==this.cacheData.length?" last":"")+' " data-text="'+a.text+'" data-value="'+a.value+'">'+this.highlight(this.keyword,e)+"</li>");this.$listBox.html(t.join("")),this.$listItem=this.$listBox.find("li"),this.$listBox.show().scrollTop(0),this.setPos(),this.setPos()},MultipleAutocomplete.prototype.hide=function(){this.$listBox.hide()},MultipleAutocomplete.prototype.setPos=function(){var t={left:this.$autocomplete.offset().left,top:this.$autocomplete.outerHeight()+this.$autocomplete.offset().top,width:this.options.width||this.$autocomplete.outerWidth(),maxHeight:this.options.height||"auto"};this.options.isBottom||(t.top=this.$autocomplete.offset().top-this.$listBox.outerHeight(!0)),this.$listBox.css(t)},MultipleAutocomplete.prototype.up=function(){this.moveSelect(-1)},MultipleAutocomplete.prototype.down=function(){this.moveSelect(1)},MultipleAutocomplete.prototype.hasItem=function(){return this.$listItem&&this.$listItem.length>0},MultipleAutocomplete.prototype.moveSelect=function(t){if(this.hasItem()){this.active+=t,this.active<0?this.active=this.$listItem.length-1:this.active>this.$listItem.length-1&&(this.active=0);var e=this.$listItem.removeClass("active").eq(this.active).addClass("active"),i=0;this.$listItem.each(function(){i+=this.offsetHeight});var o=this.$listBox.scrollTop(),n=this.$listBox[0].clientHeight,a=e.height(),s=e.position().top;s+a>=n?this.$listBox.scrollTop(s+a-n+o+5):s<=0&&this.$listBox.scrollTop(o+s-5)}},MultipleAutocomplete.prototype.remove=function(){var t=this;this.selectIndex!=-1&&(this.initData.splice(this.selectIndex,1),this.selectIndex=-1,this.$autocomplete.find(".w-autocomplete-item.active").removeClass("active"),this.build(),setTimeout(function(){t.$inputBox.find("input").val("").focus(),t.setWidth()},150))},MultipleAutocomplete.prototype.select=function(){for(var t,e,i=this.$listBox.find("li.active"),o=i.attr("data-text"),n=i.attr("data-value"),a=!1,s=-1,l=0;l<this.initData.length;l++)if(t=this.initData[l],"object"!=typeof t?(a=!0,e=t):e=String(t.text),o.toLowerCase()==e.toLowerCase()){s=l;break}s==-1&&(a?this.initData.push(o):this.initData.push({text:o,value:n}),this.build()),this.cache=null,this.$input.val(""),this.setWidth(),this.hide()},MultipleAutocomplete.prototype.build=function(){for(var t,e,i=[],o=[],n=[],a=0;a<this.initData.length;a++)t=this.initData[a],"object"!=typeof t?(e=t,n.push(t)):(e=t.text,n.push(t.value)),o.push(e),i.push('<div class="w-autocomplete-item"><span class="item-text">'+e+(a+1==this.initData.length?'<span class="w-autocompletet-split"></span>':'<span class="w-autocompletet-split">'+this.options.split+"</span>")+"</span></div>");this.$inputBox.prevAll().remove().end().before(i.join("")),this.$el.val(o.join(this.options.split)),this.$bindElement.val(n.join(this.options.split))},MultipleAutocomplete.prototype.getData=function(){return this.initData},MultipleAutocomplete.prototype.setWidth=function(){var t=this.$input.val(),e=t.match(/[^\x00-\xff]/gi),i=t.length+(null==e?0:e.length);i=i<=6?6:i;var o=this.$autocomplete.outerWidth()-20,n=8*i;this.$inputBox.width(n>=o?o:n)},MultipleAutocomplete.Global=function($elms){$elms=$elms||$("[data-module=multipleautocomplete]"),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),data=$.data(this,"multipleautocomplete");data||(options=eval("(0,"+options+")"),data=new MultipleAutocomplete($el,options),$.data(this,"multipleautocomplete",data))})},MultipleAutocomplete}),define("widget/popForm",["jquery","widget/popWin","KM"],function(t,e,i){try{"undefined"!=typeof top.KM?i=top.KM:"undefined"!=typeof parent.KM&&(i=parent.KM)}catch(o){try{i=parent.KM||i}catch(o){}}return function(o,n){return n=t.extend(!0,{showCloseTips:!0,callback:{beforeOpen:t.noop,submit:t.noop,close:t.noop}},n),o=o||t("[data-module=popform]"),e.init(o,{callback:{beforeOpen:n.callback.beforeOpen,onOk:function(e){var i=t.data(e[0],"popWinOptions");if("function"==typeof this.$iframe[0].contentWindow.formSubmit)return this.$iframe[0].contentWindow.formSubmit(this,function(t){i&&i.callback&&i.callback.submit&&i.callback.submit(t,e),n.callback.submit(t,e)}),!1},onClose:function(e){var o=this,a=t.data(e[0],"popWinOptions");return a&&a.showCloseTips?(i.Window.confirm("是否放弃编辑?",function(){o.close(!0)}),!1):(!a||!a.callback||0!=a.callback.close(this))&&0!=n.callback.close(this)}}})}}),define("widget/popSelect",["KM","widget/popWin","cookie"],function(t,e){return function(t,i){var o={callback:{beforeOpen:$.noop,onOk:$.noop,close:$.noop}};return"function"==typeof i&&(o.callback.onOk=i),"object"==typeof i&&(o=$.extend(!0,o,i)),t=t||$("input[data-module=popselect]"),e.init(t,{callback:{beforeOpen:function(t){var e=t.val(),i=t.val(),n=this.options.url,a=$.data(t[0],"popWinOptions"),s=t.parent(".k-input-group").next("input:hidden");if(s.length>0&&(i=s.val()),a.bindElement&&(i=$(a.bindElement).val()),e=e||"",i=i||"","button"==t[0].type.toLowerCase()&&(e="",i=""),$.cookie){var l=a.cookie?a.cookie.textName:"popSelectText",r=a.cookie?a.cookie.valueName:"popSelectValue";$.cookie(l,e,{expires:1,path:"/"}),$.cookie(r,i,{expires:1,path:"/"})}return n+=i&&i.length>0?n.indexOf("?")==-1?"?value="+encodeURIComponent(i):"&value="+encodeURIComponent(i):n.indexOf("?")==-1?"?text="+encodeURIComponent(e):"&text="+encodeURIComponent(e),n.length>255&&(n=n.substring(0,255)),this.options.url=n,o.callback.beforeOpen(this,t)},onOk:function(t){if("function"==typeof this.$iframe[0].contentWindow.getSelected){var e=this.$iframe[0].contentWindow.getSelected(),i=t[0].type.toLowerCase(),n=$.data(t[0],"popWinOptions"),a=t.parent(".k-input-group").next("input:hidden");switch(e||(e={text:"",value:""}),"string"==typeof e&&(e={text:e,value:e}),i){case"text":case"hidden":t.val(e.text).attr({title:e.text,"data-text":e.text,"data-value":e.value}).focus().blur()}n.bindElement&&$(n.bindElement).val(e.value).attr("title",e.value),n.callback&&n.callback.onOk&&n.callback.onOk(e),a.length>0&&a.val(e.value),o.callback.onOk(e)}},onClose:function(t){return 0!=o.callback.close(this)}}})}}),define("widget/popWin",["KM","XD"],function(KM,XD){var isCross=!1,hasError=!1,win;try{"undefined"!=typeof top.KM?KM=top.KM:"undefined"!=typeof parent.KM&&(KM=parent.KM)}catch(e){try{KM=parent.KM||KM}catch(e){}}return{init:function($elms,options){function openWin($el,options){var settings=$el.attr("data-options"),popWinOptions=$.data($el[0],"popWinOptions"),url=$el.attr("data-url"),title=$el.attr("data-title"),width=$el.attr("data-width")||800,height=$el.attr("data-height")||550,onOk=$el.attr("data-onOk"),onClose=$el.attr("data-onClose");popWinOptions||(onOk=onOk&&onOk.length>0?eval("(0,"+onOk+")"):null,onClose=onClose&&onClose.length>0?eval("(0,"+onClose+")"):null,settings=settings&&settings.length>0?eval("(0,"+settings+")"):{title:title,url:url,width:width,height:height,showFooter:!0},"undefined"==typeof settings.showFooter&&(settings.showFooter=!0),popWinOptions=settings,popWinOptions.onOk=onOk,popWinOptions.onClose=onClose,$.data($el[0],"popWinOptions",popWinOptions)),win||(win=new KM.Window({
iframe:!0})),win.options.url=popWinOptions.url,win.setBtns(popWinOptions.btns),win.setTitle(popWinOptions.title),win.setSize({width:popWinOptions.width,height:popWinOptions.height}),popWinOptions.showFooter?(win.options.showFooter=!0,setTimeout(function(){win.$footer.show()})):(win.options.showFooter=!1,setTimeout(function(){win.$footer.hide()})),win.on("ok",function(){return"function"==typeof popWinOptions.onOk?popWinOptions.onOk.call(this,$el):options.callback.onOk.call(this,$el)}),win.on("close",function(){return"function"==typeof popWinOptions.onClose?popWinOptions.onClose.call(this,$el):options.callback.onClose.call(this,$el)}),options.callback.beforeOpen.call(win,$el)!==!1&&win.open()}if(options=$.extend(!0,{callback:{beforeOpen:$.noop,onOk:$.noop,onClose:$.noop}},options),$elms&&0!=$elms.length){var $inputGroup=$elms.parent(".k-input-group,.input-group");0==$inputGroup.length?$elms.off("click.popWin").on("click.popWin",function(){openWin($(this),options)}):$inputGroup.off("click.popWin").on("click.popWin","input",function(){openWin($(this),options)}).on("click.popWin","button",function(){openWin($(this).parent().prev(),options)})}},open:function(t){t=$.extend(!0,{url:null,width:800,height:600,showFooter:!0,callback:{beforeOpen:$.noop,onOk:$.noop,onClose:$.noop}},t||{}),win||(win=new KM.Window({iframe:!0})),t.url&&(win.options.url=t.url,win.setBtns(t.btns),win.setTitle(t.title),win.setSize({width:t.width,height:t.height}),t.showFooter?(win.options.showFooter=!0,setTimeout(function(){win.$footer.show()})):(win.options.showFooter=!1,setTimeout(function(){win.$footer.hide()})),win.on("ok",function(){return t.callback.onOk.call(this)}),win.on("close",function(){return t.callback.onClose.call(this)}),t.callback.beforeOpen.call(win)!==!1&&win.open())},openForm:function(t){t=$.extend(!0,{showCloseTips:!1,callback:{submit:$.noop,close:$.noop}},t||{}),this.open({url:t.url,title:t.title||"弹出表单",width:t.width,height:t.height,btns:t.btns,callback:{beforeOpen:t.callback.beforeOpen,onOk:function(){return isCross?(XD.sendMessage(this.$iframe[0].contentWindow,{action:"formSubmit"}),!1):"function"==typeof this.$iframe[0].contentWindow.formSubmit?(this.$iframe[0].contentWindow.formSubmit(this,t.callback.submit),!1):void 0},onClose:function(){var e=this;return t.showCloseTips?(KM.Window.confirm("是否放弃编辑?",function(){e.close(!0)}),!1):0!=t.callback.close(this)}}})},openSelect:function(t){t=$.extend(!0,{callback:{beforeOpen:$.noop,onOk:$.noop,close:$.noop}},t||{}),this.open({url:t.url,title:t.title||"弹出选择",width:t.width,height:t.height,btns:t.btns,callback:{beforeOpen:t.callback.beforeOpen,onOk:function(){if("function"==typeof this.$iframe[0].contentWindow.getSelected){var e=this.$iframe[0].contentWindow.getSelected();t.bindElement&&$(t.bindElement).val(e.value).attr("title",e.value),t.callback.onOk(e)}},onClose:function(){return 0!=t.callback.close(this)}}})},close:function(t){win&&win.close(t)},setIsCross:function(t){"undefined"==typeof t&&(t=!0),isCross=t}}}),define("Widget",["widget/ball","widget/cross","widget/form","widget/grid","widget/list","widget/multipleAutocomplete","widget/popForm","widget/popSelect","widget/popWin"],function(t,e,i,o,n,a,s,l,r){return window.Widget={ball:t,Cross:e,form:i,Grid:o,List:n,MultipleAutocomplete:a,popForm:s,popSelect:l,popWin:r}});