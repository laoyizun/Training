define("km/ajax",["jquery","km/loading","km/popTips","km/validate","km/validateTooltips","km/window","km/lang"],function($,Loading,popTips,Validate,ValidateTooltips,Window,Lang){try{"undefined"!=typeof top.KM?Window=top.KM.Window:"undefined"!=typeof parent.KM&&(Window=parent.KM.Window)}catch(e){try{Window=parent.KM.Window||Window}catch(e){}}var Ajax=function(){function getFullUrl(t){var e=window.location,i=""+e.protocol+"//"+e.host+t;return i}function init(){var ajax=function(type,url,data,config){var config=$.extend(!0,{returnUrl:{enable:!0,url:location.href},redirectEnable:!0,loadingEnable:!0,popTips:{enable:!0,delay:800,inCallback:!0},ajaxConfig:{}},config);if(data=data||{},config.returnUrl.enable&&"object"==typeof data){var href=config.returnUrl.url;href.indexOf("#")!=-1&&href.lastIndexOf("?")!=-1&&href.lastIndexOf("?")>href.indexOf("#")&&(href=href.substr(0,href.lastIndexOf("?"))),data.returnUrl=href}var dtd=$.Deferred();config.loadingEnable&&Loading.show();var ajaxConfig=$.extend(!0,{url:url,type:type,data:data,dataType:"json",traditional:!0,cache:!1},config.ajaxConfig),isEn="en"==KMLang.code;return $.ajax(ajaxConfig).done(function(ret){if("string"==typeof ret)try{ret=eval("(0,"+ret+")")}catch(e){return dtd.resolve(ret),dtd.promise()}ret.Url=$.trim(ret.Url||""),ret.Status?ret.Message&&config.popTips.enable?(config.popTips.inCallback?popTips.success(isEn?KMLang.ajax.successMsg:ret.Message,config.popTips.delay,function(){config.redirectEnable&&ret.Url&&ret.Url.length>0&&(window.location.href=ret.Url)}):(popTips.success(isEn?KMLang.ajax.successMsg:ret.Message,config.popTips.delay),config.redirectEnable&&ret.Url&&ret.Url.length>0&&(window.location.href=ret.Url)),dtd.resolve(ret)):ret.Url&&ret.Url.length>0?window.location.href=ret.Url:dtd.resolve(ret):ret.ErrorMessage&&config.popTips.enable?(popTips.error((isEn?KMLang.ajax.sysErrMsg:ret.ErrorMessage)||KMLang.ajax.sysErrMsg,config.popTips.delay,function(){config.redirectEnable&&ret.Url&&ret.Url.length>0&&(window.location.href=ret.Url)}),dtd.resolve(ret)):config.redirectEnable&&ret.Url&&ret.Url.length>0?window.location.href=ret.Url:dtd.resolve(ret)}).fail(function(){config.popTips.enable&&popTips.error(KMLang.ajax.sysErrMsg,config.popTips.delay),dtd.reject()}).always(function(){Loading.hide()}),dtd.promise()};return{post:function(t,e,i){return ajax("POST",t,e,i)},get:function(t,e,i){return ajax("GET",t,e,i)},ajaxForm:function(t,e){var i,o,s,n;t.valid||(i=t.data("validate")),o=t.attr("action"),s=t.attr("method"),n=t.serialize();var a=location.href;a.indexOf("#")!=-1&&a.lastIndexOf("?")!=-1&&a.lastIndexOf("?")>a.indexOf("#")&&(a=a.substr(0,a.lastIndexOf("?"))),n+="&returnUrl="+encodeURIComponent(a);var r=$.Deferred(),h={Status:!1,ErrorMessage:KMLang.ajax.formValidateErrMsg};return i&&i.valid?i.valid()?ajax(s,o,n,e):(r.reject(h),r.promise()):t.valid?t.valid()?ajax(s,o,n,e):(r.reject(h),r.promise()):ajax(s,o,n,e)}}}var _instance;return{getInstance:function(){return _instance||(_instance=init()),_instance}}}();return Ajax.getInstance()}),define("km/app",["jquery","km/router","km/util","km/popTips","km/loading","km/event"],function(t,e,i,o,s,n){var a=function(e,i){this.$el=e,this._route={},this.config=t.extend({idPrefx:"app-view-",viewClass:"app-view",animateClass:"animated bounceInRight",Template:null},i||{}),this._view={},this.viewId=-1,this.window=window};return a.prototype.route=function(t,e,i){return i||(i=e,e=null),this._route[t]=[e,i],this},a.prototype.run=function(){var t=this,i=new e;for(var o in t._route)!function(e){var o=t._route[e];i.map(e,o[0],function(e){t.callView(o[1],e||{})})}(o);i.init()},a.prototype.callView=function(e,i,o){var s,n,a,r=this,h=!1,l=this.window.location.hash;if(this._view[e]?(s=this._view[e].$el,n=this._view[e].hash,a=this._view[e].instance):(s=t('<div id="'+this.config.idPrefx+ ++this.viewId+'" class="'+this.config.viewClass+'"></div>'),n=l,this._view[e]={$el:s,params:i,hash:n,instance:null},this.$el.append(s),h=!0),(n!=l||h)&&(this._view[e].hash=l,a=this._view[e].instance,require([e],function(t){a||(a=new t(s,r),r._view[e].instance=a),a.destroy&&a.destroy(),a.run(i)})),this.viewName){var p=this._view[this.viewName].$el,d=this._view[this.viewName].instance;d&&"function"==typeof d.hide&&d.hide(),p.hide().removeClass(this.config.animateClass)}s.show().addClass(this.config.animateClass),a&&"function"==typeof a.show&&a.show(),this.viewName=e},a.View=function(t,e){this.$el=t,this.app=e,e.config.Template&&(this.Template=e.config.Template)},a.View.prototype.run=function(t){this.context=t},a.View.extend=function(e){e=t.extend({initialize:function(){}},e||{});var o=function(t,e){a.View.call(this,t,e)};o.prototype=i.createProto(a.View.prototype);for(var s in e)o.prototype[s]=e[s];return o},a}),define("km/areaSelector",["jquery"],function(t){return function(e){e=t.extend(!0,{$container:t(document.body),zIndex:9999,autoScroll:!0,autoScrollDealy:5,isDraw:!0,callback:{onStart:t.noop,onMove:t.noop,onStop:t.noop}},e);var i,o,s,n=e.$container,a=document,r=t(a),h="body"==n[0].tagName.toLowerCase()?t(window):n,l={bx:0,by:0,mx:0,my:0,ex:0,ey:0},p={left:n.offset().left,top:n.offset().top,width:n.outerWidth(),height:n.outerHeight()},d=!1;n.off("mousedown.rangeSelector").on("mousedown.rangeSelector",function(o){return i||(i=t('<div class="k-areaSelector"></div>').css("zIndex",e.zIndex).appendTo(a.body)),c.start(o),a.onselectstart=function(){return!1},o.stopPropagation(),o.preventDefault(),!1});var c={start:function(t){var i=this,n=this.getMouseCoord(t);l.bx=parseInt(n.x),l.by=parseInt(n.y),o=h.height(),s=r.height(),r.on("mousemove.rangeSelector",function(t){i.move(t)}).on("mouseup.rangeSelector",function(t){i.stop(t),r.off("mousemove.rangeSelector"),r.off("mouseup.rangeSelector")}),e.callback.onStart(t,l)},move:function(t){var i=this.getMouseCoord(t);l.mx=parseInt(i.x),l.my=parseInt(i.y),e.isDraw&&this.draw(l),e.autoScroll&&(t.clientY<=10||t.clientY>=o-10?(t.clientY<=10&&!d&&(d=!0,this.scroll(-1,t.clientY)),t.clientY>=o-10&&i.y<s+100&&!d&&(d=!0,this.scroll(1,t.clientY))):d=!1),e.callback.onMove(t,l)},stop:function(t){var o=this.getMouseCoord(t);l.ex=parseInt(o.x),l.ey=parseInt(o.y),d=!1,i.hide(),e.callback.onStop(t,l)},getMouseCoord:function(t){return{x:t.pageX||t.clientX+document.body.scrollLeft-document.body.clientLeft,y:t.pageY||t.clientY+document.body.scrollTop-document.body.clientTop}},scroll:function(t,i){var s=this,n=h.scrollTop();t<0?n>0?(n-=5,h.scrollTop(n)):d=!1:i>=o-10?(n+=5,h.scrollTop(n)):d=!1,d?this.tm=setTimeout(function(){s.scroll(t,i)},e.autoScrollDealy):this.tm&&clearTimeout(this.tm)},draw:function(t){var e={display:"block",top:l.by<l.my?l.by:l.my,left:l.bx<l.mx?l.bx:l.mx,width:Math.abs(l.mx-l.bx),height:Math.abs(l.my-l.by)},o=e.top+e.height,s=e.left+e.width,n=p.top+p.height,a=p.left+p.width;o>=n&&(e.height=n-e.top),s>=a&&(e.width=a-e.left),e.left<=p.left&&(e.width=e.width-(p.left-e.left),e.left=p.left),e.top<=p.top&&(e.height=e.height-(p.top-e.top),e.top=p.top),i.css(e)}}}}),define("km/autoComplete",["jquery"],function($){!function(){var t={getSelection:function(){var t=this.jquery?this[0]:this;return("selectionStart"in t&&function(){var e=t.selectionEnd-t.selectionStart;return{start:t.selectionStart,end:t.selectionEnd,length:e,text:t.value.substr(t.selectionStart,e)}}||document.selection&&function(){t.focus();var e=document.selection.createRange();if(null===e)return{start:0,end:t.value.length,length:0};var i=t.createTextRange(),o=i.duplicate();return i.moveToBookmark(e.getBookmark()),o.setEndPoint("EndToStart",i),{start:o.text.length,end:o.text.length+e.text.length,length:e.text.length,text:e.text}}||function(){return null})()},replaceSelection:function(){var t="function"==typeof this.id?this.get(0):this,e=arguments[0]||"";return("selectionStart"in t&&function(){return t.value=t.value.substr(0,t.selectionStart)+e+t.value.substr(t.selectionEnd,t.value.length),this}||document.selection&&function(){return t.focus(),document.selection.createRange().text=e,this}||function(){return t.value+=e,jQuery(t)})()}};jQuery.each(t,function(t){jQuery.fn[t]=this})}();var kingwolfofsky={getInputPositon:function(t){if(document.selection){t.focus();var e=document.selection.createRange(),i=document.documentElement;return{left:e.boundingLeft+i.scrollLeft,top:e.boundingTop+i.scrollTop,bottom:e.boundingTop+e.boundingHeight+i.scrollTop,boxHeight:e.boundingHeight}}var o=this,s="{$clone_div}",n="{$cloneLeft}",a="{$cloneFocus}",r='<span style="white-space:pre-wrap;"> </span>',h=t[s]||document.createElement("div"),l=t[a]||document.createElement("span"),p=t[n]||document.createElement("span"),d=(o._offset(t),this._getFocus(t)),c={left:0,top:0};t[s]||(t[s]=h,t[a]=l,t[n]=p,h.appendChild(p),h.appendChild(l),document.body.appendChild(h),l.innerHTML="|",l.style.cssText="display:inline-block;width:0px;overflow:hidden;z-index:-100;word-wrap:break-word;word-break:break-all;",h.className=this._cloneStyle(t),h.style.cssText="visibility:hidden;display:inline-block;position:absolute;z-index:-100;word-wrap:break-word;word-break:break-all;overflow:hidden;"),h.style.left=this._offset(t).left+"px",h.style.top=this._offset(t).top+"px";var u=t.value.substring(0,d).replace(/</g,"<").replace(/>/g,">").replace(/\n/g,"<br/>").replace(/\s/g,r);p.innerHTML=u,l.style.display="inline-block";try{c=this._offset(l)}catch(f){}return l.style.display="none",c},_cloneStyle:function(t,e){if(!e&&t["${cloneName}"])return t["${cloneName}"];var i,o,s=/^(number|string)$/,n=/^(content|outline|outlineWidth)$/,a=[],r=t.style;for(o in r)n.test(o)||(val=this._getStyle(t,o),""!==val&&s.test(typeof val)&&(o=o.replace(/([A-Z])/g,"-$1").toLowerCase(),a.push(o),a.push(":"),a.push(val),a.push(";")));return a=a.join(""),t["${cloneName}"]=i="clone"+(new Date).getTime(),this._addHeadStyle("."+i+"{"+a+"}"),i},_addHeadStyle:function(t){var e=this._style[document];e||(e=this._style[document]=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(e)),e.styleSheet&&(e.styleSheet.cssText+=t)||e.appendChild(document.createTextNode(t))},_style:{},_getStyle:"getComputedStyle"in window?function(t,e){return getComputedStyle(t,null)[e]}:function(t,e){return t.currentStyle[e]},_getFocus:function(t){var e=0;if(document.selection){t.focus();var i=document.selection.createRange();if("TEXTAREA"===t.nodeName){var o=i.duplicate();o.moveToElementText(t);for(var e=-1;o.inRange(i);)o.moveStart("character"),e++}else"INPUT"===t.nodeName&&(i.moveStart("character",-t.value.length),e=i.text.length)}else(t.selectionStart||"0"==t.selectionStart)&&(e=t.selectionStart);return e},_offset:function(t){var e=t.getBoundingClientRect(),i=t.ownerDocument,o=i.body,s=i.documentElement,n=s.clientTop||o.clientTop||0,a=s.clientLeft||o.clientLeft||0,r=e.top+(self.pageYOffset||s.scrollTop)-n,h=e.left+(self.pageXOffset||s.scrollLeft)-a;return{left:h,top:r,right:h+e.width,bottom:r+e.height,boxHeight:e.height}}},KEY={LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,ENTER:13},AutoComplete=function(t,e){this.$element=t,this.options=$.extend(!0,{url:null,zIndex:1e3,data:[],max:10,width:null,height:null,isBottom:!0,highlight:!1,formatItem:function(t){return t},formatResult:function(t){return"object"==typeof t?{text:t.text,value:t.value}:t},bindElement:null,callback:{setValue:null},useAt:!1,atSpace:" "},e),this.tpl='<div class="k-autocomplete k-pop-panel"></div>',this.active=0,this.init()};return AutoComplete.prototype.init=function(){var t=this;this.$bindElement=$(this.options.bindElement),this.$listBox=$(this.tpl).hide().appendTo(document.body),this.data=this.options.data||[],this.$element.on("keyup.autocomplete",function(e){e.preventDefault();var i,o=$(this),s=o.val(),n=o.getSelection();s.length;if(t.focusPosition=kingwolfofsky.getInputPositon(this),t.options.useAt){if(i=s.substr(0,n.start),t.atStartIndex=i.lastIndexOf("@"),t.atStartIndex==-1)return void t.hide();s=s.substr(i.lastIndexOf("@")+1),t.atLastIndex=s.indexOf("@"),t.atLastIndex!=-1?s=s.substr(0,s.indexOf("@")):t.atLastIndex=s.length,t.atLastIndex+=t.atStartIndex}else s=$.trim(s);if(t.options.useAt&&!s&&(s="$useat$"),t.options.useAt&&/\s+/.test(s))return void t.hide();switch(t.cache?t.cache!=s&&(t.cache=s,t.search(s),t.active=0):(t.cache=s,t.search(s),t.active=0),e.keyCode){case KEY.UP:case KEY.LEFT:e.preventDefault(),t.prev();break;case KEY.DOWN:case KEY.RIGHT:t.next();break;case KEY.ENTER:case KEY.TAB:t.select()}}).on("keydown.autocomplete",function(t){switch(t.keyCode){case KEY.UP:case KEY.DOWN:case KEY.ENTER:t.preventDefault()}}),this.$listBox.on("click.autocomplete","li",function(){$(this).addClass("active").siblings().removeClass("active"),t.select()}),$(document).on("click.autocomplete",function(){t.hide()}),$(window).on("resize.autocomplete",function(){t.setCss()})},AutoComplete.prototype.search=function(value){var self=this;if(this.ajax&&(this.ajax.abort(),this.ajax=null),0==value.length)return void this.hide();if(this.options.url)this.ajax&&(this.ajax.abort(),this.ajax=null),this.ajax=$.get(this.options.url,{keyword:value}).done(function(ret){if("string"==typeof ret&&(ret=eval("(0,"+ret+")")),ret&&ret instanceof Array){var data;self.data=ret,data=self.getData(value),self.build(value,data),self.show()}});else if(this.options.proxy)this.options.proxy(value,function(t){self.data=t,t=self.getData(value),self.build(value,t),self.show()});else{var data=this.getData(value);this.build(value,data),this.show()}},AutoComplete.prototype.getData=function(t){this.cacheData=[];var e=[],i=0;if(0===t.length)return e;for(var o,s,n=0;n<this.data.length;n++)if(o=this.options.formatItem(this.data[n]),s="object"!=typeof o?o.toString().toLowerCase():o.text.toLowerCase(),"$useat$"!=t&&s.indexOf(t.toLowerCase())>=0||"$useat$"==t&&this.options.useAt){if(this.cacheData.push(this.data[n]),e.push(this.data[n]),i===this.options.max-1)break;i++}return e},AutoComplete.prototype.build=function(t,e){if(this.$listBox.find("ul").remove(),this.$listItem=null,0!==e.length){for(var i,o,s="",n="",a="<ul>",r=0;r<e.length;r++)i=this.options.formatItem(e[r]),o=this.options.formatResult(e[r]),"object"!=typeof i?s=n=i.toString():(s=i.text,n=i.value),"object"!=typeof o&&(s=o,n=o,o={text:o,value:o}),o.text||(o={text:s,value:n}),a+='<li class="'+(0==r?"active":"")+'"  data-index="'+r+'" data-text="'+o.text+'" data-value="'+o.value+'">'+this.highlight(t,s)+"</li>";a+="</ul>",this.$listBox.append(a),this.$list=this.$listBox.find("ul"),this.$listItem=this.$listBox.find("li")}},AutoComplete.prototype.highlight=function(t,e){if(this.options.highlight){var i=new RegExp("("+t+")","ig");return e=e.replace(i,"<strong>$1</strong>")}return e},AutoComplete.prototype.show=function(){return $("div.k-pop-panel").hide(),this.hasItem()?(this.setCss(),void this.$listBox.show()):void this.hide()},AutoComplete.prototype.getCss=function(){var t={left:this.$element.offset().left,top:this.$element.outerHeight()+this.$element.offset().top,width:this.options.width||this.$element.outerWidth()};return this.options.useAt&&this.focusPosition&&(t.left=this.focusPosition.left,t.top=this.focusPosition.top+this.focusPosition.boxHeight),this.options.isBottom||(t.top=this.$element.offset().top-this.$listBox.outerHeight(!0)),t},AutoComplete.prototype.setCss=function(){if(this.$list){this.$list.css("max-height",this.options.height||"auto");var t=this.getCss();this.$listBox.css(t)}},AutoComplete.prototype.hide=function(){this.options.useAt&&(this.cache=""),this.$listBox.hide()},AutoComplete.prototype.prev=function(){this.moveSelect(-1)},AutoComplete.prototype.next=function(){this.moveSelect(1)},AutoComplete.prototype.hasItem=function(){return this.$listItem&&this.$listItem.length>0},AutoComplete.prototype.moveSelect=function(t){if(this.hasItem()){this.active+=t,this.active<0?this.active=this.$listItem.length-1:this.active>this.$listItem.length-1&&(this.active=0);var e=this.$listItem.removeClass("active").eq(this.active).addClass("active"),i=0;this.$listItem.each(function(){i+=this.offsetHeight});var o=this.$list.scrollTop(),s=this.$list[0].clientHeight,n=e.height(),a=e.position().top;a>s?this.$list.scrollTop(a+n-s+o):a<0&&this.$list.scrollTop(o+a)}},AutoComplete.prototype.select=function(){var t,e,i,o=this.$listBox.find("li.active"),s=o.attr("data-index"),n=o.attr("data-text"),a=o.attr("data-value"),r=this.$element.val();if(this.options.useAt?(t=r.substr(0,this.atStartIndex+1),e=r.substr(this.atLastIndex+1),i=t+n+e+this.options.atSpace,this.$element.val(i)):this.$element.val(n),this.$bindElement.val(a),this.hide(),$.isFunction(this.options.callback.setValue)){var h=this.getItem(n,s);this.options.callback.setValue.call(this,h)}},AutoComplete.prototype.getItem=function(t,e){var i=this.cacheData;if(i&&0!==i.length){if(e)return i[e];for(var o,s,n=0;n<i.length;n++)if(o=this.options.formatItem(i[n]),s="object"!=typeof o?o.toString():o.text,t==s)return i[n];return null}},function($elms,options){$elms=$elms||$('input[data-module="autocomplete"]'),$elms.each(function(){var $el=$(this),settings=$el.attr("data-options"),obj=$.data($el[0],"autocomplete");obj||(!options&&settings&&settings.length>0&&(options=eval("(0,"+settings+")")),obj=new AutoComplete($el,options),$.data($el[0],"autocomplete",obj))})}}),define("km/cache",[],function(){var t={},e=window.localStorage;return t.set=function(i,o,s){if(!o)return void t.remove(i);var n;/^[1-9]\d*$/.test(s)&&(n=(new Date).getTime()+1e3*parseInt(s));var a={value:o,expired:n};e.setItem(i,JSON.stringify(a))},t.get=function(i){var o=e.getItem(i),s=null;return o&&(o=JSON.parse(o),o.expired&&(new Date).getTime()>o.expired?t.remove(i):s=o.value),s},t.remove=function(t){e.removeItem(t)},t.clear=function(){e.clear()},t}),define("km/clipZoom",["jquery","km/dragdrop"],function(t,e){var i=function(e,i){this.$element=e,this.options=t.extend(!0,{imgUrl:"",scale:!0,width:400,height:300,selectorWidth:120,selectorHeight:100,callback:{clip:null}},i),this.$selector=e.find(".selector"),this.$clipZoomBox=e.find(".k-clipZoom-Box").width(this.options.width).height(this.options.height),this.$container=this.$clipZoomBox.find(".k-container"),this.$mainImg=this.$container.find("img"),this.$viewBox=e.find(".view-box"),this.$viewImg=this.$viewBox.find("img"),this.$resultBox=e.find(".result-box"),this.$resultImg=this.$resultBox.find("img"),this.init()};return i.prototype.init=function(){var t=this;this.$selector.width(this.options.selectorWidth).height(this.options.selectorHeight),this.$viewBox.width(this.options.selectorWidth).height(this.options.selectorHeight),this.selectorDnd=new e({$layer:this.$selector,$range:this.$clipZoomBox,resizable:!0,scale:this.options.scale,callback:{resize:function(){t.setPreview()},move:function(){t.setPreview()}}}),this.imgLoad(),this.eventBind()},i.prototype.eventBind=function(){var t=this;this.$element.on("click.clipzoom",'[role="clip"]',function(){t.clip()}).on("click.clipzoom",'[role="center"]',function(){t.center()}).on("click.clipzoom",'[role="reset"]',function(){t.reset()}).on("click.clipzoom",'[role="plus"]',function(){t.zoom(!0)}).on("click.clipzoom",'[role="minus"]',function(){t.zoom(!1)})},i.prototype.setImgSize=function(t,e){this.$mainImg.width(t).height(e)},i.prototype.imgLoad=function(){var t=this,i=new Image;i.onload=function(){var o=t.getSize(i.width,i.height,t.options.width);i.width<t.options.width&&(o.width=i.width,o.height=i.height),t.$container.width(o.width).height(o.height).css({left:0,top:0}),t.$mainImg.attr("src",t.options.imgUrl).width(o.width).height(o.height),t.$viewImg.attr("src",t.options.imgUrl).width(o.width).height(o.height),t.resetSize={width:o.width,height:o.height,left:0,top:0},t.containerDnd=new e({$layer:t.$container,$range:t.$clipZoomBox,resizable:!0,boundary:!0,scale:!0,callback:{resize:function(e,i){t.setImgSize(i.width,i.height),t.setPreview()},move:function(){t.setPreview()}}}),t.setPreview()},i.onerr=function(){alert("图片加载失败")},i.src=this.options.imgUrl},i.prototype.getSize=function(t,e,i){var o;return t>=e?(o=t/e,e=i/o):(o=e/t,e=i*o),{width:parseInt(i),height:parseInt(e)}},i.prototype.zoom=function(t){var e,i=this.$container.width(),o=this.$container.height();e=t?i/.8:.8*i;var s=this.getSize(i,o,e);this.$container.width(s.width).height(s.height),this.$mainImg.width(s.width).height(s.height),this.$viewImg.width(s.width).height(s.height),this.setPreview()},i.prototype.clip=function(){var e={imgSource:this.options.imgUrl,imgWidth:this.$viewImg.width(),imgHeight:this.$viewImg.height(),imgX:Math.abs(this.$viewImg[0].style.marginLeft.replace("px",""))-this.$viewImg.position().left,imgY:Math.abs(this.$viewImg[0].style.marginTop.replace("px",""))-this.$viewImg.position().top,selectorX:this.$selector.position().left,selectorY:this.$selector.position().top,cutterWidth:this.options.selectorWidth,cutterHeight:this.options.selectorHeight};t.isFunction(this.options.callback.clip)&&this.options.callback.clip(e)},i.prototype.center=function(){var t=parseInt(this.$mainImg.width()),e=parseInt(this.$mainImg.height()),i=parseInt(this.$selector.width()),o=parseInt(this.$selector.height()),s=parseInt(this.options.width),n=parseInt(this.options.height),a=this.getSize(t,e,i);a.height<o&&(a.width=t/e*o,a.height=o),this.$mainImg.width(a.width).height(a.height),this.$viewImg.width(a.width).height(a.height),this.$container.width(a.width).height(a.height).css({top:(n-a.height)/2,left:(s-a.width)/2}),this.$selector.css({top:(n-o)/2,left:(s-i)/2}),this.setPreview()},i.prototype.reset=function(){this.$container.width(this.resetSize.width).height(this.resetSize.height).css({left:0,top:0}),this.$mainImg.width(this.resetSize.width).height(this.resetSize.height),this.$viewImg.width(this.resetSize.width).height(this.resetSize.height),this.setPreview()},i.prototype.setPreview=function(){var t=this.options,e=this.getPreviewInfo(),i=t.selectorWidth,o=t.selectorHeight;e.viewPortWidth,e.viewPortHeight;if(e.selectorWidth>0){var s=i/e.selectorWidth,n=o/e.selectorHeight;this.$viewImg.css({width:Math.round(s*e.imgWidth),height:Math.round(n*e.imgHeight),left:Math.round(s*e.imgX),top:Math.round(n*e.imgY),marginLeft:-Math.round(s*e.selectorX),marginTop:-Math.round(n*e.selectorY)})}},i.prototype.getPreviewInfo=function(){var t=this.options;return{imgWidth:this.$mainImg.width(),imgHeight:this.$mainImg.height(),imgX:this.$container.position().left,imgY:this.$container.position().top,selectorWidth:this.$selector.width(),selectorHeight:this.$selector.height(),selectorX:this.$selector.position().left,selectorY:this.$selector.position().top,viewPortWidth:t.width,viewPortHeight:t.height}},i}),define("km/contextMenu",["jquery"],function($){var items=[],$curTarget,identity=1,$contextMenu=$('<ul class="k-contextMenu"></ul>').appendTo(document.body);$contextMenu.on("click.contextmenu","li",function(){var t=$(this),e=t.attr("data-action"),i=items[e];if(i&&"function"==typeof i.func)return $contextMenu.hide(),i.func($curTarget)});var ContextMenu=function(t,e){this.identity=identity++,this.$el=t,this.options=$.extend(!0,{target:"",className:"k-contextMenu",items:[],callback:{onShow:$.noop}},e),this.tm=null,this.init()};return ContextMenu.prototype.init=function(){0!=this.options.items.length&&0!=this.$el.length&&(this.build(),this.watch())},ContextMenu.prototype.watch=function(){var t=this;this.$el.on("contextmenu.contextmenu",this.options.target,function(e){var i=e.pageX,o=e.pageY;return $curTarget=$(this),t.build(),items=t.items,setTimeout(function(){$contextMenu.css({left:i,top:o,display:"block"}),t.options.callback.onShow.call(t)}),!1}),$(document).on("click.contextmenu."+this.identity,function(){$contextMenu.hide(),$curTarget=null})},ContextMenu.prototype.build=function(){var t=[];this.items={};for(var e,i=0;i<this.options.items.length;i++)e="contextMenu_"+i,t.push('<li data-action="'+e+'">'+this.options.items[i].text+"</li>"),this.items[e]=this.options.items[i];$contextMenu.html(t.join(""))},ContextMenu.prototype.filterHtml=function(t){return t.replace(/<[^>]*>/gi,"")},ContextMenu.Destory=function(){$contextMenu.remove()},ContextMenu.hide=function(){$("ul.k-contextMenu").hide()},ContextMenu.Global=function($elms,settings){$elms=$elms||$("[data-module=contextmenu]"),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),data=$.data($el[0],"contextMenu");data||(options=options&&options.length>0?eval("(0,"+options+")"):settings,data=new ContextMenu($el,options),$.data($el[0],"contextMenu",data))})},ContextMenu}),define("km/datePicker",["jquery"],function($){var dates={months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一","十二"],days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],daysShort:["周日","周一","周二","周三","周四","周五","周六"],daysMin:["日","一","二","三","四","五","六"]},date=new Date,DatePicker=function(t,e){var i=this;this.$element=t,this.options=$.extend(!0,{position:"left",desktop:!1,data:[],appendTo:$(document.body),showTime:!1,year:{min:date.getFullYear()-100,max:date.getFullYear()+100},format:"yyyy-MM-dd",inputGroup:".k-input-group",positionProxy:function(){return i.getPosition()},minDate:null,maxDate:null,zIndex:2e3},e),this.isInput="input"==this.$element[0].tagName.toLowerCase(),this.year=date.getFullYear(),this.month=date.getMonth()+1,this.day=date.getDate(),this.index=0,this.isSetTime=!1,this.selectDay=!1,this.event={selected:[],clean:[],change:[]},this.init()};return DatePicker.prototype.on=function(t,e){return $.isArray(this.event[t])&&this.event[t].push(e),this},DatePicker.prototype.getPosition=function(){var t={left:0,top:0},e=this.options.appendTo[0],i=this.$element[0];do t.left+=i.offsetLeft-i.scrollLeft,t.top+=i.offsetTop-i.scrollTop;while((i=i.offsetParent)&&i!=e);if("left"!=this.options.position){var o=t.left+this.$element.outerWidth(),s=t.left+this.$datepicker.outerWidth();t.left=t.left-(s-o)}return{left:t.left,top:t.top+this.$element[0].offsetHeight+2,zIndex:this.options.zIndex}},DatePicker.prototype.init=function(){this.isInput&&this.$element.attr("readonly","readonly"),this.$groupBox=this.$element.parent(this.options.inputGroup),this.initMinMaxDate(),this.canBuild()&&(this.createPanel(),this.eventBind())},DatePicker.prototype.initMinMaxDate=function(){var t=new Date;this.options.minDate&&("today"===this.options.minDate?this.minDate=t:this.minDate=new Date(this.options.minDate.replace(/-/g,"/")),this.options.year.min=this.minDate.getFullYear()),this.options.maxDate&&("today"===this.options.maxDate?this.maxDate=t:this.maxDate=new Date(this.options.maxDate.replace(/-/g,"/")),this.options.year.max=this.maxDate.getFullYear()),this.maxDate&&this.format(this.maxDate,"yyyyMMdd")<this.format(t,"yyyyMMdd")?(this.year=this.maxDate.getFullYear(),this.month=this.maxDate.getMonth()+1,this.day=this.maxDate.getDate()):this.minDate&&this.format(this.minDate,"yyyyMMdd")>this.format(t,"yyyyMMdd")&&(this.year=this.minDate.getFullYear(),this.month=this.minDate.getMonth()+1,this.day=this.minDate.getDate())},DatePicker.prototype.canBuild=function(){return!(this.maxDate&&this.minDate&&this.format(this.maxDate,"yyyyMMdd")<this.format(this.minDate,"yyyyMMdd"))},DatePicker.prototype.eventBind=function(){var t=this;this.$groupBox.on("click.datepicker","button",function(){return t.show(),!1}),this.$element.on("click.datepicker",function(){if(!t.options.desktop)return t.show(),!1}),this.$datepicker.on("click.datepicker",function(e){var i=e.target,o=$(i);return!("year"===i.id||"month"===i.id||o.parents(".year-box:eq(0)").length>0||o.parents(".month-box:eq(0)").length>0)&&(t.yearBoxToggle(!1),t.monthBoxToggle(!1),t.timePanelHide(),!1)}).on("click.datepicker","[role=prev]",function(){t.month--,t.prevToggle(),t.month<1&&(t.month=12,t.year--),t.$next.show(),t.createDays(),t.change()}).on("click.datepicker","[role=next]",function(){t.month++,t.nextToggle(),t.month>12&&(t.month=1,t.year++),t.$prev.show(),t.createDays(),t.change()}).on("click.datepicker","#month",function(){t.monthBoxToggle(!0),t.yearBoxToggle(!1),t.timePanelHide()}).on("click.datepicker",".month-box li",function(){var e=$(this),i=e.attr("data-month");e.hasClass("disabled")||(t.month=Number($.trim(i)),t.monthBoxToggle(!1),t.createDays(),t.prevToggle(),t.nextToggle(),t.change())}).on("click.datepicker","#year",function(){t.yearBoxToggle(!0),t.monthBoxToggle(!1),t.timePanelHide()}).on("click.datepicker",".year-box li",function(){var e=$(this),i=Number($.trim(e.text()));e.hasClass("cur")||e.hasClass("disabled")||(t.$yearBox.find("li").removeClass("cur"),e.addClass("cur"),t.year=Number(i),t.createDays(),t.yearBoxToggle(!1),t.prevToggle(),t.nextToggle(),t.change())}).on("click.datepicker","[role=yearPrev]",function(){0!==t.index&&(t.index--,t.toCurYearPanel())}).on("click.datepicker","[role=yearNext]",function(){t.index!==t.$yearItems.length-1&&(t.index++,t.toCurYearPanel())}).on("click.datepicker","[role=clear]",function(){t.isInput?t.$element.val(""):$.data(t.$element[0],"value",""),t.isSetTime=!1,t.setTodayInfo(),t.createDays(),t.setViewInfo(),t.hide(),$.map(t.event.clean,function(t){t()})}).on("click.datepicker","[role=today]",function(){t.setTodayInfo(),t.createDays(),t.hide(),t.set(!0),t.setTime()}).on("click.datepicker","tbody td",function(){var e=$(this),i=e.attr("data-year"),o=e.attr("data-month"),s=e.attr("data-day");if(!e.hasClass("disabled")&&(i=Number(i),o=Number(o),s=Number(s),t.year=i,t.month=o,t.day=s,t.createDays(),!t.options.showTime)){if(t.set(),t.options.desktop)return;t.hide()}}).on("click.datepicker","span.hours",function(){return t.setTimePanelPosition($(this),t.$hoursBox),!1}).on("click.datepicker","span.minutes",function(){return t.setTimePanelPosition($(this),t.$minutesBox),!1}).on("click.datepicker","span.seconds",function(){return t.setTimePanelPosition($(this),t.$secondsBox),!1}).on("click.datepicker",".time-box li",function(){var e=$(this),i=e.attr("data-value"),o=e.text(),s=e.attr("data-target");switch(s){case"hours":t.hours=i,t.$hours.text(o);break;case"minutes":t.minutes=i,t.$minutes.text(o);break;case"seconds":t.seconds=i,t.$seconds.text(o)}}).on("click.datepicker","[role=confirm]",function(){var e=t.$datepicker.find("td span.active"),i=e.parent(),o=i.attr("data-year"),s=i.attr("data-month"),n=i.attr("data-day");t.isSetTime=!0,t.year=Number(o),t.month=Number(s),t.day=Number(n),t.hours=Number(t.$hours.text()),t.minutes=Number(t.$minutes.text()),t.seconds=Number(t.$seconds.text()),t.set(),t.hide()}),$(document).on("click.datepicker",function(){t.options.desktop||t.hide()})},DatePicker.prototype.createPanel=function(){var t,e=[];for(e.push('<div class="k-datepicker k-pop-panel"  data-desktop="'+(this.options.desktop?"true":"")+'" >'),e.push('<div class="k-container">'),e.push("<table>"),e.push("<thead>"),e.push("<tr>"),e.push('<th class="prev"  style="width:28px;"><i class="fa fa-chevron-left" role="prev"></i></th>'),e.push('<th colspan="5">'),e.push('<span id="year" style="margin-right:20px;">'+this.year+"</span>"),e.push('<span id="month">'+dates.months[this.month-1]+"</span>"),e.push("</th>"),e.push('<th class="next"  style="width:28px;"><i class="fa fa-chevron-right" role="next"></i></th>'),e.push("</tr>"),e.push("<tr>"),t=0;t<dates.daysMin.length;t++)e.push("<th>"+dates.daysMin[t]+"</th>");e.push("</tr>"),e.push("</thead>"),e.push("<tbody>"),e.push("</tbody>"),e.push("</table>"),e.push(this.getYearBox()),e.push(this.getMonthBox()),e.push('<div class="line"></div>'),e.push(this.getTimeBox()),e.push('<div class="operate-box" style="text-align:right;margin-bottom:5px;">'),e.push('<input type="button" value="清空" role="clear" class="k-btn k-btn-default" />&nbsp;');var i='<input type="button" value="今天" role="today" class="k-btn k-btn-success" />&nbsp;';return this.minDate&&this.maxDate&&this.format(this.maxDate,"yyyyMMdd")>=this.format(new Date,"yyyyMMdd")||!this.minDate&&!this.maxDate?e.push(i):this.minDate&&!this.maxDate&&this.format(this.minDate,"yyyyMMdd")<=this.format(new Date,"yyyyMMdd")?e.push(i):this.maxDate&&!this.minDate&&this.format(this.maxDate,"yyyyMMdd")>=this.format(new Date,"yyyyMMdd")&&e.push(i),this.options.showTime&&e.push('<input type="button" value="确定" role="confirm" class="k-btn k-btn-primary" />&nbsp;'),
e.push("</div>"),e.push("</div>"),e.push("</div>"),this.$datepicker=$(e.join("")),this.$year=this.$datepicker.find("#year"),this.$yearBox=this.$datepicker.find(".year-box"),this.$yearItems=this.$yearBox.find("ul"),this.$month=this.$datepicker.find("#month"),this.$monthBox=this.$datepicker.find(".month-box"),this.$line=this.$datepicker.find(".line"),this.$timeBox=this.$datepicker.find(".time-box"),this.$operateBox=this.$datepicker.find(".operate-box"),this.$hours=this.$timeBox.find("span.hours"),this.$minutes=this.$timeBox.find("span.minutes"),this.$seconds=this.$timeBox.find("span.seconds"),this.$hoursBox=this.$timeBox.find(".hours-box"),this.$minutesBox=this.$timeBox.find(".minutes-box"),this.$secondsBox=this.$timeBox.find(".seconds-box"),this.$prev=this.$datepicker.find("th.prev i"),this.$next=this.$datepicker.find("th.next i"),this.index=this.$yearItems.find("li.cur").parent().show().index(),this.createDays(),this.options.showTime?this.$timeBox.show():this.$timeBox.hide(),this.options.desktop?(this.options.footerHtml&&this.$datepicker.append("<div>"+this.options.footerHtml+"</div>"),this.$line.hide(),this.$timeBox.hide(),this.$operateBox.hide(),void this.$datepicker.appendTo(this.$element).show().css({boxShadow:"none"})):void this.$datepicker.appendTo(0==this.options.appendTo.length?document.body:this.options.appendTo)},DatePicker.prototype.getYearBox=function(){var t,e,i,o=[],s=[],n=1,a=1,r=this.options.year.max-this.options.year.min+1,h=this.options.year.min-1;t=r%10===0?r/10:Number(r/10)+1;for(e=1;e<=t;e++){for(s.push("<ul>"),i=n;i<=r;i++){if(h+=1,s.push('<li id="li_'+h+'" class="'+(this.year===h?"cur":"")+'" >'+h+"</li>"),n++,a%10===0){a=1;break}a++}s.push("</ul>")}return o.push('<div class="year-box">'),o.push('<div class="year-box-container">'),o.push(s.join("")),o.push("</div>"),o.push('<div class="year-box-controls">'),o.push('<i class="fa fa-chevron-left" style="float:left;" role="yearPrev"></i>'),o.push('<i class="fa fa-chevron-right" style="float:right;" role="yearNext"></i>'),o.push("</div>"),o.push("</div>"),o.join("")},DatePicker.prototype.getMonthBox=function(){var t,e,i,o,s=[];for(s.push('<ul class="month-box">'),t=0;t<dates.months.length;t++)i=dates.months[t],e=t+1,s.push('<li class="'+o+'" data-month="'+(t+1)+'">'+i+"</li>");return s.push("</ul>"),s.join("")},DatePicker.prototype.getTimeBox=function(){var t,e=[];for(e.push('<div class="time-box">'),e.push('<ul class="hours-box">'),t=0;t<24;t++)e.push('<li data-target="hours" data-value='+t+">"+this.supStr(t)+"</li>");for(e.push("</ul>"),e.push('<ul class="minutes-box">'),t=0;t<=55;t+=5)e.push('<li data-target="minutes" data-value='+t+">"+this.supStr(t)+"</li>");for(e.push("</ul>"),e.push('<ul class="seconds-box">'),t=0;t<=55;t+=15)e.push('<li data-target="seconds" data-value='+t+">"+this.supStr(t)+"</li>");return e.push("</ul>"),e.push('<div class="time-box-container">'),e.push("<span>时间：</span>"),e.push("<div >"),e.push('<span class="hours">'+date.getHours()+"</span>"),e.push("<span>:</span>"),e.push('<span class="minutes">'+date.getMinutes()+"</span>"),e.push("<span>:</span>"),e.push('<span class="seconds">'+date.getSeconds()+"</span>"),e.push("</div>"),e.push("</div>"),e.push("</div>"),e.join("")},DatePicker.prototype.createDays=function(t,e,i){function o(t){function e(t){return a.format(t,"yyyyMMdd")<a.format(a.minDate,"yyyyMMdd")?"disabled":""}function i(t){return a.format(t,"yyyyMMdd")>a.format(a.maxDate,"yyyyMMdd")?"disabled":""}if(a.minDate&&a.maxDate){var o=e(t),s=i(t);if(o.length>0)return o;if(s.length>0)return s}else{if(a.minDate)return e(t);if(a.maxDate)return i(t)}return""}var s,n,a=this;this.setSelectivelyDate(),t=t||this.year,e=e||this.month,i=i||this.day;var r=this.getMonthLastDay(t,e),h=this.getMonthLastDay(t,e-1),l=new Date(t,e-1,1).getDay(),p=new Array(42),d=[],c=42-r;for(s=0,n=l;s<r;s++,n++)p[n]={year:t,month:e,day:s+1,tdClass:o(new Date(t,e-1,s+1))},s+1===r&&(c=42-n);for(s=l,n=0;s>=1;s--,n++){var u;1===e?(u=o(new Date(t-1,11,h-s+1)),p[n]={year:t-1,month:12,day:h-s+1,tdClass:"old "+u}):(u=o(new Date(t,e-2,h-s+1)),p[n]={year:t,month:e-1,day:h-s+1,tdClass:"old "+u})}for(s=42-c+1,n=1;s<42;s++,n++){var u;12===e?(u=o(new Date(t+1,0,n)),p[s]={year:t+1,month:1,day:n,tdClass:"new "+u}):(u=o(new Date(t,e,n)),p[s]={year:t,month:e+1,day:n,tdClass:"new "+u})}var f,m,g,$=0,v=0;for(s=0;s<6;s++){for(d.push("<tr>"),n=$;n<42;n++)if(f=p[n],m=f.year===t&&f.month===e&&this.day===f.day?"today":"",g=this.getDotHtml(f.year+"-"+this.fixZero(f.month)+"-"+this.fixZero(f.day)),d.push('<td id="'+f.year+"_"+f.month+"_"+f.day+'" class="'+f.tdClass+"   "+m+'  " data-year="'+f.year+'" data-month="'+f.month+'" data-day="'+f.day+'"><span>'+f.day+"</span>"+g+"</td>"),$++,v++,7===v){v=0;break}d.push("</tr>")}this.$datepicker.find("tbody").html(d.join("")),this.setViewInfo(t,e,i)},DatePicker.prototype.fixZero=function(t){return t=String(t),0===t.length?"":1===t.length?t="0"+t:t},DatePicker.prototype.getDotHtml=function(t){if(!this.options.data||0===this.options.data.length)return"";for(var e,i=0;i<this.options.data.length;i++)if(e=this.options.data[i],e===t)return'<em class="dot"></em>';return""},DatePicker.prototype.getMonthLastDay=function(t,e){return new Date(new Date(t,e,1).getTime()-864e5).getDate()},DatePicker.prototype.yearBoxToggle=function(t){var e={left:this.$year.position().left,top:this.$year.position().top+this.$year.outerHeight()-2};t?(this.$year.addClass("selected"),this.$yearBox.show().css(e)):(this.$year.removeClass("selected"),this.$yearBox.hide())},DatePicker.prototype.monthBoxToggle=function(t){var e={left:this.$month.position().left,top:this.$month.position().top+this.$month.outerHeight()-2};t?(this.$month.addClass("selected"),this.$monthBox.show().css(e)):(this.$month.removeClass("selected"),this.$monthBox.hide())},DatePicker.prototype.timePanelHide=function(){this.$hoursBox.hide(),this.$minutesBox.hide(),this.$secondsBox.hide()},DatePicker.prototype.toCurYearPanel=function(){this.$yearItems.hide().eq(this.index).show()},DatePicker.prototype.prevToggle=function(){var t=1;this.minDate?t=this.minDate.getMonth()+1:this.maxDate&&(t=this.maxDate.getMonth()+1),this.year===this.options.year.min&&this.month===t?this.$prev.hide():this.$prev.show()},DatePicker.prototype.nextToggle=function(){var t=12;this.maxDate?t=this.maxDate.getMonth()+1:this.minDate&&(t=this.minDate.getMonth()+1),this.year===this.options.year.max&&this.month===t?this.$next.hide():this.$next.show()},DatePicker.prototype.setSelectivelyDate=function(){function t(t){var e=n.minDate.getFullYear(),o=n.minDate.getMonth()+1,s=n.minDate.getDate();e==n.year&&(o>n.month&&(n.month=o,s<n.day&&(n.day=s)),n.month==o&&s>n.day&&(n.day=s),i(t,o))}function e(t){var e=n.maxDate.getFullYear(),i=n.maxDate.getMonth()+1,s=n.maxDate.getDate();e==n.year&&(i<n.month&&(n.month=i,s>n.day&&(n.day=s)),i==n.month&&s<n.day&&(n.day=s),o(t,i))}function i(t,e){t.each(function(){var t=$(this),i=t.attr("data-month");i<e&&t.addClass("disabled")})}function o(t,e){t.each(function(){var t=$(this),i=t.attr("data-month");i>e&&t.addClass("disabled")})}var s=this.$monthBox.find("li").removeClass("disabled"),n=this;this.minDate&&this.maxDate?(t(s),e(s)):this.minDate?t(s):this.maxDate&&e(s)},DatePicker.prototype.showInit=function(){var t;if(t=this.isInput?$.trim(this.$element.val()):$.trim($.data(this.$element[0],"value")),0!==t.length){var e=/(\d{4}).{1}(\d{2}).{1}(\d{2})/,i=/(\d{2}):(\d{2}):(\d{2})/,o=t.match(e),s=t.match(i);o&&o.length>0&&(this.year=Number(o[1]),this.month=Number(o[2]),this.day=Number(o[3])),s&&s.length>0&&(this.hours=Number(s[1]),this.minutes=Number(s[2]),this.seconds=Number(s[3]))}},DatePicker.prototype.show=function(){$("div.k-pop-panel,ul.k-pop-panel").each(function(){var t=this.getAttribute("data-desktop");t&&"true"==t||$(this).hide()}),this.options.showTime&&!this.isSetTime?(this.setTodayInfo(),this.createDays(),this.setViewInfo(),this.setTime()):(this.showInit(),this.createDays(),this.setViewInfo());var t=this.options.positionProxy();this.$datepicker.show().css(t)},DatePicker.prototype.hide=function(){this.$datepicker.hide(),this.yearBoxToggle(!1),this.monthBoxToggle(!1),this.timePanelHide()},DatePicker.prototype.setValue=function(t){t&&(this.isInput?this.$element.val(t):$.data(this.$element[0],"value",t))},DatePicker.prototype.getValue=function(){return this.isInput?this.$element.val():$.data(this.$element[0],"value")},DatePicker.prototype.setTimePanelPosition=function(t,e){var i={left:t.position().left-1,top:t.position().top-e.outerHeight()};e.show().css(i).siblings("ul").hide(),this.yearBoxToggle(!1),this.monthBoxToggle(!1)},DatePicker.prototype.setTodayInfo=function(){var t=new Date;this.year=t.getFullYear(),this.month=t.getMonth()+1,this.day=t.getDate(),this.hours=t.getHours(),this.minutes=t.getMinutes(),this.seconds=t.getSeconds()},DatePicker.prototype.setViewInfo=function(t,e,i){t=t||this.year,e=e||this.month,i=i||this.day,this.prevToggle(),this.nextToggle(),this.$year.html(t),this.$month.html(dates.months[e-1]),this.$yearBox.find("li").removeClass("cur"),this.$yearBox.find("#li_"+t).addClass("cur").parent().show().siblings().hide(),this.$datepicker.find("tbody td span").removeClass("active"),this.$datepicker.find("#"+t+"_"+e+"_"+i).children().addClass("active"),this.index=this.$yearItems.find("li.cur").parent().show().index()},DatePicker.prototype.setTime=function(){var t=new Date,e=t.getHours(),i=t.getMinutes(),o=t.getSeconds();this.$hours.text(this.isSetTime?this.supStr(this.hours||e):this.supStr(e)),this.$minutes.text(this.isSetTime?this.supStr(this.minutes||i):this.supStr(i)),this.$seconds.text(this.isSetTime?this.supStr(this.seconds||o):this.supStr(o))},DatePicker.prototype.set=function(t){var e=this.getDateValue(t);this.isInput?this.$element.val(e).focus().blur():this.$element.data("value",e),$.map(this.event.selected,function(t){t(e)})},DatePicker.prototype.change=function(t){var e=this.getDateValue(t);$.map(this.event.change,function(t){t(e)})},DatePicker.prototype.getDateValue=function(t){t=t||!1,this.isSetTime=!0;var e=new Date,i=t?e.getFullYear():this.year,o=t?e.getMonth():this.month-1,s=t?e.getDate():this.day,n=t||!this.options.showTime?e.getHours():"undefined"==typeof this.hours?e.getHours():this.hours,a=t||!this.options.showTime?e.getMinutes():"undefined"==typeof this.minutes?e.getMinutes():this.minutes,r=t||!this.options.showTime?e.getSeconds():"undefined"==typeof this.seconds?e.getSeconds():this.seconds,h=new Date(i,o,s,n,a,r),l=this.format(h);return l},DatePicker.prototype.format=function(t,e){t=t||new Date;var i,o,e=e||this.options.format.replace(/"/g,""),s={"y+":t.getFullYear(),"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(i in s)new RegExp("("+i+")").test(e)&&(o=s[i],e=e.replace(RegExp.$1,1===o.toString().length?"0"+o.toString():o));return e},DatePicker.prototype.supStr=function(t){return t=String(t),1===t.length?"0"+t:t},DatePicker.Global=function($elements){$elements=$elements||$(document.body).find('input[data-module="datepicker"]'),$elements.each(function(){var $this=$(this),options=$this.attr("data-options"),format=$this.attr("data-format"),showTime=$this.attr("data-showTime"),minDate=$this.attr("data-minDate"),maxDate=$this.attr("data-maxDate"),position=$this.attr("data-position"),appendTo=$this.attr("data-appendTo"),onSelected=$this.attr("data-onselected"),onClean=$this.attr("data-onclean"),data=$.data($this[0],"datepicker");data||(showTime=!!showTime&&"true"===showTime,onSelected=onSelected&&onSelected.length>0?eval("(0,"+onSelected+")"):null,onClean=onClean&&onClean.length>0?eval("(0,"+onClean+")"):null,options=options&&options.length>0?eval("(0,"+options+")"):{format:format,showTime:showTime,minDate:minDate,maxDate:maxDate,position:position||"left",appendTo:$(appendTo||document.body)},data=new DatePicker($this,options),onSelected&&data.on("selected",onSelected),onClean&&data.on("clean",onClean),$.data($this[0],"datepicker",data))})},DatePicker}),define("km/dragdrop",["jquery"],function(t){var e=1e3,i=[],o={start:function(){if(0!=i.length)for(var t=0;t<i.length;t++)i[t].setInfo()},move:function(t,e){if(0!=i.length)for(var o,s,n,a,r,h=i.length-1;h>=0;h--){if(r=i[h],o=r.info.offset.left-this.$range.offset().left,s=r.info.offset.top-this.$range.offset().top,n=r.info.width,a=r.info.height,o<=e.x+this.dragParms.width/2&&s<=e.y+this.dragParms.height/2&&o+n>=e.x+this.dragParms.width/2&&s+a>=e.y+this.dragParms.height/2){this.overDrop!=r&&(this.overDrop&&this.overDrop.out(this.$layer,e),this.overDrop=r,this.overDrop.over(this.$layer,e));break}this.overDrop&&this.overDrop==r&&(this.overDrop.out(this.$layer,e),this.overDrop=null)}},drop:function(t,e){if(0!=i.length)for(var o,s,n,a,r,h=i.length-1;h>=0;h--)if(r=i[h],o=r.info.offset.left-this.$range.offset().left,s=r.info.offset.top-this.$range.offset().top,n=r.info.width,a=r.info.height,o<=e.x+this.dragParms.width/2&&s<=e.y+this.dragParms.height/2&&o+n>=e.x+this.dragParms.width/2&&s+a>=e.y+this.dragParms.height/2){r.drop(this.$layer,e);break}}},s={getPosition:function(t,e){var i=t.offset(),o=e.offset();return{left:i.left-o.left,top:i.top-o.top,offsetLeft:i.left,offsetTop:i.top}},getOffsetParent:function(t,e){for(var i,o=t.parent(),n={isRoot:!1,left:0,top:0,pLeft:0,pTop:0,$el:null};o[0]!=e[0];){if(i=o.css("position"),"relative"==i||"absolute"==i)return n.left=o.offset().left,n.top=o.offset().top,n.pLeft=n.left-e.offset().left+s.getNum(t.css("marginLeft")),n.pTop=n.top-e.offset().top+s.getNum(t.css("marginTop")),n.$el=o,n.isRoot=!0,n;o=o.parent()}return n},getNum:function(t){var e=parseInt(t);return isNaN(e)?0:e}},n=function(e){this.options=t.extend(!0,{$layer:null,$handle:null,$range:null,$scrollWrap:null,direction:"",resizable:!1,scale:!1,boundary:!1,sortable:!1,minWidth:100,autoScroll:!0,autoScrollDealy:5,zIndex:{increase:!1},callback:{start:t.noop,move:t.noop,stop:t.noop,resize:t.noop}},e),this._event={start:t.noop,move:t.noop,stop:t.noop,resize:t.noop},this.$window=t(window),this.$document=t(document),this.$body=t(document.body),this.$layer=this.options.$layer,this.$handle=this.options.$handle&&this.options.$handle.length>0?this.options.$handle:this.options.$layer,this.$range=this.options.$range,this.$scrollWrap=this.options.$scrollWrap||this.$window,this.autoScrollActive=!1,this.tm=null,this.isResize=!1,this.moving=!1,this.offset={x:0,y:0},this.originalCoord={x:0,y:0},this.resizeParams={left:0,top:0,width:0,height:0,type:"bottomRight"},this.init()};return n.prototype.init=function(){this.$layer&&(this.$range&&this.$range.css("position","relative"),this.$handle.css("cursor","move"),this.options.sortable?this.$layer.css({}):this.$layer.css({position:"absolute",zIndex:e}),this.options.resizable&&(this.$layer.append('<span class="k-resizable k-resizable-topLeft" data-type="topLeft"></span>'),this.$layer.append('<span class="k-resizable k-resizable-topRight" data-type="topRight"></span>'),this.$layer.append('<span class="k-resizable k-resizable-bottomLeft" data-type="bottomLeft"></span>'),this.$layer.append('<span class="k-resizable k-resizable-bottomRight" data-type="bottomRight"></span>'),this.options.scale||(this.$layer.append('<span class="k-resizable k-resizable-topCenter" data-type="topCenter"></span>'),this.$layer.append('<span class="k-resizable k-resizable-leftCenter" data-type="leftCenter"></span>'),this.$layer.append('<span class="k-resizable k-resizable-rightCenter" data-type="rightCenter"></span>'),this.$layer.append('<span class="k-resizable k-resizable-bottomCenter" data-type="bottomCenter"></span>'))),this.setMinSize(),this.eventBind())},n.prototype.setMinSize=function(){var t,e=this.$layer.outerWidth(),i=this.$layer.outerHeight();this.minWidth=this.options.minWidth||e,e>=i?(t=e/i,this.minHeight=this.minWidth/t):(t=i/e,this.minHeight=this.minWidth*t)},n.prototype.eventBind=function(){var i=this;this.$handle.off("mousedown.dragdrop").on("mousedown.dragdrop",function(t){return i.options.zIndex.increase&&e++,i.dragParms={left:parseInt(i.$layer.position().left),top:parseInt(i.$layer.position().top),width:i.$layer.outerWidth(),height:i.$layer.outerHeight()},i.$layer.css({zIndex:e,width:i.dragParms.width}),t.stopPropagation(),t.preventDefault(),i.start(t),document.onselectstart=function(){return!1},!1}).on("mousedown.dragdrop",".k-resizable",function(){i.isResize=!0,i.resizeParams.type=t(this).attr("data-type"),i.resizeParams.left=parseInt(i.$layer.position().left),i.resizeParams.top=parseInt(i.$layer.position().top),i.resizeParams.width=parseInt(i.$layer.outerWidth()),i.resizeParams.height=parseInt(i.$layer.outerHeight()),i.resizeParams.ratio=i.resizeParams.width>=i.resizeParams.height?i.resizeParams.width/i.resizeParams.height:i.resizeParams.height/i.resizeParams.width})},n.prototype.on=function(e,i){return this._event[e]=i||t.noop,this},n.prototype.start=function(e){var i=this;this.isMoving=!0,this.winHeight=this.$scrollWrap.height(),this.docHeight=this.$document.height(),this.$document.on("mousemove.dragdrop",function(t){return i.isMoving&&(i.isResize?i.resize(t):i.move(t)),!1}).on("mouseup.dragdrop",function(t){return i.stop(t),i.$document.off("mousemove.dragdrop"),i.$document.off("mouseup.dragdrop"),!1});var n=this.getMouseCoord(e),a=s.getPosition(this.$layer,this.$range?this.$range:this.$body);return this.offset.x=n.x-a.left,this.offset.y=n.y-a.top,this.offset.click={left:n.x-a.offsetLeft,top:n.y-a.offsetTop},this.offset.parent=s.getOffsetParent(this.$layer,this.$range?this.$range:this.$body),this.originalCoord.x=n.x,this.originalCoord.y=n.y,this.moveCoord={x:0,y:0},this.$handle[0].setCapture&&this.$handle[0].setCapture(),o.start.call(this,e),t.isFunction(this.options.callback.start)&&this.options.callback.start.call(this,e,this.$layer),this._event.start.call(this,e),!1},n.prototype.move=function(e){var i=this.$range,n={right:0,bottom:0},a=this.getMouseCoord(e),r={x:a.x-this.offset.x,y:a.y-this.offset.y};this.options.autoScroll&&(e.clientY<=10||e.clientY>=this.winHeight-10?(e.clientY<=10&&!this.autoScrollActive&&(this.autoScrollActive=!0,this.autoScroll(-1,e.clientY)),e.clientY>=this.winHeight-10&&a.y<this.docHeight+100&&!this.autoScrollActive&&(this.autoScrollActive=!0,this.autoScroll(1,e.clientY))):this.autoScrollActive=!1),this.options.sortable&&(this.$placeholder||(this.$placeholder=t("<div/>"),this.$placeholder.attr("class",this.$layer.attr("class")).addClass("k-sortable-placeholder").css({opacity:"0.5",height:this.dragParms.height,background:"white"}).insertAfter(this.$layer)),this.$layer.css({position:"absolute"}));var h={left:a.x-this.offset.click.left-this.offset.parent.left,top:a.y-this.offset.click.top-this.offset.parent.top};i?(n.right=parseInt(i.outerWidth()-s.getNum(this.$range.css("borderLeftWidth"))-s.getNum(this.$range.css("borderRightWidth"))-this.$layer.outerWidth()),n.bottom=parseInt(i.outerHeight()-s.getNum(this.$range.css("borderTopWidth"))-s.getNum(this.$range.css("borderBottomWidth"))-this.$layer.outerHeight()),this.options.boundary||this.setMoveCoord(r,n,h)):(n.right=parseInt(this.$window.width()-this.$layer.outerWidth()+this.$document.scrollLeft()),n.bottom=parseInt(this.$window.height()-this.$layer.outerHeight()+this.$document.scrollTop()),this.setMoveCoord(r,n,h)),this.moveCoord=r,this.setPosition(r,h),o.move.call(this,e,r),t.isFunction(this.options.callback.move)&&this.options.callback.move.call(this,e,r),this._event.move.call(this,e,r,h)},n.prototype.setMoveCoord=function(t,e,i){t.x<0&&(t.x=0,this.offset.parent.isRoot&&(i.left=-this.offset.parent.pLeft)),t.y<0&&(t.y=0,this.offset.parent.isRoot&&(i.top=-this.offset.parent.pTop)),t.x>e.right&&(t.x=e.right,this.offset.parent.isRoot&&(i.left=parseInt(t.x-this.offset.parent.pLeft))),t.y>e.bottom&&(t.y=e.bottom,this.offset.parent.isRoot&&(i.top=parseInt(t.y-this.offset.parent.pTop)))},n.prototype.autoScroll=function(t,e){var i=this,o=this.$scrollWrap.scrollTop();t<0?o>0?(o-=5,this.$scrollWrap.scrollTop(o)):this.autoScrollActive=!1:e>=this.winHeight-10?(o+=5,this.$scrollWrap.scrollTop(o)):this.autoScrollActive=!1,this.autoScrollActive?this.tm=setTimeout(function(){i.autoScroll(t,e)},this.options.autoScrollDealy):this.tm&&clearTimeout(this.tm)},n.prototype.stop=function(e){this.isMoving=!1,this.isResize=!1,this.autoScrollActive=!1,this.$handle[0].releaseCapture&&this.$handle[0].releaseCapture(),this.options.sortable&&this.$placeholder&&(this.$layer.insertAfter(this.$placeholder).css("position","static"),this.$placeholder.remove(),this.$placeholder=null),o.drop.call(this,e,this.moveCoord),t.isFunction(this.options.callback.stop)&&this.options.callback.stop.call(this,e,this.$layer),this._event.stop.call(this,e)},n.prototype.resize=function(e){var i,o,s=this.getMouseCoord(e),n={x:s.x-this.offset.x,y:s.y-this.offset.y},a=(this.$layer,this.resizeParams),r={left:0,top:0,width:0,height:0},h=this.$range;switch(h?(i=h.outerWidth(),o=h.outerHeight()):(i=this.$window.width()+this.$document.scrollLeft(),o=this.$window.height()+this.$document.scrollTop()),this.resizeParams.type){case"topLeft":r.width=a.width+(a.left-(this.offset.parent.isRoot?s.x-this.offset.click.left-this.offset.parent.left:n.x)),r.width=r.width<this.minWidth?this.minWidth:r.width,r.height=this.getScaleHeight(r.width),r.top=a.top-(r.height-a.height),r.left=a.left-(r.width-a.width),r.left<=-this.offset.parent.pLeft&&(r.left=-this.offset.parent.pLeft,r.width=a.width+this.offset.parent.pLeft+a.left,r.height=this.getScaleHeight(r.width),r.top=a.top-(r.height-a.height)),r.top<=-this.offset.parent.pTop&&(r.top=-this.offset.parent.pTop,r.height=a.height+this.offset.parent.pTop+a.top,r.width=this.getScaleWidth(r.height),r.left=a.left-(r.width-a.width));break;case"topRight":r.left=a.left,r.width=a.width-(this.originalCoord.x-s.x),r.width=r.width<this.minWidth?this.minWidth:r.width,r.height=this.getScaleHeight(r.width),r.width+this.offset.parent.pLeft+r.left>=i&&(r.width=i-this.offset.parent.pLeft-r.left,r.height=this.getScaleHeight(r.width)),r.top=a.top-(r.height-a.height),r.top<=-this.offset.parent.pTop&&(r.top=-this.offset.parent.pTop,r.height=a.height+this.offset.parent.pTop+a.top,r.width=this.getScaleWidth(r.height));break;case"leftCenter":r.top=a.top,r.height=a.height,n.x<=0?(r.left=-this.offset.parent.pLeft,r.width=a.width+this.offset.parent.pLeft+a.left):(r.left=this.offset.parent.isRoot?s.x-this.offset.click.left-this.offset.parent.left:n.x,r.width=a.width+(this.originalCoord.x-s.x)),r.width<=this.minWidth&&(r.width=this.minWidth,r.left=a.left+(a.width-r.width));break;case"rightCenter":r.top=a.top,r.left=a.left,r.height=a.height,r.width=a.width-(this.originalCoord.x-s.x),r.width+this.offset.parent.pLeft+r.left>=i&&(r.width=i-this.offset.parent.pLeft-r.left),r.width<=this.minWidth&&(r.width=this.minWidth);break;case"topCenter":r.top=this.offset.parent.isRoot?s.y-this.offset.click.top-this.offset.parent.top:n.y,r.left=a.left,r.width=a.width,r.height=a.height+(this.originalCoord.y-s.y),r.top<-this.offset.parent.pTop&&(r.top=-this.offset.parent.pTop,r.height=a.height+this.offset.parent.pTop+a.top),r.height<=this.minHeight&&(r.height=this.minHeight,r.top=a.top+(a.height-r.height));break;case"bottomCenter":r.top=a.top,r.left=a.left,r.width=a.width,r.height=a.height-(this.originalCoord.y-s.y),r.height+this.offset.parent.pTop+r.top>=o&&(r.height=o-this.offset.parent.pTop-r.top),r.height<=this.minHeight&&(r.height=this.minHeight);break;case"bottomLeft":r.top=a.top,r.width=a.width+(this.originalCoord.x-s.x),r.width=r.width<this.minWidth?this.minWidth:r.width,r.height=this.getScaleHeight(r.width),r.left=a.left-(r.width-a.width),r.left<=-this.offset.parent.pLeft&&(r.left=-this.offset.parent.pLeft,r.width=a.width+this.offset.parent.pLeft+a.left,r.height=this.getScaleHeight(r.width)),r.height+this.offset.parent.pTop+r.top>=o&&(r.height=o-this.offset.parent.pTop-r.top,r.width=this.getScaleWidth(r.height),r.left=a.left-(r.width-a.width));break;case"bottomRight":r.top=a.top,r.left=a.left,r.width=a.width-(this.originalCoord.x-s.x),r.width=r.width<this.minWidth?this.minWidth:r.width,r.height=this.getScaleHeight(r.width),r.width+this.offset.parent.pLeft+r.left>=i&&(r.width=i-this.offset.parent.pLeft-r.left,r.height=this.getScaleHeight(r.width)),r.height+this.offset.parent.pTop+r.top>=o&&(r.height=o-this.offset.parent.pTop-r.top,r.width=this.getScaleWidth(r.height))}this.$layer.css(r),t.isFunction(this.options.callback.resize)&&this.options.callback.resize.call(this,e,r),this._event.resize.call(this,e,r)},n.prototype.getScaleWidth=function(t,e){return e=e||this.resizeParams.ratio,this.resizeParams.width>=this.resizeParams.height?t*e:t/e},n.prototype.getScaleHeight=function(t,e){return e=e||this.resizeParams.ratio,this.resizeParams.width>=this.resizeParams.height?t/e:t*e},n.prototype.getMouseCoord=function(t){return{x:t.pageX||t.clientX+document.body.scrollLeft-document.body.clientLeft,y:t.pageY||t.clientY+document.body.scrollTop-document.body.clientTop}},n.prototype.setPosition=function(t,e){var i,o;"h"===this.options.direction?this.$layer.css("left",this.offset.parent.isRoot?e.left:t.x):"v"===this.options.direction?this.$layer.css("top",this.offset.parent.isRoot?e.top:t.y):(i=this.offset.parent.isRoot?e.left:t.x-s.getNum(this.$layer.css("marginLeft")),o=this.offset.parent.isRoot?e.top:t.y-s.getNum(this.$layer.css("marginTop")),this.$layer.css({left:i,top:o}))},n.prototype.destory=function(){this._event={start:t.noop,move:t.noop,stop:t.noop,resize:t.noop},this.$handle.css("cursor","default").off("mousedown.dragdrop"),this.$layer.css("cursor","default").find(".k-resizable").remove()},n.droppable=function(e,o){var n=function(e,i){this.$drop=e,this.options=t.extend(!0,{overClass:"droppable-over",callback:{over:t.noop,out:t.noop,drop:t.noop}},i),this.setInfo()};n.prototype.setInfo=function(){var t=this.$drop.offset(),e=this.$drop.position();this.info={width:this.$drop.outerWidth()+s.getNum(this.$drop.css("borderLeftWidth"))+s.getNum(this.$drop.css("borderRightWidth")),height:this.$drop.outerHeight()+s.getNum(this.$drop.css("borderTopWidth"))+s.getNum(this.$drop.css("borderBottomWidth")),offset:{left:t.left,top:t.top},position:{left:e.left,top:e.left}}},n.prototype.over=function(t,e){this.$drop.addClass(this.options.overClass),this.options.callback.over.call(this,t,e)},n.prototype.out=function(t,e){this.$drop.removeClass(this.options.overClass),this.options.callback.out.call(this,t,e)},n.prototype.drop=function(t,e){this.options.callback.drop.call(this,t,e)},e=e||t("[data-module=droppable]"),e.each(function(){var e=t(this),s=t.data(e[0],"droppable");s||(s=new n(e,o),t.data(e[0],"droppable",s),i.push(s))})},n.sortable=function(e,i){var o,a,r=[],h=[],l=!1,a={_getInfo:function(t){var e=t.offset(),i=t.position(),o=t.outerWidth(),s=t.outerHeight();return{offset:{left:e.left,top:e.top},position:{left:i.left,top:i.top},width:o,height:s,h_half:e.left+o/2,v_half:e.top+s/2}},_setGroupInfo:function(e){if(e&&0!=e.length)for(var o,n,r,h=0;h<e.length;h++)o=[],n=[],r=e[h],r.offset={left:r.$group.offset().left,top:r.$group.offset().top,width:r.$group.outerWidth()+s.getNum(r.$group.css("borderLeftWidth"))+s.getNum(r.$group.css("borderRightWidth")),height:r.$group.outerHeight()+s.getNum(r.$group.css("borderTopWidth"))+s.getNum(r.$group.css("borderBottomWidth"))},r.$draggable=r.$group.find(i.draggable).each(function(){var e=t(this),i=a._getInfo(e);i.$drag=e,o.push(i)}),r.$droppable=r.$group.find(i.droppable).each(function(){var e=t(this),i=a._getInfo(e);i.$drop=e,n.push(i)}),r.draggableInfo=o,r.droppableInfo=n},_setSortableInfo:function(t){for(var e,i=0;i<h.length;i++)e=h[i],t&&(e.sortNum=i),e.info=a._getInfo(e.$layer)}};return i=t.extend(!0,{$scrollWrap:null,draggable:".k-draggable",droppable:".k-droppable",group:".k-sortable-group",handle:null,boundary:!1,model:"default",direction:"",callback:{init:t.noop,start:t.noop,move:t.noop,stop:t.noop}},i),o=e.find(i.group),0==o.length&&(o=e),o.each(function(){var o=t(this),s=o.find(i.draggable),p=o.find(i.droppable);s.each(function(){var o=t(this),s=o.find(i.handle);sortable=new n({$scrollWrap:i.$scrollWrap,$range:e,$layer:o,$handle:s.length>0?s:null,sortable:!0,boundary:i.boundary,direction:i.direction}),sortable.on("start",function(t){i.callback.start.call(this,t,o)}).on("move",function(t,e,s){for(var n,p=this.getMouseCoord(t),d=0;d<r.length;d++)if(n=r[d],p.y>=n.offset.top&&p.y<=n.offset.top+n.offset.height&&p.x>=n.offset.left&&p.x<=n.offset.left+n.offset.width){for(var c,u=0;u<n.droppableInfo.length;u++)if(c=n.droppableInfo[u],p.y>=c.offset.top+c.height&&p.x>=c.offset.left&&p.x<=c.offset.left+c.width&&0==c.$drop.find(".k-sortable-placeholder").length)return c.$drop.append(this.$placeholder),a._setGroupInfo(r),a._setSortableInfo(),void i.callback.move.call(this,t,o);for(var f,m,g=0;g<h.length;g++)if(m=h[g],m!=this&&p.x>=m.info.offset.left&&p.x<=m.info.offset.left+m.info.width&&p.y>=m.info.offset.top&&p.y<=m.info.offset.top+m.info.height){if(this.dragParms.height<m.info.height){if(p.y>=m.info.offset.top&&p.y<=m.info.v_half){if(l=this.$placeholder.next()[0]==m.$layer[0],this.$placeholder.insertBefore(m.$layer),l)return}else if(l=this.$placeholder.prev()[0]==m.$layer[0],this.$placeholder.insertAfter(m.$layer),l)return}else if(this.dragParms.width<m.info.width&&"float"==i.mode){if(p.x>=m.info.offset.left&&p.x<=m.info.h_half){if(l=this.$placeholder.next()[0]==m.$layer[0],this.$placeholder.insertBefore(m.$layer),l)return}else if(l=this.$placeholder.prev()[0]==m.$layer[0],this.$placeholder.insertAfter(m.$layer),l)return}else this.sortNum>m.sortNum?this.$placeholder.insertBefore(m.$layer):this.$placeholder.insertAfter(m.$layer),f=this.sortNum,this.sortNum=m.sortNum,m.sortNum=f;return a._setGroupInfo(r),a._setSortableInfo(),void i.callback.move.call(this,t,o)}return void i.callback.move.call(this,t,o)}}).on("stop",function(t){this.$layer.css("width","auto"),l=!1,a._setGroupInfo(r),a._setSortableInfo(!0),i.callback.stop.call(this,t,o)}),h.push(sortable),i.callback.init.call(this,sortable)}),r.push({$group:o,$draggable:s,$droppable:p})}),a._setGroupInfo(r),a._setSortableInfo(!0),{getGroups:function(){return r},getSortables:function(){return h},setInfo:function(){a._setGroupInfo(r),a._setSortableInfo(!0)},removeSortable:function(t){for(var e=-1,i=0;i<h.length;i++)if(h[i]==t){e=i;break}e!=-1&&(h[e].$layer.remove(),h.splice(e,1),a._setGroupInfo(r),a._setSortableInfo(!0))},removeSortables:function(t){if(0!=t.length){for(var e=[],i=!1,o=0;o<h.length;o++){i=!1;for(var s=0;s<t.length;s++)if(h[o]==t[s]){i=!0;break}i||e.push(h[o])}h=e,a._setGroupInfo(r),a._setSortableInfo(!0)}},removeGroup:function(t){if(t&&0!=t.length){for(var e=-1,i=0;i<r.length;i++)if(t[0]==r[i].$group[0]){e=i;break}e!=-1&&r.splice(e,1)}},destory:function(){for(var t=0;t<h.length;t++)h[t].destory(),h[t]=null;h=[]}}},n}),define("km/dropDownList",["jquery"],function($){var DropDownList=function(t,e){this.$el=t,this.options=$.extend(!0,{$target:null,bindElement:null,direction:"left",width:"auto",zIndex:20},e),this._event={select:$.noop},this.init()};return DropDownList.prototype.init=function(){var t=this.$el.parent().children(".k-dropDownList");0!=t.length&&(this.isInputGroup=this.$el.hasClass("input-group")||this.$el.hasClass("k-input-group"),this.isTextBox=!this.isInputGroup&&"text"==this.$el[0].type,this.$el.parent().css("position","relative"),this.$dropDownList=t.addClass("k-pop-panel").css("z-index",this.options.zIndex),this.$bindElement=$(this.options.bindElement),this.$hidden=this.$dropDownList.next("input:hidden"),this.$body=$(document.body),this.isInputGroup&&this.$el.find("input").attr("readonly","readonly"),this.watch())},DropDownList.prototype.watch=function(){var t=this;this.$el.on("click.dropdownlist",function(e){return $("ul.k-dropDownList").hide(),t.show(e),e.stopPropagation(),!1}),this.$dropDownList.on("click.dropdownlist","li",function(e){var i=$(this),o=i.attr("data-text"),s=i.attr("data-value"),n={text:o||"",value:s||""};t.isTextBox&&(t.$el.val(n.text).focus().blur(),i.addClass("active").siblings().removeClass("active")),t.isInputGroup&&(t.$el.find("input").val(n.text).focus().blur(),
i.addClass("active").siblings().removeClass("active")),t.$bindElement&&t.$bindElement.val(n.text).focus().blur(),t.$hidden.length>0&&t.$hidden.val(n.value),t._event.select.call(t,i,n)}),$(document).on("click.dropdownlist",function(){t.hide()}),$(window).on("resize.dropdownlist",function(){try{t.sysPosition()}catch(e){}})},DropDownList.prototype.on=function(t,e){return this._event[t]=e||$.noop,this},DropDownList.prototype.show=function(t){$("div.k-pop-panel,ul.k-pop-panel").hide(),this.$dropDownList.show(),this.sysPosition(t)},DropDownList.prototype.hide=function(){this.$dropDownList.hide()},DropDownList.prototype.sysPosition=function(t,e){var i={left:0,top:0,width:"100%"==this.options.width?this.$el.outerWidth():this.options.width};switch(this.$dropDownList.css("width",i.width),this.options.direction){case"left":i.left=this.$el.position().left,i.top=this.$el.position().top+this.$el.outerHeight(!0)+2;break;case"right":i.left=this.$el.position().left+this.$el.outerWidth(!0)-this.$dropDownList.outerWidth(),i.top=this.$el.position().top+this.$el.outerHeight(!0)+2;break;case"left up":i.left=this.$el.position().left,i.top=this.$el.position().top-this.$dropDownList.outerHeight(!0);break;case"right up":i.left=this.$el.position().left+this.$el.outerWidth(!0)-this.$dropDownList.outerWidth(),i.top=this.$el.position().top-this.$dropDownList.outerHeight();break;case"mouse":if(t){var o=this.getElmPosition();i.left=t.pageX-o.left,i.top=t.pageY-o.top}else i.display="none";break;default:i.left=this.$el.position().left,i.top=this.$el.position().top+this.$el.outerHeight(!0)+2}this.$dropDownList.css(i)},DropDownList.prototype.getElmPosition=function(){for(var t,e={left:0,top:0,pLeft:0,pTop:0},i=this.$body,o=this.$el,s=o.parent();s[0]!=i[0];){if(t=s.css("position"),"relative"==t||"absolute"==t)return e.left=s.offset().left,e.top=s.offset().top,e;s=s.parent()}return e},DropDownList.Global=function($elms,options){$elms=$elms||$("[data-module=dropdownlist]"),$elms.each(function(){var $el=$(this),settings=$el.attr("data-options"),onSelect=$el.attr("data-onselect"),data=$.data($el[0],"dropdownlist");data||(settings&&settings.length>0&&(settings=eval("(0,"+settings+")")),options=options?$.extend(!0,options,settings||{}):settings,onSelect&&onSelect.length>0&&(onSelect=eval("(0,"+onSelect+")")),data=new DropDownList($el,options),data.on("select",onSelect),$.data($el[0],"dropdownlist",data))})},DropDownList}),define("km/dropDownTree",["jquery","km/tree"],function($,Tree){var identity=1,DropDownTree=function(t,e){this.identity=identity++,this.$elm=t,this.options=$.extend(!0,{data:[],url:null,width:null,height:200,zIndex:999,appendTo:$(document.body),isTree:!0,multiple:!1,inputGroup:".k-input-group",bindElement:null,callback:{select:$.noop,check:$.noop,hide:$.noop}},e),this.tm=null,this.$treePanel=$('<div class="k-dropDownTree k-pop-panel"></div>'),this.init()};return DropDownTree.prototype.init=function(){var self=this;(this.options.url&&0!=this.options.url.length||this.options.data&&0!=this.options.data.length)&&(this.$bindElement=$(this.options.bindElement),this.$inputGroup=this.$elm.parent(this.options.inputGroup),this.$elm.attr("readonly","readonly"),this.$elm.attr("data-moduleId",this.identity),this.elmWidth=this.$elm.outerWidth(),this.$treePanel.css({width:this.options.width||this.$inputGroup.outerWidth()||this.elmWidth,height:this.options.height,zIndex:this.options.zIndex}).appendTo(this.options.appendTo),this.options.isTree||(this.options.view={showLine:!1,showIcon:!1},this.$treePanel.addClass("k-dropDownTree-list")),this.options.multiple&&(this.options.check={enable:!0,chkType:"checkbox",chkBoxType:{Y:"",N:""}}),this.options.callback.onCheck=function(t){self.check(t)},this.options.callback.onSelect=function(t){self.select(t)},this.options.url?$.get(this.options.url,{value:this.$bindElement&&this.$bindElement.length>0?this.$bindElement.val():this.$elm.val(),rand:Math.random()},function(data){"string"==typeof data&&(data=eval("(0,"+data+")")),self.options.data=data,self.tree=new Tree(self.$treePanel,self.options),self.watch()}):(this.tree=new Tree(this.$treePanel,this.options),this.watch()))},DropDownTree.prototype.watch=function(){var t=this;this.$elm.on("click.dropDownTree",function(e){return t.show(),!1}),this.$inputGroup.on("click.dropDownTree","button",function(e){return t.show(),!1}),$(document).on("click.dropDownTree."+this.identity,function(e){var i=$(e.target);i.hasClass("k-dropDownTree")||i.parents(".k-dropDownTree").length>0||t.hide()}),$(window).on("resize.dropDownTree."+this.identity,function(){t.tm&&clearTimeout(t.tm),t.tm=setTimeout(function(){t.setPosition()},300)})},DropDownTree.prototype.select=function(t){return this.options.multiple?void this.tree.$tree.find("a.selected").removeClass("selected"):(this.$bindElement&&this.$bindElement.val(t.value||t.nodeId||t.text),this.$elm.val(t.text).attr("title",t.text).focus().blur(),this.options.callback.select(t),void this.hide())},DropDownTree.prototype.check=function(t){for(var e=this.tree.getCheckedNodes(),i=[],o=[],s=0;s<e.length;s++)o.push(e[s].text),i.push(e[s].value||e[s].nodeId||e[s].text);this.$bindElement&&this.$bindElement.val(i.join(",")),this.$elm.val(o.join(",")).attr("title",o.join(",")).focus().blur(),this.options.callback.check(e)},DropDownTree.prototype.setPosition=function(){this.$treePanel.css({left:this.$elm.offset().left,top:this.$elm.offset().top+this.$elm.outerHeight()+2,width:this.options.width||this.$inputGroup.outerWidth()||this.elmWidth})},DropDownTree.prototype.show=function(){"block"!=this.$treePanel[0].style.display&&($("div.k-pop-panel,ul.k-pop-panel").hide(),this.$treePanel.show(),this.setPosition())},DropDownTree.prototype.hide=function(){"block"==this.$treePanel[0].style.display&&this.options.callback.hide(),this.$treePanel.hide()},DropDownTree.Destory=function(t){t=t||"";var e=t?"resize.dropDownTree."+t:"resize.dropDownTree";$(window).off(e)},DropDownTree.Global=function($elms){$elms=$elms||$("input[data-module=dropdowntree]"),$elms.each(function(){var $elm=$(this),options=$elm.attr("data-options"),url=$elm.attr("data-url"),width=$elm.attr("data-width"),height=$elm.attr("data-height"),zIndex=$elm.attr("data-zIndex"),appendTo=$elm.attr("data-appendTo"),isTree=$elm.attr("data-isTree")||!0,multiple=$elm.attr("data-multiple")||!1,array=$elm.attr("data-data"),callback=$elm.attr("data-callback"),bindElm=$elm.attr("data-bindelement")||null,data;data=$.data($elm[0],"dropDownTree"),data||(options=options&&options.length>0?eval("(0,"+options+")"):{data:eval(array),url:url,width:width&&width.length>0?parseInt(width):null,height:height&&height.length>0?parseInt(height):200,zIndex:zIndex&&zIndex.length>0?parseInt(zIndex):999,appendTo:$(appendTo||document.body),isTree:!isTree||"false"!=isTree,multiple:!(!multiple||"true"!=multiple),$bindElement:$(bindElm),callback:callback&&callback.length>0?eval("(0,"+callback+")"):{}},data=new DropDownTree($elm,options),$.data($elm[0],"dropDownTree",data))})},DropDownTree}),define("km/event",[],function(){var t=function(){this.topics={},this.subId=-1};return t.prototype.on=function(t,e){this.topics[t]||(this.topics[t]=[]);var i=(++this.subId).toString();return this.topics[t].push({token:i,func:e}),this},t.prototype.off=function(t){if(!t)return this.subId=-1,this.topics={},this;if(/^\d+$/.test(t)){for(var e in this.topics)if(this.topics[e])for(var i=0,o=this.topics[e].length;i<o;i++)if(this.topics[e][i].token===t)return this.topics[e].splice(i,1),this}else this.topics[t]&&delete this.topics[t];return this},t.prototype.trigger=function(t,e){if(this.topics[t])for(var i=this.topics[t],o=i?i.length:0,s=0;s<o&&i[s];)i[s].func(e),s++},t}),define("km/focusMap",["jquery"],function(t){var e=function(e,i){this.$el=e,this.options=t.extend(!0,{containerWidth:null,width:600,height:300,delay:3e3},i),this.tm=null,this.isStop=!1,this.index=0,this.init()};return e.prototype.init=function(){this.winWidth=t(window).width(),this.winWidth<this.options.width&&(this.options.width=this.winWidth,this.options.height="auto"),this.$el.css({width:this.options.containerWidth||this.options.width,height:this.options.height}),this.$ul=this.$el.find("ul"),this.$lis=this.$ul.find("li"),1!=this.$lis.length&&(this.$ul.append(this.$lis.eq(0).clone(!0)),this.$ul.prepend(this.$lis.eq(this.$lis.length-1).clone(!0)),this.$lis=this.$ul.find("li").width(this.options.width),this.total=this.$lis.length,this.max=this.total-2,this.$ul.width(this.total*this.options.width).css("marginLeft",-(this.index+1)*this.options.width),this.$lis.show(),this.create(),this.watch(),this.max>1&&(this.$el.append('<div class="k-focusmap-prev"><</div><div class="k-focusmap-next">></div>'),this.run()))},e.prototype.create=function(){var t=[],e=16*this.max/2;t.push('<div class="k-focusmap-dot" style="margin-left:-'+e+'px;">');for(var i=0;i<this.max;i++)t.push('<span class="'+(0==i?"current":"")+'"></span>');t.push("</div>"),this.$el.append(t.join("")),this.$dots=this.$el.find(".k-focusmap-dot span")},e.prototype.watch=function(){var e=this;this.isWatch||(this.isWatch=!0,this.$el.on("mouseenter.focusmap",function(){e.stop()}).on("mouseleave.focusmap",function(){e.run()}).on("click.focusmap",".k-focusmap-prev",function(){e.index--,e.active()}).on("click.focusmap",".k-focusmap-next",function(){e.index++,e.active()}).on("click.focusmap","span",function(){var i=t(this),o=i.index();e.index=o,e.active()}))},e.prototype.run=function(){var t=this;this.isStop=!1,this.tm=setTimeout(function(){t.index++,t.active(function(){t.isStop||t.run()})},this.options.delay)},e.prototype.stop=function(){this.tm&&(clearTimeout(this.tm),this.isStop=!0)},e.prototype.active=function(t){var e=this,i=this.index+1;this.index==this.max&&(this.index=0),this.index<0&&(this.index=this.max-1),this.$ul.stop().animate({marginLeft:-i*this.options.width},function(){i==e.total-1&&e.$ul.css("marginLeft",-1*e.options.width),0==i&&e.$ul.css("marginLeft",-e.max*e.options.width),e.$dots.removeClass("current").eq(e.index).addClass("current"),"function"==typeof t&&t()})},function(t,i){var o=new e(t,i);return o}}),define("km/highlight",["jquery"],function(t){var e={},i=t(document.body),o="k-highlight";return e.highlightHtml=function(t,e,o){"object"!=typeof t&&(o=e,e=t,t=i);var s=this.highlightText(t.html(),e,o);t.html(s)},e.highlightText=function(e,i,s){if(!e||0===e.length)return"";if(e=this.highlightClean(e,s),s=s||o,!i)return e;if(t.isArray(i)||(i=[i]),1===i.length&&0===t.trim(i[0]).length)return e;for(var n=e.match(/[^<>]+|<(\/?)([A-Za-z]+)([^<>]*)>/g),a=0;a<n.length;a++)/<[^>]+>/.test(n[a])||0==t.trim(n[a]).length||(n[a]=n[a].replace(new RegExp("("+i.join("|")+")","ig"),'<span class="'+s+'">$1</span>'));return n.join("")},e.highlightClean=function(t,e){e=e||o;var i=new RegExp('<span class="?'+e+'"?>(.*?)</span>',"ig");return t=t.replace(i,"$1")},e}),define("km/imgPreview",["jquery","km/loading","km/popTips"],function(t,e,i){var o=function(e,i){this.$elements=e,this.options=t.extend(!0,{delay:500,showButtons:!0,backdrop:!0,backdropClose:!0,tpl:'<div class="k-imgPreview"><div class="k-container"><span class="close" role="close"><i class="fa fa-close"></i></span><span class="prev" role="prev"><i class="fa fa-chevron-left"></i></span><span class="next" role="next"><i class="fa fa-chevron-right"></i></span><img src="" /></div><p class="description"></p></div>'},i),this.$win=t(window),this.isLoading=!1,this.index=0,this.init()};return o.prototype.init=function(){0!==this.$elements.length&&(this.$imgPreview=t(this.options.tpl).appendTo(document.body),this.$container=this.$imgPreview.find(".k-container"),this.$img=this.$container.find("img"),this.$prev=this.$container.find(".prev"),this.$next=this.$container.find(".next"),this.$backdrop=t("<div/>").addClass("k-imgPreview-backdrop").appendTo(document.body),this.$elements.css("cursor","pointer").each(function(e){var i=t(this),o="imgPreview_"+e;this.id=o,i.attr("data-index",e)}),this.eventBind())},o.prototype.eventBind=function(){var e=this;this.$elements.on("click.imgpreview",function(){var i=t(this);e.index=Number(i.attr("data-index")),e.show()}),this.$backdrop.on("click.imgpreview",function(){e.options.backdropClose&&e.hide()}),this.$imgPreview.on("click.imgpreview","[role=close]",function(){e.hide()}).on("click.imgpreview","[role=prev]",function(){e.isLoading||0!==e.index&&(e.index--,e.showControls(),e.show())}).on("click.imgpreview","[role=next]",function(){e.isLoading||e.index>=e.$elements.length-1||(e.index++,e.showControls(),e.show())}).on("mouseenter.imgpreview",function(){e.showControls()}).on("mouseleave.imgpreview",function(){e.$prev.hide(),e.$next.hide()}),this.$win.on("resize.imgpreview",function(){var t=parseInt(e.$img.attr("data-width")),i=parseInt(e.$img.attr("data-height"));e.tm&&clearTimeout(e.tm),e.isShow&&(e.tm=setTimeout(function(){e.setPosition({width:t,height:i})},300))})},o.prototype.showControls=function(){var t=this.$elements.length;1!==t&&(0===this.index?(this.$prev.hide(),this.$next.show()):this.index>=t-1?(this.$prev.show(),this.$next.hide()):(this.$prev.show(),this.$next.show()))},o.prototype.imgLoad=function(t,e){var o=new Image;o.onload=function(){e(!0,{width:o.width,height:o.height})},o.onerror=function(){i.error("图片加载失败！",1500),e(!1,{width:0,height:0})},o.src=t},o.prototype.getMaxSize=function(){return{width:this.$win.width()-100,height:this.$win.height()-100}},o.prototype.zoom=function(t,e){var i,o,s=this.getMaxSize();return t<s.width&&e<s.height?{width:t,height:e}:(t>=e?(i=t/e,o=s.width/i):(i=e/t,o=s.width*i),nw=s.width,o>s.height&&(o=s.height,nw=t/e*o),{width:nw,height:o})},o.prototype.show=function(){var t,i=this,o=this.$elements.eq(this.index);0!==o.length&&(t=o.attr("data-href")||o.attr("src"),t&&!this.isLoading&&(this.isShow=!0,this.isLoading=!0,e.show(),this.imgLoad(t,function(o,s){o?(i.$img.attr({src:t,"data-width":s.width,"data-height":s.height}),i.options.backdrop&&"block"!=i.$backdrop[0].style.display&&i.$backdrop.css({opacity:0,display:"block"}).stop().animate({opacity:.8},i.options.delay),i.setPosition(s)):i.hide(),e.hide(),i.isLoading=!1})))},o.prototype.hide=function(){this.isLoading=!1,e.hide(),this.isShow=!1,this.$imgPreview.fadeOut(this.options.delay),this.options.backdrop&&this.$backdrop.fadeOut(this.options.delay)},o.prototype.setPosition=function(t){var e=(this.$win.width(),this.$win.height(),t.width),i=t.height,o=this.zoom(e,i);this.$container.show().stop().animate({width:o.width,height:o.height}),this.$imgPreview.show().stop().animate({width:o.width+20,height:o.height+20,marginTop:-((o.height+20)/2),marginLeft:-((o.width+20)/2)})},o.prototype.destory=function(){this.$elements.off(),this.$backdrop.off().remove(),this.$imgPreview.off().remove()},function(e,i){if(e=e||t("img"),0==e.length)return null;var s=new o(e,i);return s}}),define("km/infiniteScroll",["jquery"],function(t){var e=function(e){var i=this;this.options=t.extend(!0,{$scrollElement:t(window),$watchElement:null,scrollDistance:.3,callback:t.noop},e),this.$scrollElement=this.options.$scrollElement,this.$watchElement=this.options.$watchElement,this.$watchElement&&(this.top=this.$watchElement.position().top,this.$scrollElement.on("scroll.infiniteScroll",function(){i.scroll()}),this.scroll())};return e.prototype.scroll=function(){var t=this.$scrollElement.height(),e=t+this.$scrollElement.scrollTop(),i=this.top+this.$watchElement.height(),o=i-e,s=o<=t*this.options.scrollDistance;s&&this.options.callback()===!1&&this.destroy()},e.prototype.destroy=function(){this.$scrollElement.off("scroll.infiniteScroll")},e}),define("km/lang",["KMLang","km/cache"],function(t,e){var i={},o="KMLANG",s="zh-cn";return i.set=function(i){var o=t[i];o||(o=t[s]),e.set(o),window.KMLang=o},i.get=function(){return window.KMLang||(window.KMLang=t[s]),window.KMLang},i.init=function(){var i=e.get(o);i||(i=t[s],window.KMLang=i)},i.init(),i}),define("km/layout",["jquery","km/panel","km/cache"],function($,Panel,cache){var Layout=function(t,e){this.$layout=t,this.options=$.extend(!0,{cache:!1,resizeMin:5,panel:{left:{width:100},top:{height:100},right:{width:100},bottom:{height:100}}},e),this.$parent=this.$layout.parent(),this.init(),this._event={show:$.noop,hide:$.noop}};return Layout.prototype.init=function(){var t=this;this.$win=$(window),this.$panels=this.$layout.children(".k-panel"),this.$leftPanel=this.$panels.filter(".k-panel-left"),this.$topPanel=this.$panels.filter(".k-panel-top"),this.$rightPanel=this.$panels.filter(".k-panel-right"),this.$bottomPanel=this.$panels.filter(".k-panel-bottom"),this.$centerPanel=this.$panels.filter(".k-panel-center"),this.$panels.each(function(){var e=$(this),i=e.attr("data-type"),o=$(t.getExpandHtml(i)).appendTo(t.$layout);$.data(e[0],"expand",o)}),this.setSize(),this.panelInit(),this.watch()},Layout.prototype.panelInit=function(){var t=this;this.$panels.each(function(){var e=$(this).show(),i=e.attr("data-type"),o=e.attr("data-resizable"),s=t.options.resizeMin,n={resizable:{enabled:!o||"true"==o,cover:!0,border:{left:!1,top:!1,right:!1,bottom:!1},callback:{stop:function(){t.$centerPanel.length>0?t.$centerPanel.resize():t.setSize()}}},width:e.width(),height:e.height()};switch(i){case"top":n.minHeight=s,n.resizable.border.bottom=!0;break;case"left":n.minWidth=s,n.resizable.border.right=!0;break;case"right":n.minWidth=s,n.resizable.border.left=!0;break;case"bottom":n.minHeight=s,n.resizable.border.top=!0}var a=new Panel(e,n);$.data(e[0],"panel",a)})},Layout.prototype.watch=function(){var t=this;this.$win.on("resize.layout",function(){t.setSize()}),this.$panels.on("click.layout","span[role=hide]",function(){return t.hide($(this).attr("data-type")),!1}),this.$layout.on("click.layout","span[role=show]",function(){return t.show($(this).attr("data-type")),!1})},Layout.prototype.on=function(t,e){return this._event[t]=e||$.noop,this},Layout.prototype.show=function(t){var e,i=this,o=this.getPanelsInfo(),s=o[t],n=s.$panel.attr("data-isHide",!1),a=s.$expand;switch(a.hide(),n.show(),t){case"top":e={top:0};break;case"left":e={left:0};break;case"right":e={right:0};break;case"bottom":e={bottom:0}}n.stop().animate(e,function(){i.setSize(),i.$centerPanel&&i.$centerPanel.resize()}),this._event.show.call(this,s)},Layout.prototype.hide=function(t){var e,i=this,o=this.getPanelsInfo(),s=o[t];switch(s.$panel.attr("data-isHide",!0),i.setSize(),i.$centerPanel&&i.$centerPanel.resize(),t){case"top":e={top:-s.height};break;case"left":e={left:-s.width};break;case"right":e={right:-s.width},s.$panel.css("right",0);break;case"bottom":e={bottom:-s.height},s.$panel.css("bottom",0)}s.$panel.stop().animate(e,function(){s.$panel.hide(),s.$expand.show(),i._event.hide.call(i,s)})},Layout.prototype.getExpandHtml=function(t){var e="",i="";switch(t){case"left":e="panel-expand panel-expand-left",i="fa fa-angle-double-right";break;case"top":e="panel-expand panel-expand-top",i="fa fa-angle-double-down";break;case"right":e="panel-expand panel-expand-right",i="fa fa-angle-double-left";break;case"bottom":e="panel-expand panel-expand-bottom",i="fa fa-angle-double-up"}return'<div class="'+e+'"><span class="'+i+'" role="show" data-type="'+t+'"></span></div>'},Layout.prototype.setSize=function(){var t=this.$parent,e=t.width(),i=t.height(),o=this.getPanelsInfo(),s=0,n=0,a=0,r=0;"body"==t[0].tagName.toLowerCase()&&(t.addClass("k-layout-body"),i=this.$win.height()),this.$layout.css({width:e,height:i}),o.top&&(o.top.$panel.css({height:o.top.height,width:"100%"}),o.top.setBodyHeight(),r+=o.top.isHide?o.top.expandHeight:o.top.height),s+=r,o.bottom&&(o.bottom.$panel.css({height:o.bottom.height,width:"100%",top:"none"}),o.bottom.setBodyHeight(),o.bottom.isHide?(o.bottom.$panel.css("bottom",-o.bottom.height),r+=o.bottom.expandHeight):(o.bottom.$panel.css("bottom",0),r+=o.bottom.height)),r=i-r,o.left&&(o.left.$panel.css({width:o.left.width,top:s,height:r}),o.left.setBodyHeight(),o.left.$expand.css({top:s,height:r}),o.left.isHide?(a+=o.left.expandWidth,n+=a):(a+=o.left.width,n+=a)),o.right&&(o.right.$panel.css({width:o.right.width,top:s,height:r,left:"none"}),o.right.setBodyHeight(),o.right.$expand.css({top:s,height:r}),o.right.isHide?(o.right.$panel.css("right",-o.right.width),a+=o.right.expandWidth):(o.right.$panel.css("right",0),a+=o.right.width)),o.center&&(a=e-a,o.center.$panel.css({top:s,left:n,width:a,height:r}),o.center.setBodyHeight())},Layout.prototype.getPanelsInfo=function(t){var e={};return this.$panels.each(function(){var t=$(this),i=$.data(t[0],"expand"),o=$.data(t[0],"panel"),s=t.attr("data-type");e[s]={left:t.position().left,top:t.position().top,width:t.outerWidth(),height:t.outerHeight(),isHide:"true"==t.attr("data-ishide"),$panel:t,$expand:i,panel:o,expandWidth:i.outerWidth(),expandHeight:i.outerHeight(),setBodyHeight:function(){o&&o.setBodyHeight()}}}),t?e[t]:e},Layout.Global=function($elms){$elms=$elms||$("div[data-module=layout]"),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),onShow=$el.attr("data-onshow"),onHide=$el.attr("data-onhide"),data=$.data($el[0],"layout");data||(options&&options.length>0&&(options=eval("(0,"+options+")")),onShow=onShow&&onShow.length>0?eval("(0,"+onShow+")"):$.noop,onHide=onHide&&onHide.length>0?eval("(0,"+onHide+")"):$.noop,data=new Layout($el,options),data.on("show",function(t){onShow.call(this,t)}).on("hide",function(t){onHide.call(this,t)}),$.data($el[0],"layout",data))})},Layout}),define("km/lazyload",["jquery"],function(t){function e(e,i){this.$elements=e,this.options=t.extend(!0,{placeholder:null,$container:t(window),callback:t.noop},i),this.cache=[],this.init()}return e.prototype.init=function(){var e=this;this.$elements.each(function(){if("img"==this.nodeName.toLowerCase()&&"true"!=this.getAttribute("hasLoad")){var i=t(this),o={};null!=e.options.placeholder&&(this.setAttribute("data-url",this.src),this.src=e.options.placeholder),this.getAttribute("data-url")&&(o.$elm=i,o.url=this.getAttribute("data-url"),e.cache.push(o))}}),0!==this.cache.length&&(this.count=this.cache.length,this.eventBind(),this.load())},e.prototype.eventBind=function(){this.options.$container.on("scroll.lazyload",t.proxy(this.load,this))},e.prototype.load=function(){var e=this,i=this.getPosition();this.count<=0||t.each(this.cache,function(t,o){var s,n,a=o.$elm,r=o.url;o.tag;a&&(n=a.offset().top,s=[n-i.top,n-i.top+a.height()],(s[0]>=0&&s[0]<i.height||s[1]>0&&s[1]<=i.height)&&(!function(t,i){e.imgLoad(t,i,function(){t.hide().fadeIn(),e.callback(t)})}(a,r),o.$elm=null,e.count--))})},e.prototype.imgLoad=function(t,e,i){var o=new Image;o.onload=function(){t.attr("src",e),t.attr("hasLoad",!0),i()},o.onerror=function(){i()},o.src=e},e.prototype.getPosition=function(){var t,e={},i=this.options.$container,o=i.height();return t=i[0]===window?i.scrollTop():i.offset().top,e.height=o,e.top=t,e},e.prototype.callback=function(e){t.isFunction(this.options.callback)&&this.options.callback(e)},function(i,o){return i=i||t("img"),new e(i,o)}}),define("km/loading",["jquery","spin"],function(t,e){var i,o=function(e){this.options=t.extend(!0,{lines:12,length:10,width:4,radius:14,corners:1,rotate:0,direction:1,color:"white",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"k-spinner",zIndex:2e9,top:"50%",left:"50%"},e),this.tpl='<div class="k-loading"></div>',this.init()},s=!1;return o.prototype.init=function(){this.$loading=t(this.tpl).appendTo(document.body).hide(),this.spinner=new e(this.options)},o.prototype.show=function(t,e){s||(s=!0,e?this.$loading.addClass("k-loading-full"):this.$loading.removeClass("k-loading-full"),t="undefined"==typeof t||t,t?(this.$loading.addClass("k-loading-img"),this.$loading.show()):(this.spinner.spin(this.$loading.get(0)),this.$loading.removeClass("k-loading-img"),this.$loading.fadeIn("fast")))},o.prototype.hide=function(){this.$loading.stop().hide(),this.spinner.stop(),s=!1},o.show=function(t,e){i||(i=new o),i.show(t,e)},o.hide=function(){i&&i.hide()},o}),define("km/magnifier",["jquery"],function(t){var e=function(e,i){this.options=t.extend(!0,{offset:10,width:400,height:250,zoomWidth:400,zoomHeight:400,zIndex:100},i),this.$el=e,this._isLoading=!1,this.init()};return e.prototype.init=function(){this.create(),this.watch()},e.prototype.watch=function(){var t=this;this.$el.on("mousemove.magnifier",function(e){var i=t.$img.attr("data-big-img");if(t.$view.show(),"true"==t.$viewImg.attr("data-isLoad"))t.$selector.show(),t.setPosition(e);else{if(t.$viewImg.hide(),t._isLoading)return;t._isLoading=!0,t.loadImg(i,function(e,o){t.$viewLoading.hide(),t._isLoading=!1,t.$viewImg.attr({src:i,"data-isLoad":!0}).show(),t.$selector.width(t.options.zoomWidth/(o.width/t.options.width)).height(t.options.zoomHeight/(o.height/t.options.height))})}}).on("mouseleave.magnifier",function(e){t.$view.hide(),t.$selector.hide()})},e.prototype.create=function(){this.$el.width(this.options.width).height(this.options.height),this.$imgBox=this.$el.find(".k-magnifier-imgbox").css({width:this.options.width,height:this.options.height}),this.$img=this.$el.find(".k-magnifier-imgbox img"),this.$view=t('<div class="k-magnifier-view"><img src="" /><div class="k-magnifier-loading"><span class="fa fa-spinner fa-spin"></span><br/>图片加载中，请稍候...</div></div>').appendTo(this.$el).css({width:this.options.zoomWidth,height:this.options.zoomHeight,left:this.$imgBox.position().left+this.options.width+this.options.offset,top:this.$imgBox.position().top,zIndex:this.options.zIndex}),this.$viewLoading=this.$view.find(".k-magnifier-loading"),this.$viewImg=this.$view.find("img"),this.$selector=t('<div class="k-magnifier-selector"></div>').appendTo(this.$imgBox).css({left:0,top:0})},e.prototype.loadImg=function(t,e){var i=new Image;i.onload=function(){e(!0,{width:i.width,height:i.height})},i.onerror=function(){e(!1,{width:0,height:0})},i.src=t},e.prototype.setPosition=function(t){var e,i,o=t.pageX,s=t.pageY,n=o-this.$el.offset().left,a=s-this.$el.offset().top,r=this.$selector.outerWidth(),h=this.$selector.outerHeight(),l=this.options.width-r,p=this.options.height-h;n-=r/2,a-=h/2,n<0?n=0:n>l&&(n=l),a<0?a=0:a>p&&(a=p),e=n/(this.$el.width()-r),i=a/(this.$el.height()-h),this.$selector.css({left:n,top:a}),this.$viewImg.css({width:this.options.zoomWidth/r*this.options.width,height:this.options.zoomHeight/h*this.options.height,left:-e*(this.$viewImg.width()-this.$view.width()),top:-i*(this.$viewImg.height()-this.$view.height())})},function(t,i){var o=new e(t,i);return o}}),define("km/mask",["jquery"],function(t){var e=t('<div class="k-mask"></div>').appendTo(document.body),i={show:function(t){e.html(t).fadeIn()},hide:function(){e&&e.fadeOut()}};return i}),define("km/pager",["jquery","km/event"],function(t,e){var i=function(i,o){this.$element=i,this.options=t.extend(!0,{curPage:1,totalCount:0,pageSize:20,className:""},o),this.canBuild=!0,this.curPage=this.options.curPage,this.totalCount=this.options.totalCount,this.pageSize=this.options.pageSize,this.template='<div class="pager-box"></div>',this.event=new e,this.init()};return i.prototype.init=function(){var e=this;this.$pager=t(this.template).appendTo(this.$element),this.build(),this.$pager.off().on("click.pager","li",function(){var i=t(this),o=i.attr("data-page");i.hasClass("disabled")||i.hasClass("active")||(e.curPage=parseInt(o,10),e.event.trigger("click.pager",[o]),e.canBuild&&e.build())})},i.prototype.on=function(t,e){var i=this;return this.event.off(t+".pager").on(t+".pager",function(t){e.apply(i,t)}),this},i.prototype.build=function(){var t,e=this.getInfo(),i=[];i.push('<ul class="k-pagination '+this.options.className+'">'),t=this.curPage>1?"":"disabled",i.push('<li class="'+t+'" data-page="'+e.pre+'" ><a href="javascript:void(0);">«</a></li>');for(var o=e.start;o<=e.end;o++)t=o===this.curPage?"active":"",i.push('<li class="'+t+'" data-page="'+o+'" ><a href="javascript:void(0);">'+o+"</a></li>");t=this.curPage!==e.allPage?"":"disabled",i.push('<li class="'+t+'" data-page="'+e.next+'" ><a href="javascript:void(0);">»</a></li>'),i.push("</ul>"),this.$pager.html(i.join("")),0==this.totalCount?this.$pager.hide():this.$pager.show()},i.prototype.getInfo=function(){var t,e,i,o,s;return s=parseInt(this.totalCount/this.pageSize),s=this.totalCount%this.pageSize!==0?s+1:s,s=0===s?1:s,t=this.curPage+2>s?s-4:this.curPage-2,e=this.curPage<4?5:this.curPage+2,t<1&&(t=1),e>s&&(e=s),i=this.curPage-1<1?1:this.curPage-1,o=this.curPage+1>s?s:this.curPage+1,{start:t,end:e,pre:i,next:o,allPage:s}},i}),define("km/panel",["jquery","km/resizable"],function($,Resizable){var Panel=function(t,e){this.$panel=t,this.options=$.extend(!0,{width:"auto",height:"auto",minWidth:100,minHeight:100,resizable:{enabled:!1,cover:!1,border:{left:!0,top:!0,right:!0,bottom:!0},callback:{resize:$.noop,stop:$.noop}}},e),this.init()};return Panel.prototype.init=function(){this.$panel.css({width:this.options.width,height:this.options.height}),this.$header=this.$panel.find(".k-panel-head"),this.$title=this.$header.find(".k-panel-title"),this.$body=this.$panel.find(".k-panel-body"),this.$body.css("height",this.$panel.height()-this.$title.height()),this.headHeight=this.$header.outerHeight(),this.options.resizable.enabled&&(this.resizable=new Resizable(this.$panel,{border:this.options.resizable.border,cover:this.options.resizable.cover,minWidth:this.options.minWidth,minHeight:this.options.minHeight,$range:this.$panel.parent()})),this._event={slideDown:$.noop,slideUp:$.noop},this.watch()},Panel.prototype.watch=function(){var t=this;this.$panel.on("click.panel","span[role=slideup]",function(){t.slideUp($(this))}).on("click.panel","span[role=slidedown]",function(){t.slideDown($(this))}),this.resizable&&this.resizable.on("resize",function(e){t.setBodyHeight(e.height),t.options.resizable.callback.resize.call(t,e)}).on("stop",function(e){t.options.resizable.callback.stop.call(t,e)})},Panel.prototype.on=function(t,e){return this._event[t]=e||$.noop,this},Panel.prototype.setBodyHeight=function(t){t=t||this.$panel.height();var e=t-this.headHeight;this.$body.css("height",e)},Panel.prototype.setSize=function(t){this.$panel.css({width:t.width,height:t.height}),this.setBodyHeight(t.height)},Panel.prototype.slideDown=function(t){var e=this;if(t.attr("role","slideup"),t.hasClass("fa-angle-double-down"))return t.removeClass("fa-angle-double-down").addClass("fa-angle-double-up"),this.$panel.stop().animate({height:this.orgHeight}),this.$body.stop().animate({height:this.orgHeight-this.headHeight,display:"block"},function(){e.resizable&&e.resizable.$bottomHandle.show()}),void this._event.slideDown.call(this)},Panel.prototype.slideUp=function(t){var e=this;if(this.orgHeight=this.$panel.outerHeight(),t.attr("role","slidedown"),t.hasClass("fa-angle-double-up"))return t.removeClass("fa-angle-double-up").addClass("fa-angle-double-down"),this.$panel.stop().animate({height:this.headHeight}),this.$body.stop().animate({height:0},function(){e.$body.hide(),e.resizable&&e.resizable.$bottomHandle.hide()}),void this._event.slideUp.call(this)},Panel.Global=function($elms){$elms=$elms||$("div[data-module=panel]"),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),onSlideDown=$el.attr("data-onslidedown"),onSlideUp=$el.attr("data-onslideup"),data=$.data($el[0],"panel");data||(options&&options.length>0&&(options=eval("(0,"+options+")")),onSlideDown=onSlideDown&&onSlideDown.length>0?eval("(0,"+onSlideDown+")"):$.noop,onSlideUp=onSlideUp&&onSlideUp.length>0?eval("(0,"+onSlideUp+")"):$.noop,data=new Panel($el,options),data.on("slideDown",function(){onSlideDown.call(this)}).on("slideUp",function(){onSlideUp.call(this)}),$.data($el[0],"panel",data))})},Panel}),define("km/placeholder",["jquery"],function(t){function e(e){e.each(function(){var e=t(this),o=t.data(e[0],"placeholder");if(void 0===o){var s=t.trim(e.attr("placeholder"));if(!s||0===s.length)return;o=new i(e),t.data(e[0],"placeholder",o)}else o.setPosition()})}var i=function(t){this.$elm=t,this.type="placeholder",this.init()};return i.prototype.init=function(){var e=t.trim(this.$elm.attr("placeholder"));this.timer=this.$elm.attr("data-timer"),this.timer&&(this.timer=JSON.stringify(this.timer)),
this.$placeholder=t("<div/>").addClass("placeholder").text(e).insertAfter(this.$elm).hide(),this.$elm.parent().css("position","relative"),this.setPosition(),this.eventBind()},i.prototype.eventBind=function(){var e=this;this.timer&&setInterval(function(){e.setPosition()},this.timer.delay),this.$elm.on("focus."+this.type,function(){e.$placeholder.hide()}).on("blur."+this.type,function(){var i=t.trim(e.$elm.val());0===i.length||i===e.text?(e.$elm.val(""),e.$placeholder.show()):e.$placeholder.hide()}),this.$placeholder.on("focus."+this.type,function(){e.$elm.focus()})},i.prototype.display=function(){var e=t.trim(this.$elm.val());0===e.length||e===t.trim(this.$elm.attr("placeholder"))?this.$placeholder.show():this.$placeholder.hide()},i.prototype.setPosition=function(){var t=this;setTimeout(function(){var e={left:t.$elm[0].offsetLeft,top:t.$elm[0].offsetTop,height:t.$elm.outerHeight(),width:t.$elm.outerWidth(),position:"absolute",paddingLeft:"10px",paddingRight:"10px",paddingTop:0,margin:0,lineHeight:t.$elm.outerHeight()+"px",cursor:"text",color:"#999"};"textarea"===t.$elm[0].nodeName.toLowerCase()&&(e.lineHeight="auto",e.paddingTop=5),t.$placeholder.css(e),t.display()},50)},function(i){"placeholder"in document.createElement("input")||(i=i||t("input,textarea"),e(i))}}),define("km/popover",["jquery","km/tooltips","km/util"],function($,Tooltips,util){var Popover=function(t,e){e=$.extend(!0,{type:"popover",title:"标题",tpl:'<div class="k-popover"><div class="k-popover-arrow"></div><div class="k-popover-title"></div><div class="k-popover-inner"></div></div>'},e),Tooltips.call(this,t,e),this.setTitle()};return Popover.prototype=util.createProto(Tooltips.prototype),Popover.prototype.setTitle=function(t){t=$.trim(t||this.options.title),0===t.length&&(t=this.$element.attr("data-title")||"");var e=this.$tips;e.find(".k-popover-title").text(t)},Popover.prototype.setContent=function(t){t=$.trim(t||this.options.content),0===t.length&&(t=this.$element.attr("data-content")||"");var e=this.$tips;e.find(".k-popover-inner").html(t)},Popover.Global=function($elements){var $elements=$elements||$('[data-module="popover"]');$elements.each(function(){var $this=$(this),popover=Popover.Get($this);if(!popover){var options=$this.attr("data-options");options=options&&options.length>0?eval("(0,"+options+")"):{title:$this.attr("data-title"),content:$this.attr("data-content"),placement:$this.attr("data-placement"),tipClass:$this.attr("data-tipClass"),trigger:$this.attr("data-trigger")},popover=new Popover($this,options),Popover.Set($this,popover)}})},Popover.Get=function(t){return $.data(t[0],"popover")},Popover.Set=function(t,e){$.data(t[0],"popover",e)},Popover}),define("km/popTips",["jquery"],function(t){var e=function(){function e(){function e(e,n,a,r){s&&clearTimeout(s),t.isFunction(a)&&(r=a,a=3e3),r=r||t.noop,a=a||3e3,o&&o.stop().remove(),o=t(i(e,n)).appendTo(document.body).hide(),o.css({marginLeft:-(o.width()/2),marginTop:-(o.height()/2)}).fadeIn("fase",function(){s=setTimeout(function(){o.stop().remove(),r()},a)})}function i(t,e){var i=[];switch(t){case"success":i.push('<div class="k-pop-tips success"><span class="fa fa-check"></span>&nbsp;<span>'+e+"</span></div>");break;case"error":i.push('<div class="k-pop-tips error"><span class="fa fa-close"></span>&nbsp;<span>'+e+"</span></div>");break;case"warning":i.push('<div class="k-pop-tips warning"><span class="fa fa-exclamation"></span>&nbsp;<span>'+e+"</span></div>")}return i.join("")}var o,s;return{success:function(t,i,o){e("success",t,i,o)},error:function(t,i,o){e("error",t,i,o)},warning:function(t,i,o){e("warning",t,i,o)}}}var i;return{getInstance:function(){return i||(i=e()),i}}}();return e.getInstance()}),define("km/portlets",["jquery","km/window","km/dragdrop"],function($,Window,Dragdrop){var groupSortable,webPartSortable,groupMoving=!1,isSetGroup=!1,method={group:{init:function(t,e){groupSortable=Dragdrop.sortable(t,{$scrollWrap:e.$scrollWrap,draggable:"div.group",handle:"div.group-head-handle",boundary:!0,direction:"v",callback:{init:function(){},start:e.callback.start,move:e.callback.move,stop:e.callback.stop}})},toggle:function(t,e){var i=t.parents("div.group:eq(0)");i.find("div.group-body");t.hasClass("fa-minus-square-o")?(t.removeClass("fa-minus-square-o").addClass("fa-plus-square-o"),e.callback.hide(t)):(t.removeClass("fa-plus-square-o").addClass("fa-minus-square-o"),e.callback.show(t)),i.toggleClass("group-hide"),webPartSortable.setInfo(),groupSortable.setInfo()},refresh:function(){},close:function(t){var e=t.parents("div.group:eq(0)"),i=e.data("sortable");Window.confirm("删除","您确认要删除该模块吗？",function(){var t=i.$layer.find("div.webPart"),o=[];t.each(function(){var t=$(this).data("sortable");t&&o.push(t)}),groupSortable.removeSortable(i),webPartSortable.removeGroup(e),webPartSortable.removeSortables(o)})}},webpart:{init:function($container,options){webPartSortable=Dragdrop.sortable($container,{$scrollWrap:options.$scrollWrap,draggable:"div.webPart",droppable:"div.column",group:"div.group",handle:"div.webPart-head-handle",boundary:!0,callback:{init:function(sortable){sortable.portletsOptions=eval("(0,"+sortable.$layer.attr("data-options")+")")},start:options.callback.start,move:options.callback.move,stop:options.callback.stop}})},toggle:function(t,e){var i=t.parents("div.webPart:eq(0)");i.find("div.webPart-body");t.hasClass("fa-minus-square-o")?(t.removeClass("fa-minus-square-o").addClass("fa-plus-square-o"),e.callback.hide(t)):(t.removeClass("fa-plus-square-o").addClass("fa-minus-square-o"),e.callback.show(t)),i.toggleClass("webPart-hide"),webPartSortable.setInfo(),groupSortable.setInfo()},refresh:function(){},setting:function(){},close:function(t){var e=t.parents("div.webPart:eq(0)"),i=e.data("sortable");Window.confirm("删除","您确认要删除该模块吗？",function(){webPartSortable.removeSortable(i)})}}};return function(t,e){var i;return e=$.extend(!0,{group:{callback:{init:$.noop,hide:$.noop,show:$.noop,start:$.noop,move:$.noop,stop:$.noop}},webpart:{callback:{init:$.noop,hide:$.noop,show:$.noop,start:$.noop,move:$.noop,stop:$.noop}}},e),method.group.init(t,e.group),method.webpart.init(t,e.webpart),t.off("click.portlets").on("click.portlets","[data-role=gtoggle]",function(){return method.group.toggle($(this),e.group),!1}).on("click.portlets","[data-role=grefresh]",function(){return method.group.refresh(),!1}).on("click.portlets","[data-role=gclose]",function(){return method.group.close($(this)),!1}).on("click.portlets","[data-role=wtoggle]",function(){return method.webpart.toggle($(this),e.webpart),!1}).on("click.portlets","[data-role=wrefresh]",function(){return method.webpart.refresh(),!1}).on("click.portlets","[data-role=wsetting]",function(){return method.webpart.setting(),!1}).on("click.portlets","[data-role=wclose]",function(){return method.webpart.close($(this)),!1}),$(window).off("resize.portlets").on("resize.portlets",function(){i&&clearTimeout(i),i=setTimeout(function(){groupSortable.setInfo(),webPartSortable.setInfo()},300)}),{groupSortable:groupSortable,webPartSortable:webPartSortable,destory:function(){groupSortable.destory(),webPartSortable.destory()}}}}),define("km/rating",["jquery","km/event"],function(t,e){var i={_createStar:function(){for(var e,o,s=[],n=1;n<=this.options.number;n++)o=i._getTitle.call(this,n),e=this.options.score&&this.options.score>=n?"starOn":"starOff",e=this.options.path+this.options[e],s.push('<img src="'+e+'" alt="'+n+'" title="'+o+'" style="padding-left:'+this.options.space+'px;" />');this.$stars=t(s.join("")).appendTo(this.$starBox)},_createScore:function(){this.options.scoreName&&this.options.score&&(this.$score=t("<input/>",{type:"hidden",name:this.options.scoreName,value:this.options.score}).appendTo(this.$el))},_getMin:function(t,e,i){return Math.min(Math.max(parseFloat(t),e),i)},_getTitle:function(t){var e=this.options.values[parseInt(t)-1];return""===e?"":e||t},_setStar:function(t){var e=(t-Math.floor(t)).toFixed(2);if(e>this.options.round.down){var i="starOn";this.options.half&&e<this.options.round.up?i="starHalf":e<this.options.round.full&&(i="starOff"),this.$stars.eq(Math.ceil(t)-1).attr("src",this.options.path+this.options[i])}},_fill:function(e){var i,o=this;this.$stars.each(function(s){i=s<=e-1?"starOn":"starOff",t(this).attr("src",o.options.path+o.options[i])})},_setScore:function(t){this.$score&&this.$score.val(t)},_setValue:function(t){this.$target&&"input"===this.$target[0].tagName.toLowerCase()&&this.$target.val(t)}},o=function(i,o){this.$el=i,this.options=t.extend(!0,{path:"../images/star",starOff:"star-off.png",starHalf:"star-half.png",starOn:"star-on.png",target:".k-rating-target",number:3,values:[1,2,3],score:0,scoreName:void 0,round:{down:.25,full:.6,up:.76},half:!0,size:24,space:4},o),this.event=new e,this._tmpScore=0,this.init()};return o.prototype.init=function(){this.options.score=this.options.score<0?0:this.options.score,this._tmpScore=this.options.score,this.$starBox=this.$el.find(".k-rating-star"),this.$target=this.$el.find(this.options.target),this.options.path&&"/"!==this.options.path.slice(this.options.path.length-1,this.options.path.length)&&(this.options.path+="/"),i._createStar.call(this),i._createScore.call(this),i._setStar.call(this,this.options.score),this.watch()},o.prototype.watch=function(){var e=this;this.$el.on("mousemove.rating","img",function(o){var s,n=t(this),a=parseInt(n.attr("alt")),r=n.offset().left,h=o.pageX,l=(h-r)/e.options.size,p=l>.5?1:.5;e.options.half?(a=a-1+p,i._fill.call(e,a),i._setStar.call(e,a),i._setScore.call(e,a)):i._fill.call(e,a),s=i._getTitle.call(e,n.attr("alt")),e._tmpScore=a,i._setValue.call(e,s),e.event.trigger("mousemove.rating",[a,s])}).on("mouseleave.rating",".k-rating-star",function(){var o,s;e._tmpScore=e.options.score,e.$stars.each(function(i){o=e.options.score&&e.options.score-1>=i?"starOn":"starOff",t(this).attr("src",e.options.path+e.options[o])}),i._setStar.call(e,e.options.score),i._setScore.call(e,e.options.score),s=e.options.score>e.options.round.down?i._getTitle.call(e,Math.ceil(e.options.score)):"",i._setValue.call(e,s),e.event.trigger("mouseleave.rating",[e.options.score,s])}).on("click.rating","img",function(){var t;e.options.score=e._tmpScore,i._setStar.call(e,e.options.score),i._setScore.call(e,e.options.score),t=i._getTitle.call(e,Math.round(e.options.score)),i._setValue.call(e,t),e.event.trigger("click.rating",[e.options.score,t])})},o.prototype.on=function(t,e){var i=this;return this.event.on(t+".rating",function(t){e.apply(i,t)}),this},o}),define("km/resizable",["jquery"],function($){var $cover=$('<div class="k-resizable-cover"></div>').appendTo(document.body),util={getPosition:function(t,e){var i=t.offset(),o=e.offset();return{left:i.left-o.left,top:i.top-o.top,offsetLeft:i.left,offsetTop:i.top}},getOffsetParent:function(t,e){for(var i,o=t.parent(),s={isRoot:!1,left:0,top:0,pLeft:0,pTop:0,$el:null};o[0]!=e[0];){if(i=o.css("position"),"relative"==i||"absolute"==i)return s.left=o.offset().left,s.top=o.offset().top,s.pLeft=s.left-e.offset().left,s.pTop=s.top-e.offset().top,s.$el=o,s.isRoot=!0,s;o=o.parent()}return s}},Resizable=function(t,e){this.$elm=t,this.options=$.extend(!0,{$range:this.$elm.parent(),minBar:!1,scale:!1,cover:!0,minWidth:100,minHeight:100,border:{left:!0,top:!0,right:!0,bottom:!0}},e),this.originalCoord={x:0,y:0},this.offset={x:0,y:0},this.resizeParams={left:0,top:0,width:0,height:0,ratio:1,type:"bottom"},this.moving=!1,this.minWidth=this.options.minWidth,this.minHeight=this.options.minHeight,this._event={resize:$.noop,stop:$.noop},this.init()};return Resizable.prototype.init=function(){var t=[];t.push('<div class="k-resizable-handle k-resizable-handle-left" role="resizable" data-type="left"></div>'),t.push('<div class="k-resizable-handle k-resizable-handle-top" role="resizable" data-type="top"></div>'),t.push('<div class="k-resizable-handle k-resizable-handle-right" role="resizable" data-type="right"></div>'),t.push('<div class="k-resizable-handle k-resizable-handle-bottom" role="resizable" data-type="bottom"></div>'),t.push('<div class="k-resizable-handle-minbar" role="resizable" data-type="bottomRight"></div>'),this.$elm.addClass("k-resizable-container").append(t.join("")),this.$leftHandle=this.$elm.find(".k-resizable-handle-left"),this.$topHandle=this.$elm.find(".k-resizable-handle-top"),this.$rightHandle=this.$elm.find(".k-resizable-handle-right"),this.$bottomHandle=this.$elm.find(".k-resizable-handle-bottom"),this.$minbar=this.$elm.find(".k-resizable-handle-minbar"),this.$range=this.options.$range.css("position","relative"),this.$doc=$(document),this.$win=$(window),this.$body=$(document.body),this.options.border.left&&this.$leftHandle.show(),this.options.border.top&&this.$topHandle.show(),this.options.border.right&&this.$rightHandle.show(),this.options.border.bottom&&this.$bottomHandle.show(),this.options.minBar&&this.$minbar.show(),this.watch()},Resizable.prototype.watch=function(){var t=this;this.$elm.on("mousedown.resizable","[role=resizable]",function(e){var i=$(this);t.resizeParams.top=parseInt(t.$elm.position().top),t.resizeParams.left=t.$elm.position().left,t.resizeParams.width=parseInt(t.$elm.outerWidth(!0)),t.resizeParams.height=parseInt(t.$elm.outerHeight(!0)),t.resizeParams.ratio=t.resizeParams.width>=t.resizeParams.height?t.resizeParams.width/t.resizeParams.height:t.resizeParams.height/t.resizeParams.width,t.resizeParams.type=i.attr("data-type"),t.showCover(),e.stopPropagation(),e.preventDefault(),t.start(e,i),document.onselectstart=function(){return!1}})},Resizable.prototype.on=function(t,e){return this._event[t]=e||$.noop,this},Resizable.prototype.start=function(t,e){var i=this;this.$doc.on("mousemove.resizable",function(t){i.resize(t)}).on("mouseup.resizable",function(t){i.stop(t,e),i.$doc.off("mousemove.resizable"),i.$doc.off("mouseup.resizable")}),this.moving=!0,this.winHeight=this.$win.height(),this.docHeight=this.$doc.height();var o=this.getMouseCoord(t),s=util.getPosition(this.$elm,this.$range?this.$range:this.$body);this.offset.x=o.x-s.left,this.offset.y=o.y-s.top,this.offset.click={left:o.x-s.offsetLeft,top:o.y-s.offsetTop},this.offset.parent=util.getOffsetParent(this.$elm,this.$range?this.$range:this.$body),this.originalCoord.x=o.x,this.originalCoord.y=o.y,e[0].setCapture&&e[0].setCapture(),this.css={left:this.resizeParams.left,top:this.resizeParams.top,width:this.resizeParams.width,height:this.resizeParams.height}},Resizable.prototype.resize=function(t){var e,i,o=this.getMouseCoord(t),s={x:parseInt(o.x-this.offset.x),y:parseInt(o.y-this.offset.y)},n={},a=this.resizeParams,r=this.options.$range;switch(r?(e=r.outerWidth(),i=r.outerHeight()):(e=this.$win.width()+this.$doc.scrollLeft(),i=this.$win.height()+this.$doc.scrollTop()),this.resizeParams.type){case"left":n.top=a.top,n.height=a.height,s.x<=0?(n.left=-this.offset.parent.pLeft,n.width=a.width+this.offset.parent.pLeft+a.left):(n.left=this.offset.parent.isRoot?o.x-this.offset.click.left-this.offset.parent.left:s.x,n.width=a.width+(this.originalCoord.x-o.x)),n.width<=this.minWidth&&(n.width=this.minWidth,n.left=a.left+(a.width-n.width));break;case"top":n.top=this.offset.parent.isRoot?o.y-this.offset.click.top-this.offset.parent.top:s.y,n.left=a.left,n.width=a.width,n.height=a.height+(this.originalCoord.y-o.y),n.top<-this.offset.parent.pTop&&(n.top=-this.offset.parent.pTop,n.height=a.height+this.offset.parent.pTop+a.top),n.height<=this.minHeight&&(n.height=this.minHeight,n.top=a.top+(a.height-n.height));break;case"right":n.top=a.top,n.left=a.left,n.height=a.height,n.width=a.width-(this.originalCoord.x-o.x),n.width+this.offset.parent.pLeft+n.left>=e&&(n.width=e-this.offset.parent.pLeft-n.left),n.width<=this.minWidth&&(n.width=this.minWidth);break;case"bottom":n.top=a.top,n.left=a.left,n.width=a.width,n.height=a.height-(this.originalCoord.y-o.y),n.height+this.offset.parent.pTop+n.top>=i&&(n.height=i-this.offset.parent.pTop-n.top),n.height<=this.minHeight&&(n.height=this.minHeight);break;case"bottomRight":n.top=a.top,n.left=a.left,n.width=a.width-(this.originalCoord.x-o.x),n.width=n.width<this.minWidth?this.minWidth:n.width,n.height=this.getScaleHeight(n.width),n.width+this.offset.parent.pLeft+n.left>=e&&(n.width=e-this.offset.parent.pLeft-n.left,n.height=this.getScaleHeight(n.width)),n.height+this.offset.parent.pTop+n.top>=i&&(n.height=i-this.offset.parent.pTop-n.top,n.width=this.getScaleWidth(n.height))}this.css=n,this.options.cover?$cover.css(n):this.$elm.css(n),this._event.resize.call(this,n)},Resizable.prototype.stop=function(t,e){this.moving=!1,this.hideCover(),this.options.cover&&this.$elm.css(this.css),e[0].releaseCapture&&e[0].releaseCapture(),this._event.stop.call(this,this.css)},Resizable.prototype.showCover=function(){if(this.options.cover){var t=this.$elm;$cover.insertAfter(this.$elm).show().css({width:t.outerWidth(),height:t.outerHeight(),left:t.position().left,top:t.position().top})}},Resizable.prototype.hideCover=function(){$cover.hide()},Resizable.prototype.getMouseCoord=function(t){return{x:parseInt(t.pageX||t.clientX+document.body.scrollLeft-document.body.clientLeft),y:parseInt(t.pageY||t.clientY+document.body.scrollTop-document.body.clientTop)}},Resizable.prototype.getScaleWidth=function(t,e){return e=e||this.resizeParams.ratio,this.resizeParams.width>=this.resizeParams.height?t*e:t/e},Resizable.prototype.getScaleHeight=function(t,e){return e=e||this.resizeParams.ratio,this.resizeParams.width>=this.resizeParams.height?t/e:t*e},Resizable.Global=function($elms){$elms=$elms||$("[data-module=resizable]"),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),onResize=$el.attr("data-onresize"),onStop=$el.attr("data-onstop"),data=$.data($el[0],"resizable");options&&options.length>0&&(options=eval("(0,"+options+")")),onResize=onResize&&onResize.length>0?eval("(0,"+onResize+")"):$.noop,onStop=onStop&&onStop.length>0?eval("(0,"+onStop+")"):$.noop,data||(data=new Resizable($el,options),data.on("resize",function(t){onResize.call(this,t)}).on("stop",function(t){onStop.call(this,t)}),$.data($el[0],"resizable",data))})},Resizable}),define("km/router",[],function(){var t={addEventListener:function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i},removeEventListener:function(t,e,i){t.removeEventListener?t.removeEventListener(e,handler,!1):t.detachEvent?t.detachEvent("on"+e,handler):t["on"+e]=null},proxy:function(t,e){var i=function(){return t.apply(e||this,arguments)};return i}},e=function(){this._routes=[]};return e.prototype.init=function(){var e=this;t.addEventListener(window,"hashchange",t.proxy(e.listener,this)),this.listener()},e.prototype.listener=function(){var t,e=location.hash.slice(1).split("?"),i=e[0];e[1]&&(t=this.getUrlParams(e[1]));var o,s=this.getRoute(i),n={};if(!s)return void location.replace("#/");o=this.getValues(i,s);for(var a=0;a<s.params.length;a++)n[s.params[a]]=o[a];t=$.extend({},n,t),s.handle(t)},e.prototype.getUrlParams=function(t){var e={};if(!t)return e;for(var i,o=t.split("&"),s=0;s<o.length;s++)i=o[s].split("="),e[i[0]]=i[1];return e},e.prototype.map=function(t,e,i){var o,s,n,a=[];if(s=t.replace(/\//g,"\\/"),"function"==typeof e&&(i=e,e=null),e)for(var r in e)o=new RegExp("\\{"+r+"\\}","g"),s=s.replace(o,"("+e[r].replace(/\^/,"").replace(/\$/,"")+")"),a.push(r);for(o=new RegExp("{([^}]+)}","g");null!=(n=o.exec(s));)a.push(n[1]),o.lastIndex;return s="^"+s.replace(/{[^}]+}/gi,"(.+)")+"$",this._routes.push({routeUrl:t,pattern:s,params:a,handle:i||function(){}}),this},e.prototype.getValues=function(t,e){var e,i=[];if(0===t.length)return i;if(e=e||this.getRoute(t),null!=e){var o=t.match(e.pattern);if(0!=o.length)for(var s=1;s<o.length;s++)i.push(o[s])}return i},e.prototype.getRoute=function(t){for(var e=0;e<this._routes.length;e++)if(new RegExp(this._routes[e].pattern).test(t))return this._routes[e];return null},e}),define("km/scrollImg",["jquery"],function($){var ScrollImg=function(t,e){this.$el=t,this.options=$.extend(!0,{padding:30,delay:3e3,width:"auto",height:150,showNum:3,toggleDealy:700},e),this.init()};return ScrollImg.prototype.init=function(){var t;this.tm=null,this.isStop=!1,this.$prev=this.$el.find("div.k-scrollImg-prev"),this.$next=this.$el.find("div.k-scrollImg-next"),this.$container=this.$el.find("div.k-scrollImg-container").css({width:this.options.width,height:this.options.height}),this.$el.css({paddingLeft:this.options.padding,paddingRight:this.options.padding,width:2*this.options.padding+this.$container.outerWidth()}),this.$ul=this.$container.find("ul");var t=this.$ul.children("li");t.length<=this.options.showNum&&(this.options.showNum=t.length),this.crateItem(),t=this.$ul.children("li"),this.total=t.length/this.options.showNum,this.max=this.total-2,this.index=0,this.max>1&&(this.$ul.css("marginLeft",-(this.index+1)*this.options.showNum*this.i_w),this.run(),this.watch())},ScrollImg.prototype.crateItem=function(){var t=this.$ul.children("li"),e=this.$container.outerWidth(),i=[],o=10,s=0,n=0,a=e/this.options.showNum-o,r=t.length;if(this.i_w=a+o,r%this.options.showNum!=0)for(var h=0;h<r;h++)for(var l=0;l<this.options.showNum;l++)i.push(t[s].outerHTML),n+=this.i_w,s++,s>=r&&(s=0);if(i.length){for(var p=[],d=[],h=0;h<this.options.showNum;h++)d.push(i[h]);for(var h=i.length-this.options.showNum;h<i.length;h++)p.push(i[h]);Array.prototype.push.apply(i,d),Array.prototype.push.apply(p,i),n+=this.i_w*this.options.showNum*2,this.$ul.html(p.join("")).width(n)}else{if(r>this.options.showNum){for(var p=[],d=[],h=0;h<this.options.showNum;h++)d.push(t[h].outerHTML);for(var h=r-this.options.showNum;h<r;h++)p.push(t[h].outerHTML);r+=2*this.options.showNum,this.$ul.append(d.join("")),this.$ul.prepend(p.join(""))}this.$ul.width(r*this.i_w)}this.$ul.children("li").css("width",a)},ScrollImg.prototype.watch=function(){var t=this;this.isWatch||(this.isWatch=!0,this.$el.on("mouseenter.scrollImg",function(){t.stop()}).on("mouseleave.scrollImg",function(){t.run()}).on("click.scrollImg",".k-scrollImg-prev",function(){t.index--,t.active()}).on("click.scrollImg",".k-scrollImg-next",function(){t.index++,t.active()}))},ScrollImg.prototype.run=function(){var t=this;this.isStop=!1,this.tm=setTimeout(function(){t.index++,t.active(function(){t.isStop||t.run()})},this.options.delay)},ScrollImg.prototype.stop=function(){this.tm&&(clearTimeout(this.tm),this.isStop=!0)},ScrollImg.prototype.active=function(t){var e=this,i=this.index+1,o=this.i_w*this.options.showNum;this.index==this.max&&(this.index=0),this.index<0&&(this.index=this.max-1),this.$ul.stop().animate({marginLeft:-i*o},this.options.toggleDealy,function(){i==e.total-1&&e.$ul.css("marginLeft",-1*o),0==i&&e.$ul.css("marginLeft",-e.max*o),"function"==typeof t&&t()})},function($elms,settings){$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),data=$.data(this,"scrollerImg");data||(options=options?eval("(0,"+options+")"):settings,data=new ScrollImg($(this),options),$.data(this,"scrollerImg",data))})}}),define("km/slider",["jquery","km/dragdrop"],function(t,e){var i=function(e,i){this.$element=e,this.options=t.extend(!0,{min:1,max:10,step:1,value:1,$bindElement:t([]),callback:{slide:t.noop}},i),this.template='<div class="k-slider"><div class="k-slider-selection"></div><div class="k-slider-handle"></div></div>',this.min=this.options.min,this.max=this.options.max,this.step=this.options.step,this.diff=this.max-this.min,this.init()};return i.prototype.init=function(){var i=this;this.$slider=t(this.template).appendTo(this.$element),this.$sliderSelection=this.$slider.find("div.k-slider-selection"),this.$sliderHandle=this.$slider.find("div.k-slider-handle"),this.handleWidth=this.$sliderHandle.width(),this.sliderWidth=this.$slider.outerWidth(),this.$bindElement=this.options.$bindElement,this.dragdrop=new e({$range:this.$slider,$layer:this.$slider.find(".k-slider-handle"),direction:"h",callback:{move:function(t,e){var o=i.getMoveValue(e);i.setValue(o),i.options.callback.slide(o)}}}),this.eventBind(),this.setValue(this.options.value)},i.prototype.eventBind=function(){if(this.allowElement()){var e=this.$bindElement[0].type,i=this;e.indexOf("select")!==-1?this.$bindElement.on("change.slider",function(){var e=t(this),o=t.trim(i.getFilterValue(e.val()));i.setValue(o)}):this.$bindElement.on("keyup.slider",function(e){var o=t(this),s=t.trim(i.getFilterValue(o.val()));13===e.keyCode&&i.setValue(s)}).on("blur.slider",function(){var e=t(this),o=t.trim(i.getFilterValue(e.val()));i.setValue(o)})}},i.prototype.allowElement=function(){if(0===this.$bindElement.length)return!1;var t=this.$bindElement[0].type;return"text"===t||"textarea"===t||t.indexOf("select")!==-1},i.prototype.getFilterValue=function(t){return t||(t=this.min),isNaN(t)&&(t=this.min),t<this.min&&(t=this.min),t>this.max&&(t=this.max),t},i.prototype.setValue=function(t){t>this.max&&(t=this.max),t<this.min&&(t=this.min);var e=(t-this.min)/this.diff*100;this.setPercent(e),this.setElementValue(t)},i.prototype.setElementValue=function(t){if(this.allowElement()){var e=this.$bindElement[0].type;e.indexOf("select")!=-1?this.$bindElement.find("option[value='"+t+"']").prop("selected",!0):this.$bindElement.val(t)}},i.prototype.getMoveValue=function(t){var e=t.x/(this.sliderWidth-this.handleWidth)*100,i=Math.round(e/100*this.diff/this.step)*this.step+this.min;return i=i>this.max?this.max:i},i.prototype.setPercent=function(t){this.$sliderSelection.width(t+"%"),this.$sliderHandle.css("left",t+"%")},function(t,e){var o=new i(t,e);return o}}),define("km/switch",["jquery"],function($){var Switch=function(t,e){this.$element=t,this.options=$.extend(!0,{values:{on:{text:"是",value:!0,className:""},off:{text:"否",value:!1,className:""}},callback:{onClick:$.noop}},e),this.template='<div class="k-switch"></div>',this.init()};return Switch.prototype.init=function(){"checkbox"===this.$element[0].type&&(this.$switch=$(this.template).append(this.build()).insertAfter(this.$element),this.$switchScroller=this.$switch.find(".k-switch-scroller"),this.$element.hide(),this.checked="checked"===this.$element.attr("checked"),this.disabled="disabled"===this.$element.attr("disabled"),this.moveLeft=this.$switch.find(".k-switch-left").width(),this.checked?this.on():this.off(),this.disabled&&this.$switch.addClass("disabled"),this.$switch.on("click.switch",$.proxy(this.toggle,this)))},Switch.prototype.build=function(){var t=[],e=this.options.values;return t.push('<div class="k-switch-scroller">'),t.push('<span class="k-switch-left" >'+e.on.text+"</span>"),t.push('<span class="k-switch-middle"></span>'),t.push('<span class="k-switch-right">'+e.off.text+"</span>"),t.push("</div>"),t.join("")},Switch.prototype.toggle=function(){this.disabled||(this.checked?(this.checked=!1,this.off()):(this.checked=!0,this.on()),this.options.callback.onClick(this.getVal()))},Switch.prototype.on=function(){this.disabled||(this.$element.prop("checked",!0),this.$switchScroller.stop().animate({left:0},300))},Switch.prototype.off=function(){this.disabled||(this.$element.prop("checked",!1),this.$switchScroller.stop().animate({left:-this.moveLeft},300))},Switch.prototype.getVal=function(){var t=this.options.values;return this.checked?t.on.value:t.off.value},Switch.prototype.destroy=function(){this.$switch.off("click"),this.$element.show(),this.$switch.remove()},Switch.Global=function($elms){$elms=$elms||$('input[data-module="switch"]'),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),values=$el.attr("data-values"),funcName=$el.attr("data-onClick"),data=$.data($el[0],"switch");data||(options=options&&options.length>0?eval("(0,"+options+")"):{values:values&&values.length>0?eval("(0,"+values+")"):void 0,callback:{onClick:funcName&&funcName.length>0?eval("(0,"+funcName+")"):$.noop}},data=new Switch($el,options),$.data($el[0],"switch",data))})},Switch}),define("km/tab",["jquery","km/ajax","km/contextMenu","km/loading"],function($,ajax,contextMenu,Loading){var identity=1,Tab=function(t,e){this.identity=identity++,this.$elm=t,this.options=$.extend(!0,{keepOne:!0,contextMenu:{items:[]},callback:{click:$.noop}},e),this.tabCount=0,this.curIndex=-1,this._event={click:$.noop,close:$.noop,refresh:$.noop},this.isLoading=!1,this.tm=null,this.init()};return Tab.prototype.init=function(){var t=0;this.$elm.attr("data-moduleId",this.identity),this.$tabHead=this.$elm.children("div.k-tab-head"),this.$btnLeft=this.$tabHead.find("div.left"),this.$btnRight=this.$tabHead.find("div.right"),this.$tabScroller=this.$tabHead.find("div.k-tab-scroller"),this.$tabNav=this.$tabScroller.find("ul.k-tab-nav"),this.$tabContainer=this.$elm.children("div.k-tab-container"),this.tabCount=this.$tabNav.find("li").length,this.contextMenuInit(),this.setSize(),this.watch(),t=this.$elm.find(".k-tab-head li.active").index(),t<0?t=0:t,this.toggle(t)},Tab.prototype.contextMenuInit=function(){if(0!=this.options.contextMenu.items.length){contextMenu.Global(this.$tabNav.children(),{items:this.options.contextMenu.items})}},Tab.prototype.watch=function(){var t=this;this.$elm.on("click.tab","[role=tab]",function(){var e=$(this),i=e.index();return t.toggle(i),t.childResize(),t.options.callback.click.call(this,e),t._event.click.call(this,e)}).on("click.tab","[role=refresh]",function(){return t.refresh($(this).parents("li:eq(0)").index()),!1}).on("click.tab","[role=close]",function(){return t.close($(this).parents("li:eq(0)").index()),!1}).on("click.tab","[role=left]",function(){return t.scroll("left"),!1}).on("click.tab","[role=right]",function(){return t.scroll("right"),!1}),$(window).on("resize.tab."+this.identity,function(){t.tm&&clearTimeout(t.tm),t.tm=setTimeout(function(){t.setSize()},300)})},Tab.prototype.setSize=function(){var t=this.$tabHead.outerWidth(),e=this.$btnLeft.outerWidth(),i=this.$btnRight.outerWidth(),o=t-e-i,s=0;this.$tabNav.children().each(function(){s+=$(this).outerWidth(!0)}),s>t?(this.isScroller=!0,this.$btnLeft.show(),this.$btnRight.show(),this.$tabScroller.css("width",o-30)):(this.isScroller=!1,this.$btnLeft.hide(),this.$btnRight.hide(),this.$tabScroller.css("width","auto"),this.$tabNav.css("margin-left","0")),this.$tabNav.css("width",s+1),this.maxLeft=s-o+30,this.scrollTo()},Tab.prototype.on=function(t,e){return this._event[t]=e||$.noop,this},Tab.prototype.add=function(t){if(t){var e=this,i=[],o=[];this.tabCount++,i.push("<li "+(t.url?'data-url="'+t.url+'" ':"")+' role="tab" class="'+(1==this.tabCount?"active":"")+'"  >'),i.push('<a href="javascript:void(0);">'),t.canRefresh&&i.push('<span class="fa fa-refresh" role="refresh"></span>'),i.push('<span class="k-tab-nav-title" title="'+t.title+'">'+t.title+"</span>"),t.canClose&&i.push('<span class="fa fa-close" role="close"></span>'),i.push("</a>"),i.push("</li>"),o.push('<div class="k-tab-content" '+(1==this.tabCount?'style="display:block;"':"")+">"),o.push(t.content),o.push("</div>");var s=o.join("");this.$tabNav.append(i.join("")),this.$tabContainer.append(s),1==this.tabCount&&t.url&&!this.isLoading&&(this.isLoading=!0,Loading.show(),$.get(t.url,{rand:(new Date).getTime()}).success(function(t){s.html(t)}).complete(function(){e.isLoading=!1,Loading.hide()})),this.setSize()}},Tab.prototype.toggle=function(t){if(this.curIndex!=t&&0!=this.$tabContainer.children().length){var e=this;this.curIndex=t;var i=this.$tabNav.children().removeClass("active").eq(t).addClass("active"),o=i.attr("data-url"),s=this.$tabContainer.children().hide().eq(t).show(),n=s.html().replace(/\s+/g,"");if(o&&0==n.length){if(this.isLoading)return;this.isLoading=!0,Loading.show(),$.get(o,{rand:(new Date).getTime()}).success(function(t){s.html(t)}).complete(function(){e.isLoading=!1,Loading.hide()})}this.scrollTo(t)}},Tab.prototype.close=function(t){if(1!=this.tabCount||!this.options.keepOne){this.tabCount--;var e=this.$tabNav.children().eq(t).remove();this.$tabContainer.children().eq(t).remove(),this.curIndex==t?(0!=t?t--:this.curIndex=-1,this.tabCount>0&&this.toggle(t)):this.curIndex!=t&&t<this.curIndex&&this.curIndex--,this._event.close.call(this,e),this.setSize()}},Tab.prototype.refresh=function(t){var e=this,i=this.$tabNav.children().eq(t),o=i.attr("data-url"),s=this.$tabContainer.children().eq(t);
if(o){if(this.isLoading)return;s.html(""),this.isLoading=!0,Loading.show(),$.get(o,{rand:(new Date).getTime()}).success(function(t){s.html(t)}).complete(function(){Loading.hide(),e.isLoading=!1,e._event.refresh.call(this,i)})}},Tab.prototype.scroll=function(t){var e=parseInt(this.$tabNav.css("margin-left"));"left"==t?(e+=70,e>0&&(e=0)):(e-=70,e<-this.maxLeft&&(e=-this.maxLeft)),this.$tabNav.stop().animate({marginLeft:e},300)},Tab.prototype.scrollTo=function(t){t=t||this.curIndex,t<0&&(t=0),t>this.tabCount-1&&(t=this.tabCount-1);var e=0;this.$tabNav.children().each(function(i){return i!=t&&void(e+=$(this).outerWidth())}),e>=Math.abs(this.maxLeft)&&(e=this.maxLeft),this.isScroller||(e=0),this.$tabNav.stop().animate({marginLeft:-e},300)},Tab.prototype.childResize=function(){var t=this.$tabContainer.find("div.k-tab");t.each(function(){var t=$.data(this,"tab");t&&t.setSize()})},Tab.Global=function($elms,options){$elms=$elms||$("div.k-tab"),$elms.each(function(){var $el=$(this),setting=$el.attr("data-options"),onClick=$el.attr("data-onclick"),onClose=$el.attr("data-onlose"),onRefresh=$el.attr("data-onrefresh"),data=$.data($el[0],"tab");data||(setting&&setting.length>0&&(options=eval("(0,"+setting+")")),data=new Tab($el,options),data.on("click",onClick&&onClick.length>0?eval("(0,"+onClick+")"):$.noop).on("close",onClose&&onClose.length>0?eval("(0,"+onClose+")"):$.noop).on("refresh",onRefresh&&onRefresh.length>0?eval("(0,"+onRefresh+")"):$.noop),$.data($el[0],"tab",data))})},Tab}),define("km/tagSelector",["jquery"],function($){var identity=1,$selector,$layer,$left,$top,$right,$bottom,method={setSidePosition:function(t){var e={width:t.outerWidth(),height:t.outerHeight(),top:t.offset().top,left:t.offset().left},i=0;$left.css({left:e.left-i,top:e.top,height:e.height}).show(),$top.css({left:e.left,top:e.top-i,width:e.width+2*i}).show(),$right.css({left:e.left+e.width+i,top:e.top,height:e.height}).show(),$bottom.css({left:e.left,top:e.top+e.height+i,width:e.width+2*i}).show()},sideHide:function(){$left.hide(),$top.hide(),$right.hide(),$bottom.hide()},showLayer:function(t){var e={width:t.outerWidth(),height:t.outerHeight(),top:t.offset().top,left:t.offset().left};$layer.show().css(e)},hideLayer:function(){$layer.hide()}};return function($elms,options){if(!$elms||$elms instanceof $||(options=$elms,$elms=$("[data-module=tagselector]")),options=$.extend(!0,{callback:{onClick:$.noop}},options||{}),$elms=$elms||$("[data-module=tagselector]"),$elms=$elms.map(function(){if(!this.getAttribute("data-isInit"))return this.setAttribute("data-isInit",!0),this}),$elms&&0!=$elms.length){if(!$selector){var html='<div class="k-tagSelector-layer"></div><div class="k-tagSelector-leftside"></div><div class="k-tagSelector-topside"></div><div class="k-tagSelector-rightside"></div><div class="k-tagSelector-bottomside"></div>';$selector=$(html).appendTo(document.body),$layer=$selector.filter("div.k-tagSelector-layer"),$left=$selector.filter("div.k-tagSelector-leftside"),$top=$selector.filter("div.k-tagSelector-topside"),$right=$selector.filter("div.k-tagSelector-rightside"),$bottom=$selector.filter("div.k-tagSelector-bottomside")}var $curElm;$elms.on("mouseover.tagSelector",function(){return method.setSidePosition($(this).addClass("k-tagSelector-curr")),!1}).on("mouseout.tagSelector",function(){$(this).removeClass("k-tagSelector-curr"),method.sideHide()}).on("click.tagSelector",function(){var $el=$(this),onclick=$el.attr("data-onclick");return $curElm=$el,method.showLayer($el,$layer),onclick&&onclick.length>0?(onclick=eval("(0,"+onclick+")"))($el):options.callback.onClick($el,$layer),!1}),$layer.on("click.tagSelector",function(){return $layer.hide(),!1}),$(window).on("resize.tagSelector",function(){$curElm&&method.showLayer($curElm,$layer)}),$(document).on("click.tagSelector",function(){$layer.hide(),$curElm=null})}}}),define("km/template",["jquery"],function(t){function e(t,e){var i="'use strict';var $each=$utils.each,$output=$utils.output,",o="$out='';",a="return new String($out);",r=[],l=h.partial(t,e,0);n.each(l.split(s.open),function(t,e){var i=e.split(s.close),n=i[0],a=i[1];1==i.length?o+=h.html(i[0]):(o+=h.script(r,n),a&&(o+=h.html(a)))});var p=i+r.join("")+o+a,d=new Function("$utils","$filter","$data",p);return d}var i=0,o="tpl_"+i,s={open:"{{",close:"}}"},n={each:function(t,e){t||(t=[]);for(var i,o=0;o<t.length&&(i=t[o],0!=e(o,i));o++);},dateFormat:function(t,e){t=t||new Date;var i,o,e=e||"yyyy-MM-dd",s={"y+":t.getFullYear(),"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(i in s)new RegExp("("+i+")").test(e)&&(o=s[i],e=e.replace(RegExp.$1,1===o.toString().length?"0"+o.toString():o));return e},output:function(t){return"undefined"==typeof t||null==t||"null"==t?"":t}},a={escape:function(t){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},nl2br:function(t){return String(t).replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br/>$2")},toText:function(t){return String(t).replace(/<[^>]+>/g,"")},subString:function(t,e,i){var o=/[^\x00-\xff]/g;if(e||(e=80),i||(i="..."),t.replace(o,"mm").length<=e)return t;for(var s=Math.floor(e/2),n=s;n<t.length;n++)if(t.substr(0,n).replace(o,"mm").length>=e)return t.substr(0,n)+i;return t},jsonDateFormat:function(t,e){if(!t)return"";if(t.indexOf("/Date")!=-1){var i=new Date(parseInt(t.replace("/Date(","").replace(")/",""),10));return n.dateFormat(i,e)}return t}},r="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",h={script:function(t,e){e=e.replace(/^\s/,"");var i=e.split(" "),o=i.shift(),s=i.join(" ");switch(o){case"each":var n=i[2],a=i[0];e="$each("+n+",function(index,"+a+") {";break;case"/each":e="});";break;case"for":e="for ( var "+s+") {";break;case"/for":e="}";break;case"if":e="if ("+s+") {";break;case"else":i="if"===i.shift()?" if("+i.join(" ")+")":"",e="}else"+i+"{";break;case"/if":e="}";break;default:if(/^[^\s]+\s*\|\s*[a-z]+\s*:?/.test(e)){var r=h.filtered(o,s);e=r?"$out+=$output("+r+");":"$out+=$output("+o+");"}else e=e.indexOf("?")!=-1&&e.indexOf(":")!=-1?"$out+=$output("+e+");":"$out+=$output("+o+");"}return h.setVariable(t,e),e+"\n"},html:function(t){return t=t.replace("/s+/g"," ").replace(/<!--.*?-->/g,""),t&&(t="$out+="+h.stringify(t)+";\n"),t},stringify:function(t){return"'"+t.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"},filtered:function(t,e){var i="",o=0;return n.each(e.split("|"),function(e,s){var n=s.split(":"),r=n.shift(),h=n.join(":")||"";h&&(h=","+h),r=r.replace(/\s+/g,""),r&&a[r]&&(i=0==o?"$filter."+r+"("+t+h+")":"$filter."+r+"("+i+h+")",o++)}),i},setVariable:function(t,e){e=e.replace(/\s*\.\s*[$\w\.]+/g,"").replace(/[^\w$]+/g,",").replace(new RegExp(["\\b"+r.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),"").replace(/^\d[^,]*|,\d[^,]*/g,"").replace(/^,+|,+$/g,"").split(/^$|,+/),e&&n.each(e,function(e,i){if(i&&!t[i]&&0!=i.indexOf("$")){var o="$data."+i;t.push(i+"="+o+","),t[i]=!0}})},partial:function(t,e,i){var o;if(t.indexOf("partial")==-1||!e||i>=5)return t;for(var n in e)o=new RegExp(s.open+"\\s*partial\\s*('|\")"+n+"('|\")\\s*"+s.close,"ig"),t=t.replace(o,e[n]);return i++,this.partial(t,e,i)}},l=function(e,s){++i,this.$el=e,this.options=t.extend(!0,{tpl:"",data:{},partial:null},s),this.data=this.options.data,this.tpl=this.options.tpl,this.fileName=o,this.init()};return l.prototype.init=function(){if(this.tpl)try{this.Render=e(this.tpl,this.options.partial)}catch(t){throw t}},l.prototype.render=function(){if(this.tpl){var t=this.Render(n,a,this.data);return this.$el&&this.$el.html(t),t}},l.load=function(e,i){var o=t.Deferred(),s=e.split("/");if(s.length>=2){var n=s.pop(),a=s.join("/");require(["tpl/"+a],function(e){var s;s=e[n]?t.trim(e[n]):"",i?i(s):o.resolve(s)})}return o.promise()},l.addFilter=function(t,e){a[t]=e},l.compile=function(t,i,o){return e(t,o)(n,a,i)},l}),define("km/tooltips",["jquery"],function($){function Tooltips(t,e){this.$element=t,this.options=$.extend(!0,{delay:0,content:"",tipClass:"",placement:"right",trigger:"hover click",container:$(document.body),type:"tooltips",scrollContainer:null,tpl:'<div class="k-tooltips"><div class="k-tooltips-arrow"></div><div class="k-tooltips-inner"></div></div>'},e),this.init()}return Tooltips.prototype.init=function(){var t=this;this.$tips=$(this.options.tpl),this.$tips.addClass(this.options.placement).addClass(this.options.tipClass),this.$container=$(this.options.container),this.setContent(),this.isShow=!1;for(var e,i=this.options.trigger.split(" "),o=0;o<i.length;o++)if(e=i[o],"click"===e)this.$element.on(e+"."+this.options.type,$.proxy(this.toggle,this));else if("manual"!=e){var s="hover"===e?"mouseenter":"focus",n="hover"===e?"mouseleave":"blur";this.$element.on(s+"."+this.options.type,$.proxy(this.show,this)),this.$element.on(n+"."+this.options.type,$.proxy(this.hide,this))}"BODY"!==this.$container[0].nodeName&&this.$container.css("position","relative"),this.$container.append(this.$tips),$(window).on("resize."+this.options.type,function(){t.setPosition()}),this.hide()},Tooltips.prototype.setContent=function(t){t=$.trim(t||this.options.content),0===t.length&&(t=this.$element.attr("data-content")||"");var e=this.$tips;e.find(".k-tooltips-inner").html(t)},Tooltips.prototype.setPosition=function(){var t=this.getPosition();this.$tips.css(t)},Tooltips.prototype.getPosition=function(){var t,e=this.options.placement,i=(this.options.container,this.$element),o=(i.parent(),this.$tips),s=i.outerWidth(),n=i.outerHeight(),a=o.outerWidth(),r=o.outerHeight(),h={left:0,top:0},l=i[0];do h.left+=l.offsetLeft-l.scrollLeft,h.top+=l.offsetTop-l.scrollTop;while((l=l.offsetParent)&&l!=this.$container[0]);switch(e){case"left":t={top:h.top+n/2-r/2,left:h.left-a};break;case"top":t={top:h.top-r,left:h.left+s/2-a/2};break;case"right":t={top:h.top+n/2-r/2,left:h.left+s};break;case"bottom":t={top:h.top+n,left:h.left+s/2-a/2}}return t},Tooltips.prototype.show=function(){return 0===$.trim(this.options.content).length?void this.hide():(this.isShow=!0,this.setPosition(),this.$tips.show().addClass("in"),void this.setPosition())},Tooltips.prototype.hide=function(){this.isShow=!1,this.$tips.hide().removeClass("in")},Tooltips.prototype.toggle=function(){this.isShow?this.hide():this.show()},Tooltips.prototype.destroy=function(){this.$tips.remove()},Tooltips.Global=function($elements){var $elements=$elements||$('[data-module="tooltips"]');$elements.each(function(){var $this=$(this),tooltips=Tooltips.Get($this);if(!tooltips){var options=$this.attr("data-options");options=options&&options.length>0?eval("(0,"+options+")"):{title:$this.attr("data-title"),content:$this.attr("data-content"),placement:$this.attr("data-placement"),tipClass:$this.attr("data-tipClass"),trigger:$this.attr("data-trigger")},tooltips=new Tooltips($this,options),Tooltips.Set($this,tooltips)}})},Tooltips.Get=function(t){return $.data(t[0],"tooltips")},Tooltips.Set=function(t,e){$.data(t[0],"tooltips",e)},Tooltips}),define("km/tree",["jquery","km/dragdrop"],function(t,e){var i={className:{ICON:"icon",SWITCH:"switch"},floder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom"},node:{SELECTED:"selected"}},o={isArray:function(t){return t instanceof Array},getIndex:function(t,e){for(var i=0;i<e.length;i++)if(t.nodeId===e[i].nodeId)return i;return-1}},s=!1,n={getLineHtml:function(t,e){if(e.view.showLine){var o=i.line.CENTER;return t.isSingle?o=i.line.ROOT:t.isFirst&&0===t.parentId?o=i.line.ROOTS:t.isLast&&(o=i.line.BOTTOM),o+=t.hasChildren?t.open?"_"+i.floder.OPEN:"_"+i.floder.CLOSE:"_"+i.floder.DOCU,'<span id="switch_'+t.nodeId+'" nId="'+t.nodeId+'" class="'+i.className.ICON+" "+i.className.SWITCH+" "+o+'"></span>'}},getIconHtml:function(t,e){if(e.view.showIcon)return html='<span id="'+i.className.ICON+"_"+t.nodeId+'" class="'+i.className.ICON+" ico_"+i.floder.DOCU+'"></span>',t.hasChildren&&(t.open?html='<span id="'+i.className.ICON+"_"+t.nodeId+'"  class="'+i.className.ICON+" ico_"+i.floder.OPEN+'"></span>':html='<span id="'+i.className.ICON+"_"+t.nodeId+'"  class="'+i.className.ICON+" ico_"+i.floder.CLOSE+'"></span>'),html},getChkHtml:function(t,e){if(!e.check.enable||t.noCheck)return"";var o,n=String(t.isChecked===!0);return"radio"===e.check.chkType&&(s?n=!1:s=!0),o=e.check.chkType+"_"+n+"_"+(t.checkDisabled?"part":"full"),'<span id="chk_'+t.nodeId+'" nId="'+t.nodeId+'" class="'+i.className.ICON+" chk "+o+'"></span>'},replaceSwitchClass:function(t,e){var o=t.attr("class");if(o){var s=o.split("_");switch(e){case i.line.ROOT:case i.line.ROOTS:case i.line.CENTER:case i.line.BOTTOM:s[0]=i.className.ICON+" "+i.className.SWITCH+" "+e;break;case i.floder.OPEN:case i.floder.CLOSE:case i.floder.DOCU:s[1]=e}t.attr("class",s.join("_"))}},replaceChkClass:function(t,e){t&&0!=t.length&&t.attr("class",t.attr("class").replace(e?"false":"true",e?"true":"false"))}},a=function(e,i){this.$element=e,this.options=t.extend(!0,{selectLimit:!1,data:[],edit:{enable:!1},check:{enable:!1,chkType:"checkbox",chkBoxType:{Y:"ps",N:"ps"},keepSearch:!1},callback:{beforeCheck:t.noop,beforeSelect:t.noop,beforeAdd:t.noop,beforeRemove:t.noop,onCheck:t.noop,onSelect:t.noop,onAdd:t.noop,onRemove:t.noop},view:{showLine:!0,showIcon:!0}},i),this.nodes={},this.prefix="node",this.init()};return a.prototype.init=function(){this.initNodes(this.options.data),this.createTree(),this.eventBind()},a.prototype.initNodes=function(t,e){if(o.isArray(t)&&0!==t.length)for(var i,s=0;s<t.length;s++)i=t[s],0===s&&s+1<t.length?i.isFirst=!0:0===s&&s+1==t.length?i.isSingle=!0:s+1===t.length&&(i.isLast=!0),!i.parentId&&e&&(i.parentId=e.nodeId),i.hasChildren=this.hasChildren(i),i.isParent=i.hasChildren,i.parent=e,this.nodes[this.prefix+i.nodeId]=i,this.initNodes(i.nodes,i)},a.prototype.eventBind=function(){var e=this;this.$element.on("click.tree","."+i.className.SWITCH,function(){var o=t(this),s=o.attr("nId"),a=e.$tree.find("#ul_"+s),r=e.$tree.find("#icon_"+s);0!==a.length&&a.slideToggle("fast",function(){n.replaceSwitchClass(o,"none"===a[0].style.display?i.floder.CLOSE:i.floder.OPEN),n.replaceSwitchClass(r,"none"===a[0].style.display?i.floder.CLOSE:i.floder.OPEN)})}).on("click.tree",".chk",function(){var i=t(this),o=i.attr("nId"),s=e.getNode(o),a=this.className,r=e.getCheckedNodes(),h=a.indexOf("true")===-1;if(e.options.callback.beforeCheck()!==!1&&!s.checkDisabled){if(s.isChecked=h,n.replaceChkClass(i,s.isChecked),"checkbox"===e.options.check.chkType)e.check(s);else for(var l=0;l<r.length;l++)r[l]!=s&&(r[l].isChecked=!1,n.replaceChkClass(e.$tree.find("#chk_"+r[l].nodeId),!1));e.options.callback.onCheck(s)}}).on("click.tree","a",function(){var o=t(this),s=o.attr("nid"),n=e.getNode(s);n.selectDisabled||e.options.callback.beforeSelect()!==!1&&(o.hasClass(i.node.SELECTED)&&e.options.selectLimit||(e.$element.find("a").removeClass(i.node.SELECTED),o.addClass(i.node.SELECTED),e.options.callback.onSelect(e.getSelectedNode())))}).on("click.tree",".add",function(){t(this)}).on("click.tree",".edit",function(){t(this)}).on("click.tree",".remove",function(){t(this)})},a.prototype.createTree=function(){var e=[];e.push('<ul class="k-tree">'),this.createNode(this.options.data,e),e.push("</ul>"),this.$tree=t(e.join("")),this.$element.append(this.$tree)},a.prototype.createNode=function(t,e,s){var a,r="line";if(o.isArray(t)&&0!==t.length&&o.isArray(e)){if(s){if(0==s.canBuild)return;(s.isLast||s.isSingle)&&(r=""),s.open?e.push('<ul id="ul_'+s.nodeId+'" class="'+r+'">'):e.push('<ul id="ul_'+s.nodeId+'" style="display:none;" class="'+r+'" >')}for(var a,h=0;h<t.length;h++)a=this.getNode(t[h].nodeId),a&&0!=a.canBuild&&(e.push('<li id="li_'+a.nodeId+'" nId="'+a.nodeId+'">'),e.push(n.getLineHtml(a,this.options)),e.push(n.getChkHtml(a,this.options)),e.push('<a href="javascript:void(0);" id="a_'+a.nodeId+'" nId="'+a.nodeId+'" class="'+(a.selected?i.node.SELECTED:"")+" "+(a.selectDisabled?"disabled":"")+'" >'),e.push(n.getIconHtml(a,this.options)),e.push("<span>"+a.text+"</span>"),e.push("</a>"),this.createNode(a.nodes,e,a),e.push("</li>"));s&&e.push("</ul>")}},a.prototype.addNodes=function(e,s){var e,a=[];if(o.isArray(s)||(s=[s]),e=e||this.getNode(s[0].parentId),this.initNodes(s),this.createNode(s,a),e){var r=this.$tree.find("#li_"+e.nodeId),h=r.find("#ul_"+e.nodeId);if(0===h.length){e.nodes=s;var l=r.find("#"+i.className.SWITCH+"_"+e.nodeId),p=r.find("#"+i.className.ICON+"_"+e.nodeId);h=t('<ul class="'+(e.isLast?"":"line")+'" />').attr("id","ul_"+e.nodeId),n.replaceSwitchClass(l,i.floder.OPEN),n.replaceSwitchClass(p,i.floder.OPEN)}else{var d=e.nodes[e.nodes.length-1],c=r.find("#li_"+d.nodeId);c.children("ul").addClass("line");var l=c.find("#"+i.className.SWITCH+"_"+d.nodeId);d.isLast=!1,n.replaceSwitchClass(l,i.line.CENTER),Array.prototype.push.apply(e.nodes,s)}h.append(a.join("")).appendTo(r)}else{var c=this.$tree.children("li").last(),u=c.find("#ul_"+c.attr("nid"));u.addClass("line"),this.$tree.append(a.join(""))}},a.prototype.removeNode=function(t){if(t){for(var e=this.getNode(t.parentId),s=this.getChildNodes(t),a=this.$tree.find("#li_"+t.parentId),r=this.$tree.find("#li_"+t.nodeId),h=r.prev(),l=r.next(),p=this.getNode(h.attr("nId")),d=this.getNode(l.attr("nId")),c=0;c<s.length;c++)this.$tree.find("#li_"+s[c].nodeId).remove(),delete this.nodes[this.prefix+s[c].nodeId];if(e){var u=o.getIndex(t,e.nodes);u>=0&&e.nodes.splice(u,1),0===e.nodes.length&&(r.parent().remove(),e.isParent=!1,e.open=!1,n.replaceSwitchClass(a.find("#"+i.className.SWITCH+"_"+e.nodeId),i.floder.DOCU),n.replaceSwitchClass(a.find("#"+i.className.ICON+"_"+e.nodeId),i.floder.DOCU))}p&&t.isLast&&(p.isLast=!0,h.children("ul").removeClass("line"),p.isFirst&&0===p.parentId?n.replaceSwitchClass(h.find("#"+i.className.SWITCH+"_"+p.nodeId),i.line.ROOT):n.replaceSwitchClass(h.find("#"+i.className.SWITCH+"_"+p.nodeId),i.line.BOTTOM)),t.isFirst&&0===t.parentId&&d&&(d.isFirst=!0,n.replaceSwitchClass(l.find("#"+i.className.SWITCH+"_"+d.nodeId),i.line.ROOT)),r.remove(),delete this.nodes[this.prefix+t.nodeId]}},a.prototype.check=function(t){function e(t,e){for(var i=!0;t&&o.isArray(t.nodes);){for(var s,n=0;n<t.nodes.length;n++)if(s=t.nodes[n],s.isChecked){i=!1;break}if(!i)return;this.checkAction([t],e),i=!0,t=this.getNode(t.parentId)}}var i=this.getParentNodes(t),s=this.getChildNodes(t),n=this.getNode(t.parentId),a=this.options;if(t.isChecked)switch(a.check.chkBoxType.Y.toLowerCase()){case"p":this.checkAction(i,t.isChecked);break;case"s":this.checkAction(s,t.isChecked);break;case"ps":this.checkAction(i,t.isChecked),this.checkAction(s,t.isChecked)}else switch(a.check.chkBoxType.N.toLowerCase()){case"p":e.call(this,n,t.isChecked);break;case"s":this.checkAction(s,t.isChecked);break;case"ps":e.call(this,n,t.isChecked),this.checkAction(s,t.isChecked)}},a.prototype.checkAction=function(t,e){for(var i,o,s=0;s<t.length;s++)i=t[s],i.isChecked=e,o=this.$tree.find("#chk_"+i.nodeId),i.checkDisabled||n.replaceChkClass(o,e)},a.prototype.getParentChildNodes=function(t){var e=this.getParentNodes(t);return this.getChildNodes(t,e),e},a.prototype.getParentNodes=function(t){for(var e=this.nodes[this.prefix+t.parentId],i=[];e;)i.push(e),e=this.nodes[this.prefix+e.parentId];return i},a.prototype.getChildNodes=function(t,e){if(e||(e=[]),!o.isArray(t.nodes))return e;for(var i=0;i<t.nodes.length;i++)e.push(t.nodes[i]),this.getChildNodes(t.nodes[i],e);return e},a.prototype.getSelectedNode=function(){var t=this.$tree.find("a."+i.node.SELECTED);if(0===t.length)return null;var e=t.attr("nId");return this.getNode(e)},a.prototype.getCheckedNodes=function(){var t=[];for(var e in this.nodes)this.nodes[e].isChecked&&t.push(this.nodes[e]);return t},a.prototype.getNode=function(t){return this.nodes[this.prefix+t]},a.prototype.hasChildren=function(t){return!!(t&&o.isArray(t.nodes)&&t.nodes.length>0)},a.prototype.selectNode=function(t){if(t){var e=this.getNode(t);e&&!e.selectDisabled&&this.$tree.find("#a_"+t).click()}},a.prototype.unSelectNode=function(e,o){o=o||t.noop;var s,n=this.$tree.find("#a_"+e),e=n.attr("nid");0!=n.length&&n.hasClass(i.node.SELECTED)&&(s=this.getNode(e),n.removeClass(i.node.SELECTED),o(this.getNode(e)))},a.prototype.checkNode=function(t){var e=this.$tree.find("#chk_"+t),i=e.attr("class");0!=e.length&&i.indexOf("false")!=-1&&e.click()},a.prototype.unCheckNode=function(t){var e=this.$tree.find("#chk_"+t),i=e.attr("class");0!=e.length&&i.indexOf("true")!=-1&&e.click()},a.prototype.search=function(t){function e(t,e,i){var s=function(t){t&&!t.canBuild&&(t.canBuild=!0,s(t.parent))},n=function(t,e,i){if(o.isArray(t)&&0!==t.length)for(var a,r=0;r<t.length;r++)a=t[r],a.canBuild=!1,i.check.keepSearch||(a.isChecked=!1),e?a.text.indexOf(e)==-1?a.canBuild=!1:(a.canBuild=!0,s(a.parent)):a.canBuild=!0,n(a.nodes,e,i)};n(t,e,i)}if(this.options.data){var i=[];e(this.options.data,t,this.options),this.createNode(this.options.data,i),this.$tree.children("li").remove().end().html(i.join(""))}},a.prototype.getNodesByText=function(t){var e=[];if(this.nodes)for(var i in this.nodes)this.nodes[i].text.toLowerCase()==t.toLowerCase()&&e.push(this.nodes[i]);return e},a.prototype.getNodesByValue=function(t){var e=[];if(this.nodes)for(var i in this.nodes)this.nodes[i].value.toLowerCase()==t.toLowerCase()&&e.push(this.nodes[i]);return e},a.prototype.setDisabled=function(t,e){var i=this.getNode(t);i&&("undefined"==typeof e&&(e=!0),e?(this.unCheckNode(t),this.unSelectNode(t),i.checkDisabled=!0,i.selectDisabled=!0,this.$tree.find("#a_"+t).addClass("disabled"),this.$tree.find("#chk_"+t).addClass(this.options.check.chkType+"_false_part")):(i.checkDisabled=!1,i.selectDisabled=!1,this.$tree.find("#a_"+t).removeClass("disabled"),this.$tree.find("#chk_"+t).removeClass(this.options.check.chkType+"_false_part")))},a.prototype.reload=function(t){t=t||this.options.data;var e=[];this.nodes={},this.initNodes(t),this.options.data=t,this.createNode(this.options.data,e),this.$tree.children("li").remove().end().html(e.join(""))},a}),define("km/treeTable",["jquery","km/ajax"],function(t,e){function i(e,i){this.$elm=e,this.options=t.extend(!0,{expanded:!0,className:"k-treeTable",url:"",params:null,column:0,columns:[],data:[],checkType:{Y:"ps",N:"ps"}},i),this.init()}return i.prototype.init=function(){var t=this;this.options.data&&this.options.data.length>0?(this.data=this.options.data,this.dataInit(),this.build(),this.watch()):this.options.url&&this.options.url.length>0&&t.reload()},i.prototype.watch=function(){var e=this;this.$elm.on("click.treetable",".indenter a",function(){var i=t(this).attr("data-nodeId"),o=t("#treeRow_"+i),s=e.getChildren(e.objData[i]);return o.hasClass("expanded")?(o.removeClass("expanded").addClass("collapsed"),e.collapsed(s)):(o.removeClass("collapsed").addClass("expanded"),e.expanded(s)),!1}).on("click.treetable","tbody tr",function(){var i=t(this),o=i.attr("data-nodeId"),s=e.objData[o];s.enableCheck&&(i.hasClass("selected")?(i.removeClass("selected"),i.find("td:eq(0)").find("input").prop("checked",!1),s.checked=!1,e.check(s,!1)):(i.addClass("selected"),i.find("td:eq(0)").find("input").prop("checked",!0),s.checked=!0,e.check(s,!0)))}).on("click.treetable","[role=checkall]",function(){for(var i,o=t(this),s=(e.$elm.find("tbody tr"),o.prop("checked")),n=0;n<e.data.length;n++)i=e.data[n],i.enableCheck&&(i.checked=s,s?(t("#treeRow_"+i.nodeId).addClass("selected"),t("#treeCheckBox_"+i.nodeId).prop("checked",!0)):(t("#treeRow_"+i.nodeId).removeClass("selected"),t("#treeCheckBox_"+i.nodeId).prop("checked",!1))),e.data[n].checked=s})},i.prototype.dataInit=function(){function e(e,i){var o=function(i,s,n,a){for(var r,h=0;h<e.length;h++)r=e[h],r.parentId==i&&(r.hasParent=!0,0==r.parentId&&(r.isRoot=!0,r.level=1,r.hasParent=!1),n&&(n.hasChild=!0,r.level=n.level+1||1,r.parent=n,t.isArray(n.children)||(n.children=[]),n.children.push(r.nodeId)),s.push(r),o(r.nodeId,s,r))};o(0,i,null,1)}var i=[];this.data;this.objData={},e(this.data,i),0==i.length&&(i=this.data);for(var o=0;o<i.length;o++)this.objData[i[o].nodeId]=i[o],null!=i[o].enableCheck&&"undefined"!=typeof i[o].enableCheck||(i[o].enableCheck=!0);this.data=i},i.prototype.build=function(){var t=[],e=this.options.columns;t.push('<table class="'+this.options.className+'">'),t.push("<thead>");for(var i,o=0;o<e.length;o++)i=e[o],i.checkbox?(t.push('<th style="text-align:'+(i.align?i.align:"left")+'">'),t.push('<input type="checkbox" role="checkall" />'),t.push("</th>")):t.push('<th style="text-align:'+(i.align?i.align:"left")+'">'+i.title+"</th>");t.push("</thead>"),t.push("<tbody>");for(var s,n,a,o=0;o<this.data.length;o++){s=this.data[o],n="",a="",s.hasChild&&(this.options.expanded?n="expanded":(n="collapsed",s.isRoot||(a="hide"))),!this.options.expanded&&s.hasParent&&s.parentId>0&&(a="hide");var r="";this.options.columns[0].checkbox&&s.checked&&(r="selected"),t.push('<tr class="'+n+" "+a+" "+r+'" id="treeRow_'+s.nodeId+'"  data-parentId="'+s.parentId+'" data-nodeId="'+s.nodeId+'" data-level="'+s.level+'">');for(var i,h=0;h<e.length;h++)if(i=e[h],i.checkbox){var l="";s.checked&&(l=' checked="checked" '),s.enableCheck||(l+=' disabled="disabled" '),t.push('<td style="text-align:'+(i.align?i.align:"left")+'">'),t.push('<input type="checkbox" id="treeCheckBox_'+s.nodeId+'" value="'+s[i.field]+'"  '+l+"  />"),t.push("</td>")}else{var p="",d="";h==this.options.column&&(s.hasChild?(p='<span class="indenter" style="padding-left: '+(s.level>1?19*s.level:0)+'px;"><a href="#" title="Collapse" data-nodeId="'+s.nodeId+'">&nbsp;</a></span>',d='<span class="folder">'+("function"==typeof i.formatter?i.formatter(s[i.field],s):s[i.field])+"</span>"):(p='<span class="indenter" style="padding-left: '+(s.level>1?19*s.level:0)+'px;"></span>',d='<span class="file">'+("function"==typeof i.formatter?i.formatter(s[i.field],s):s[i.field])+"</span>")),"function"==typeof i.formatter?(t.push('<td style="text-align:'+(i.align?i.align:"left")+'">'),t.push(p),t.push(d.length>0?d:i.formatter(s[i.field],s)),t.push("</td>")):(t.push('<td style="text-align:'+(i.align?i.align:"left")+'">'),t.push(p),t.push(d.length>0?d:s[i.field]),t.push("</td>"))}t.push("</tr>")}t.push("</tbody>"),t.push("</table>"),this.$elm.html(t.join(""))},i.prototype.check=function(e,i){function o(i,o){for(var s=0;s<o.length;s++)if(o[s].checked){r=!1;break}var n=e.parent;for(r&&n&&n.enableCheck&&(n.checked=!1,t("#treeRow_"+n.nodeId).removeClass("selected"),t("#treeCheckBox_"+n.nodeId).prop("checked",!1));n;){for(var a=this.getBrothers(n),s=0;s<a.length;s++)if(a[s].checked){r=!1;break}if(!r||!n.enableCheck)break;n.checked=!1,t("#treeRow_"+n.nodeId).removeClass("selected"),t("#treeCheckBox_"+n.nodeId).prop("checked",!1),n=n.parent}}var s=this.getParents(e),n=this.getChildren(e),a=this.getBrothers(e),r=!0;t("#treeRow_"+e.nodeId),t("#treeCheckBox_"+e.nodeId);if(i)switch(this.options.checkType.Y.toLowerCase()){case"p":this.checkAction(s,i);break;case"s":this.checkAction(n,i);break;default:this.checkAction(s,i),this.checkAction(n,i)}else switch(this.options.checkType.N.toLowerCase()){case"p":o.call(this,e,a);break;case"s":this.checkAction(n,i);break;default:o.call(this,e,a),this.checkAction(n,i)}},i.prototype.checkAction=function(e,i){for(var o,s,n,a=0;a<e.length;a++)o=e[a],n=t("#treeCheckBox_"+o.nodeId),s=t("#treeRow_"+o.nodeId),o.enableCheck&&(i?(o.checked=!0,s.addClass("selected"),n.prop("checked",!0)):(o.checked=!1,s.removeClass("selected"),n.prop("checked",!1)))},i.prototype.expanded=function(e){for(var i,o,s,n=0;n<e.length;n++)i=e[n],o=t("#treeRow_"+i.nodeId),s=t("#treeRow_"+i.parentId),s.hasClass("collapsed")?o.addClass("hide"):o.removeClass("hide")},i.prototype.collapsed=function(e){for(var i,o,s=0;s<e.length;s++)i=e[s],o=t("#treeRow_"+i.nodeId),o.addClass("hide")},i.prototype.getParents=function(t){for(var e=[],i=t.parent;i;)e.push(i),i=i.parent;return e},i.prototype.getBrothers=function(t){for(var e,i=[],o=0;o<this.data.length;o++)e=this.data[o],t.parentId==e.parentId&&e.nodeId!=t.nodeId&&i.push(e);return i},i.prototype.getChildren=function(t){var e=[],i=function(t,e,o){if(t.children)for(var s,n=0;n<t.children.length;n++)s=o[t.children[n]],e.push(s),s.hasChild&&i(s,e,o)};return i(t,e,this.objData),e},i.prototype.reload=function(){var t=this;e.get(this.options.url,this.options.params).done(function(e){if(!e)return void(e=[]);for(var i,o=0;o<e.length;o++)i=e[o],i.Checked&&(i.checked=i.Checked),i.EnableCheck&&(i.enableCheck=i.EnableCheck),i.Level&&(i.level=i.Level);t.data=e,t.dataInit(),t.build(),t.watch()})},i.prototype.loadData=function(){},i.prototype.getSelectRows=function(){var t=[];if(!this.data)return t;for(var e,i=0;i<this.data.length;i++)e=this.data[i],e.checked&&t.push(e);return t},i}),define("km/upload",["jquery","spin","km/window","km/ajax","km/event","km/popTips","jqueryForm"],function($,Spinner,Window,ajax,Event,popTips){var method={showLoading:function(){this.spinner.spin(this.$loadingBox.get(0)),this.$loadingBox.css("display","inline-block"),this.$uploadIcon.hide()},hideLoading:function(){this.$loadingBox.hide(),this.spinner.stop(),this.$uploadIcon.show()}},Upload=function(t,e){this.$elm=t,this.options=$.extend(!0,{uploadUrl:null,removeUrl:null,$target:null,fontClassName:"fa fa-upload",text:"上传",name:"file",uploadedUrls:[],showResult:!0,popTips:{enable:!0,delay:600}},e),this.options.removeUrl&&0==this.options.removeUrl.length&&(this.options.removeUrl=null),this.isLoading=!1,this.isButton="text"!=this.$elm[0].type.toLowerCase(),this._event={beforeSubmit:$.noop,success:$.noop,error:$.noop},this.init()};return Upload.prototype.init=function(){this.spinner=new Spinner({lines:9,length:3,width:2,radius:2,scale:.2,corners:.6,rotate:4,direction:1,color:"#222222",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"5px",left:"10px"}),this.uploadedUrls=this.options.uploadedUrls,this.build(),this.watch()},Upload.prototype.watch=function(){var t=this;this.$uploadBox.on("change.upload","[data-role=upfile]",function(){t.upload()}).on("click.upload",".fa-close",function(){var e=$(this),i=e.parents(".k-upload-result:eq(0)"),o=i.attr("data-url");t.isLoading||Window.confirm("您确认要删除该文件吗？",function(){t.removeFile(t.isButton?{filePath:o}:null)})})},Upload.prototype.build=function(){var t=[],e=[];if(t.push('<div class="k-upload-box">'),this.isButton&&this.options.showResult){if(t.push('<div class="k-upload-result-box">'),this.options.uploadedUrls.length>0)for(var i=0;i<this.options.uploadedUrls.length;i++)t.push('<div class="k-upload-result" data-url="'+this.options.uploadedUrls[i]+'">'),t.push('<span title="'+this.options.uploadedUrls[i]+'">'+this.options.uploadedUrls[i]+"</span>"),t.push('<i class="fa fa-close" style="display:'+(this.options.removeUrl?"block":"none")+';"></i>'),t.push("</div>");t.push("</div>")}if(t.push('<div class="button-box">'),t.push('<button type="button" class="k-btn k-btn-default">'),t.push('<div class="loading-box"></div>'),t.push('<span class="k-upload-icon '+this.options.fontClassName+'"></span>&nbsp;'),t.push(this.options.text),t.push("</button>"),t.push('<form action="'+this.options.uploadUrl+'" enctype="multipart/form-data" method="post">'),t.push('<input type="file" data-role="upfile" name="'+this.options.name+'" />'),t.push("</form>"),t.push("</div>"),t.push("</div>"),!this.isButton){var o=$.trim(this.$elm.val());e.push('<div class="k-input-group k-input-group-upload">'),e.push('<i class="fa fa-close" style="display:'+(this.options.removeUrl&&o.length>0?"block":"none")+';"></i>'),e.push('<span class="k-input-group-btn">'),e.push(t.join("")),e.push("</span>"),e.push("</div>")}this.$uploadBox=$(0==e.length?t.join(""):e.join("")),this.$buttonBox=this.$uploadBox.find(".button-box"),
this.$button=this.$uploadBox.find("button"),this.$file=this.$uploadBox.find("input[type=file]"),this.$form=this.$uploadBox.find("form"),this.$resultBox=this.$uploadBox.find(".k-upload-result-box"),this.$txtResult=this.isButton?null:this.$elm,this.$close=this.$uploadBox.find(".fa-close"),this.$uploadBox.appendTo(this.$elm.parent()),this.$uploadIcon=this.$uploadBox.find(".k-upload-icon"),this.$loadingBox=this.$buttonBox.find(".loading-box"),this.isButton?this.$elm.hide():(this.$elm.attr({"class":"k-form-control"}).prependTo(this.$uploadBox),this.$close.css("right",this.$button.outerWidth()+10))},Upload.prototype.upload=function(){var self=this;this.isLoading||(this.isLoading=!0,method.showLoading.call(this),this.$form.ajaxSubmit({url:this.$form.attr("action"),cache:!1,beforeSubmit:function(){var t=self._event.beforeSubmit();return 0==t&&method.hideLoading.call(self),self.isLoading=!1,setTimeout(function(){self.$file.remove(),self.$file=$('<input type="file" data-role="upfile" name="'+self.options.name+'" />'),self.$form.append(self.$file)},100),t},success:function(ret){"string"==typeof ret&&(ret=eval("(0,"+ret+")")),self.isButton&&ret.Url&&ret.Url.length>0&&self.uploadedUrls.push(ret.Url),self.showResult(ret.Url||""),self._event.success(ret)},error:function(){self._event.error()},complete:function(){self.isLoading=!1,method.hideLoading.call(self),setTimeout(function(){self.$file.remove(),self.$file=$('<input type="file" data-role="upfile" name="'+self.options.name+'" />'),self.$form.append(self.$file)},100)}}))},Upload.prototype.removeFile=function(t){var e=this;this.isLoading||(this.isLoading=!0,t=t||{filePath:this.url},ajax.post(this.options.removeUrl,t,{redirectEnable:!1,loadingEnable:!0,popTips:{enable:this.options.popTips.enable,delay:this.options.delay,inCallback:!1}}).done(function(i){(i.Status||i.status)&&e.hideResult(t.filePath)}).always(function(){e.isLoading=!1}))},Upload.prototype.showResult=function(t){this.url=t,this.isButton?(this.options.showResult&&this.$resultBox.append('<div class="k-upload-result" data-url="'+t+'"><span title="'+t+'">'+t+'</span><i class="fa fa-close" style="display:'+(this.options.removeUrl?"block":"none")+';"></i></div>'),this.options.$target&&this.options.$target.val(this.uploadedUrls.join(","))):(this.$txtResult.val(t),this.options.removeUrl&&this.$close.fadeIn(),this.options.$target&&this.options.$target.val(t))},Upload.prototype.hideResult=function(t){var e=-1;if(this.isButton){this.$resultBox.children('div[data-url="'+t+'"]').remove();for(var i=0;i<this.uploadedUrls.length;i++)if(this.uploadedUrls[i]==t){e=i;break}i>=0&&this.uploadedUrls.splice(e,1),this.options.$target&&this.options.$target.val(this.uploadedUrls.join(","))}else this.$txtResult.val(""),this.$close.hide(),this.options.$target&&this.options.$target.val("")},Upload.prototype.on=function(t,e){return this._event[t]=e||$.noop,this},Upload.prototype.changeUrl=function(t){this.options.uploadUrl=t,this.$form.attr("action",t)},Upload.Global=function($elms){$elms=$elms||$("button[data-module=upload],input[data-module=upload]"),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),uploadUrl=$el.attr("data-uploadurl"),removeUrl=$el.attr("data-removeurl"),name=$el.attr("data-name"),text=$el.attr("data-text"),loadingEnable=$el.attr("data-loadingEnable"),popTips=$el.attr("data-popTips"),beforeSubmit=$el.attr("data-beforeSubmit"),success=$el.attr("data-success"),error=$el.attr("data-error"),data=$.data($el[0],"upload");data||(options=options&&options.length>0?eval("(0,"+options+")"):{uploadUrl:uploadUrl&&uploadUrl.length>0?uploadUrl:null,removeUrl:removeUrl&&removeUrl.length>0?removeUrl:null,name:name&&name.length>0?name:"file",text:text&&text.length>0?text:"上传",loadingEnable:!loadingEnable||"false"!=loadingEnable,popTips:popTips&&popTips.length>0?eval("(0,"+popTips+")"):{}},data=new Upload($el,options),data.on("beforeSubmit",beforeSubmit&&beforeSubmit.length>0?eval("(0,"+beforeSubmit+")"):$.noop).on("success",success&&success.length>0?eval("(0,"+success+")"):$.noop).on("error",error&&error.length>0?eval("(0,"+error+")"):$.noop),$.data($el[0],"upload",data))})},Upload}),define("km/util",function(){var t={},e=function(){};return t.createProto=Object.__proto__?function(t){return{__proto__:t}}:function(t){return e.prototype=t,new e},t.isIE8=function(){var t,e=8,i=navigator.userAgent.toLowerCase(),o=i.indexOf("msie")>-1;return!!o&&(t=parseInt(i.match(/msie ([\d.]+)/)[1]),t<=e&&i.indexOf("trident/7.0")==-1)},t.insertText=function(t,e){if(document.selection){var i=document.selection.createRange();i.text=e}else if("number"==typeof t.selectionStart&&"number"==typeof t.selectionEnd){var o=t.selectionStart,s=t.selectionEnd,n=o,a=t.value;t.value=a.substring(0,o)+e+a.substring(s,a.length),n+=e.length,t.selectionStart=t.selectionEnd=n}else t.value+=e},t.moveTo=function(t,e){if(document.selection){var i=t.createTextRange();i.moveStart("character",e),i.collapse(),i.select()}else"number"==typeof t.selectionStart&&"number"==typeof t.selectionEnd&&(t.selectionStart=t.selectionEnd=e)},t}),define("km/validate",["jquery"],function($){function Validate(t,e){this.$form=t,this.options=$.extend(!0,{errorClass:"k-error",errorElement:"label",rules:{},messages:{},tipsPlacement:{},focusClear:!0,keyupClear:!0,errorPlacement:null,showSingleError:!1},e),this.rules=this.options.rules,this.messages=this.options.messages,this.tipsPlacement=this.options.tipsPlacement,this.init()}return Validate.prototype.init=function(){this.setValidFields(),0!==this.validFields.count&&(this.eventBind(),$.data(this.$form[0],"validate",this))},Validate.prototype.setValidFields=function(){this.validFields={data:{},count:0};var t=this;this.$form.find("input,select,textarea").filter(function(){return this.getAttribute("data-rules")&&t.metaRules(this),this.name in t.rules}).each(function(){if(!t.validFields.data[this.name]){var e=$(this);$.data(e[0],"$form",t.$form),t.validFields.data[this.name]=e,t.validFields.count++}})},Validate.prototype.metaRules=function(element){var meta=element.getAttribute("data-rules");meta=eval("(0,"+meta+")"),this.rules[element.name]?($.extend(meta.rules,this.rules[element.name],!0),this.rules[element.name]=meta.rules):this.rules[element.name]=meta.rules,this.messages[element.name]?($.extend(meta.messages,this.messages[element.name],!0),this.messages[element.name]=meta.messages):this.messages[element.name]=meta.messages,this.tipsPlacement[element.name]||(this.tipsPlacement[element.name]=meta.tipsPlacement||{position:"right",target:element})},Validate.prototype.eventBind=function(){var t=this;this.$form.on("submit.validate",function(e){return t.validateFrom(e)}).on("focus.validate blur.validate keyup.validate",':text, [type="password"], [type="file"], select, textarea, [type="number"], [type="search"] ,[type="tel"], [type="url"], [type="email"], [type="datetime"], [type="date"], [type="month"], [type="week"], [type="time"], [type="datetime-local"], [type="range"], [type="color"]',function(e){t.validate(e)}).on("click.validate",'[type="radio"], [type="checkbox"], select, option',function(e){t.validate(e)})},Validate.prototype.validate=function(t){var e,i,o=t.target,s=$(o),n=this.rules[o.name];if(n){if(this.options.focusClear&&("focusin"===t.type||"click"==t.type)||this.options.keyupClear&&"keyup"===t.type)return void this.hideError(s);i=this.elementValue(s);for(var a in n){var r={method:a,parameters:n[a]};if(e=this.methods[a].call(this,i,s,r.parameters),!e)return this.formatAndAdd(o,r),!1;this.hideError(s)}return!0}},Validate.prototype.validateFrom=function(){var t,e=this,i=!0,o=[];for(var s in this.validFields.data)e.validate({target:this.validFields.data[s][0]})||(t||(t=$(this.validFields.data[s][0])),i=!1,o.push({$element:$(this.validFields.data[s][0])}));if(this.options.showSingleError&&o.length>1)for(var n=1;n<o.length;n++)$element=o[n].$element,this.hideError($element,!1);return t&&t.focus().blur(),i},Validate.prototype.valid=function(){return this.validateFrom()},Validate.prototype.checkable=function(t){return/radio|checkbox/i.test(t.type)},Validate.prototype.formatAndAdd=function(t,e){var i=$(t),o=this.defaultMessage(t,e.method);o=this.format(o,e.parameters),this.showError(i,o)},Validate.prototype.showError=function(t,e){this.checkable(t[0])&&(t=this.validFields.data[t[0].name]);var i=$.data(t[0],"error");i||(i=$("<"+this.options.errorElement+">").addClass(this.options.errorClass),$.data(t[0],"error",i)),i.html(e).show(),t.addClass(this.options.errorClass),$.isFunction(this.options.errorPlacement)?this.options.errorPlacement(t,i):i.insertAfter(t)},Validate.prototype.hideError=function(t,e){"undefined"==typeof e&&(e=!0),this.checkable(t[0])&&(t=this.validFields.data[t[0].name]);var i=$.data(t[0],"error");e&&t.removeClass(this.options.errorClass),$.isFunction(this.options.errorPlacement)&&this.options.errorPlacement(t,$([])),i&&i.hide()},Validate.prototype.hideAllError=function(){for(var t in this.validFields.data)this.hideError($(this.validFields.data[t][0]))},Validate.prototype.defaultMessage=function(t,e){return this.messages[t.name]||(this.messages[t.name]={},this.messages[t.name][e]=this.errorMessages[e]),this.messages[t.name][e]||(this.messages[t.name][e]=this.errorMessages[e]),this.messages[t.name][e]},Validate.prototype.format=function(t,e){return t.indexOf("{0}")!=-1&&(e.constructor!==Array&&(e=[e]),$.each(e,function(e,i){t=t.replace(new RegExp("\\{"+e+"\\}","g"),function(){return i})})),t},Validate.prototype.removeRule=function(t,e){this.rules[t.name]&&this.rules[t.name][e]&&delete this.rules[t.name][e],this.messages[t.name]&&this.messages[t.name][e]&&delete this.messages[t.name][e],this.hideError($(t))},Validate.prototype.setRules=function(t,e){this.rules[t.name]?$.extend(this.rules[t.name],e.rules,!0):this.rules[t.name]=e.rules,this.messages[t.name]?$.extend(this.messages[t.name],e.messages,!0):this.messages[t.name]=e.messages,this.validFields.data[t.name]=$(t)},Validate.prototype.addMethod=function(t,e,i){this.methods[t]=e,this.errorMessages[t]=void 0!==i?i:this.errorMessages[t]},Validate.prototype.errorMessages={required:"该字段不能为空",email:"电子邮箱格式错误",url:"url格式错误",date:"请输入一个有效日期",dateISO:"请输入一个有效日期（ISO）",mobile:"手机号码格式错误",phone:"电话号码格式错误",number:"请输入一个有效的数字",digits:"请输入正整数",minLength:"请输入一个长度不小于{0}个字符的值",maxLength:"请输入一个长度不大于{0}个字符的值",rangeLength:"请输入一个长度介于{0}到{1}个字符的值",min:"请输入一个大于或等于{0}的值",max:"请输入一个小于或等于{0}的值",range:"请输入一个介于{0}到{1}之间的数值",equalTo:"请再输入一个相同的值",remote:"远程验证失败",reg:"格式错误"},Validate.prototype.methods={required:function(t,e){if("select"===e[0].nodeName.toLowerCase()){var i=$.trim(e.val());return i&&i.length>0}return this.checkable(e[0])?this.getLength(t,e[0])>0:$.trim(t).length>0},email:function(t,e){return this.optional(e)||/^(?:[a-z0-9]+[_\-+.]+)*[a-z0-9]+@(?:([a-z0-9]+-?)*[a-z0-9]+.)+([a-z]{2,})+$/i.test(t)},url:function(t,e){return this.optional(e)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t)},date:function(t,e){return this.optional(e)||!/Invalid|NaN/.test(new Date(t).toString())},dateISO:function(t,e){return this.optional(e)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}|\d{4}[\/-]\d{1,2}[\/-]\d{1,2}\s\d{1,2}[:]\d{1,2}[:]\d{1,2}\w$/.test(t)},mobile:function(t,e){return this.optional(e)||/^1\d{10}$/.test(t)},phone:function(t,e){return this.optional(e)||/^((0\d{2,3}\-)[1-9]\d{7}(\-\d{1,4})?)$/.test(t)},number:function(t,e){return this.optional(e)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},digits:function(t,e){return this.optional(e)||/^\d+$/.test(t)},minLength:function(t,e,i){var o=$.isArray(t)?t.length:this.getLength($.trim(t),e[0]);return this.optional(e)||o>=i},maxLength:function(t,e,i){var o=$.isArray(t)?t.length:this.getLength($.trim(t),e[0]);return this.optional(e)||o<=i},rangeLength:function(t,e,i){var o=$.isArray(t)?t.length:this.getLength($.trim(t),e[0]);return this.optional(e)||o>=i[0]&&o<=i[1]},min:function(t,e,i){return this.optional(e)||t>=i},max:function(t,e,i){return this.optional(e)||t<=i},range:function(t,e,i){return this.optional(e)||t>=i[0]&&t<=i[1]},equalTo:function(t,e,i){var e=$(i);return t===this.elementValue(e)},remote:function(t,e,i){var o,s={},n=this,a=this.previousValue(e[0]);return a.old===t?a.valid:(a.old=t,"string"==typeof i?o=i:(o=i.url,s=i.data),s[e[0].name]=t,s.rnd=Math.random(),$.post(o,s).success(function(t){var i=t===!0||"true"===String(t).toLowerCase();i?n.hideError(e):n.showError(e,a.message),a.valid=i}).error(function(){return!1}),!0)},reg:function(t,e,i){var o=new RegExp(i,"igm");return this.optional(e)||o.test(t)}},Validate.prototype.previousValue=function(t){return $.data(t,"previousValue")||$.data(t,"previousValue",{old:null,valid:!0,message:this.defaultMessage(t,"remote")})},Validate.prototype.optional=function(t){var e=this.elementValue(t);return!this.methods.required.call(this,e,t)},Validate.prototype.elementValue=function(t){var e=t.attr("type"),i=t.val();return"radio"===e||"checkbox"===e?$("input[name='"+t.attr("name")+"']:checked").val():"string"==typeof i?i.replace(/\r/g,""):i},Validate.prototype.getLength=function(t,e){switch(e.nodeName.toLowerCase()){case"select":return $("option:selected",e).length;case"input":if(this.checkable(e))return this.$form.find("[name='"+e.name+"']").filter(":checked").length}return t.length},Validate.prototype.getData=function(){var t={},e=this;return e.$form.find("input[name], textarea[name]").each(function(){var e=$(this);if(e.is("[type=checkbox]")===!1&&e.is("[type=radio]")===!1)t[e.attr("name")]=$.trim(e.val());else if(e.is("[type=radio]:checked"))t[e.attr("name")]=$.trim(e.val());else if(e.is("[type=checkbox]:checked")){var i=e.attr("name");t[i]||(t[i]=[]),t[i].push(e.val())}}),t},Validate}),define("km/validateTooltips",["jquery","km/validate","km/tooltips","km/util"],function(t,e,i,o){var s=function(t,i){e.call(this,t,i)};return s.prototype=o.createProto(e.prototype),s.prototype.getTipsPlacement=function(t){var e=t.name,i="right";return this.tipsPlacement||(this.tipsPlacement=this.options.tipsPlacement||{}),this.tipsPlacement[e]?i=this.tipsPlacement[e]:this.tipsPlacement[e]={position:"right",target:t},i},s.prototype.showError=function(e,o){var s;this.checkable(e[0])&&(e=this.validFields.data[e[0].name]);var n=this.getTipsPlacement(e[0]);n.target?(s=t(n.target),t.data(e[0],"$target",s)):s=e;var a=i.Get(s);if(a?a.setContent(o):(a=new i(s,{content:o,tipClass:"danger",trigger:"manual",placement:n.position,container:this.options.container||document.body,scrollContainer:this.options.scrollContainer}),i.Set(s,a)),n.checkParents){var r=s.parents(n.checkParents+":eq(0)");r.length>0&&"none"!=r[0].style.display&&(a.show(),s.addClass(this.options.errorClass))}else a.show(),s.addClass(this.options.errorClass)},s.prototype.hideError=function(e,o){"undefined"==typeof o&&(o=!0),this.checkable(e[0])&&(e=this.validFields.data[e[0].name]);var s=t.data(e[0],"$target");s&&(e=s);var n=i.Get(e);n&&n.hide(),o&&e.removeClass(this.options.errorClass)},s}),define("km/waterfall",["jquery","km/infiniteScroll","km/popTips"],function(t,e,i){var o=1,s=function(e,i){this.identity=o++,this.$element=e,this.options=t.extend(!0,{$scrollElement:t(window),scrollDistance:0,width:200,left:10,margin:20,nodeTag:"li",resize:!0,url:null,loaded:t.noop,mobilePhone:!1,pageSize:20},i),this.$panel=this.options.$scrollElement,this.$document=t(document),this.loading=!1,this.noMore=!1,this.page=1,this.init()};return s.prototype.init=function(){var t=this;this.options.mobilePhone&&(this.options.width=(this.$panel.width()-this.options.margin)/2),this.arrangementInit(),this.infiniteScroll=new e({$watchElement:this.$element,$scrollElement:this.options.$scrollElement,scrollDistance:this.options.scrollDistance,callback:function(){return t.options.url?void t.remote():void(t.options.data&&t.options.data.length>0&&t.options.loaded.call(t,t.$element,t.options.data))}}),this.options.resize&&this.$panel.on("resize.waterfall."+this.identity,function(){t.arrangementInit()})},s.prototype.arrangementInit=function(){this.arrHeight=[],this.nodes=this.$element.children(this.options.nodeTag);var t=this.$panel.width();if(0!==this.nodes.length){this.options.mobilePhone&&(this.options.width=(t-this.options.margin)/2);var e=parseInt(t/this.options.width),i=e*this.options.width+(e-1)*this.options.left;if(i>t&&(e-=1,i=e*this.options.width+(e-1)*this.options.left),!(i<this.options.width)){this.$element.width(i),this.options.mobilePhone&&this.nodes.width(this.options.width);for(var o,s,n=0;n<this.nodes.length;n++)s=this.nodes.eq(n),o=s.outerHeight(),n<e?(this.arrHeight[n]=o,s.css({top:0,left:n*(this.options.width+this.options.left)})):this.set(s,o);this.adpHeight()}}},s.prototype.arrangement=function(e){var i=this;return 0===this.arrHeight.length?void this.arrangementInit():void(e&&0!==e.length&&(e.each(function(){var e=t(this),o=e.outerHeight();i.set(e,o)}),this.adpHeight()))},s.prototype.set=function(t,e){var i=this.getMinHeight(),o=this.getMinHeightIndex(i);o=o==-1?0:o,this.arrHeight[o]+=e+this.options.left,t.css({top:i+this.options.left,left:o*(this.options.width+this.options.left)})},s.prototype.getMinHeightIndex=function(t){if(Array.indexOf){var e=this.arrHeight.indexOf(t);return e}for(var i=0;i<this.arrHeight.length;i++)if(this.arrHeight[i]===t)return i;return-1},s.prototype.remote=function(){if(!this.noMore&&!this.loading){var e=this;this.loading=!0,t.get(this.options.url,{rnd:Math.random(),page:this.page++,pageSize:this.options.pageSize}).done(function(t){return t&&0!==t.length?(e.options.loaded.call(e,e.$element,t),void(e.loading=!1)):(e.noMore=!0,!1)}).fail(function(){i.error("网络错误！"),e.loading=!1})}},s.prototype.destory=function(){this.infiniteScroll.destory()},s.prototype.imgLoad=function(t,e,i){var o=new Image,s=this;o.onload=function(){t.attr("src",e),i(s.zoom(o.width,o.height))},o.onerror=function(){i({width:s.options.width,height:300})},o.src=e},s.prototype.zoom=function(t,e){var i;return t>e||t==e?(i=t/e,e=this.options.width/i):(i=e/t,e=this.options.width*i),{width:this.options.width,height:e}},s.prototype.getMinHeight=function(){return Math.min.apply(null,this.arrHeight)},s.prototype.getMaxHeight=function(){return Math.max.apply(null,this.arrHeight)},s.prototype.adpHeight=function(){this.$element.height(this.getMaxHeight())},s}),define("km/window",["jquery","km/dragdrop","km/popTips","km/loading","km/util"],function($,DragDrop,popTips,Loading,util){var Window=function(t){this.options=$.extend(!0,{id:null,url:null,params:null,title:"弹出框",content:null,width:"600",height:null,backdrop:!0,backdropClose:!1,iframe:!1,appendTo:document.body,showFooter:!0,zIndex:null,borderRadius:"6px",space:50,fontClass:".fa,.glyphicon,.e-icon",fontRedrawDelay:500,btns:[],canDestory:!0},t),0==this.options.btns.length&&(this.options.btns=[{text:"确定",className:"k-btn-primary",action:"ok"},{text:"取消",className:"k-btn-default",action:"close"}]),this._event={open:$.noop,ok:$.noop,beforeClose:$.noop,close:$.noop,afterClose:$.noop},this.identity=this.options.id||ids.get(),this.isClose=!0,this.loading=!1,this.template='<div class="k-window" id="k-window-'+this.identity+'"><h4 class="k-window-header"><span class="k-window-title"></span><span class="k-window-close" role="kwin_close">×</span></h4><div class="k-window-container"></div><div class="k-window-footer"></div></div>',this.backdrop='<div class="k-window-backdrop"></div>',this.$document=$(document),this.$window=$(window),this.init()};Window.prototype.init=function(){this.build(),this.setTitle(this.options.title),this.options.iframe?(this.$container.css({padding:0,overflowY:"hidden"}).append('<iframe frameborder="0" width="100%" src="about:blank" scrolling="auto"></iframe>'),this.$iframe=this.$container.find("iframe")):this.setContent(this.options.content),this.eventBind()},Window.prototype.eventBind=function(){var t=this;if(this.$window.on("resize.window."+this.identity,function(){t.tm&&clearTimeout(t.tm),t.tm=setTimeout(function(){t.layout()},300)}),this.$backdrop.on("click.window",function(){t.options.backdropClose&&t.close()}),this.$win.on("click.window","[role=kwin_close],[role=kwin_cancel]",function(){t._event.close.call(t)!==!1&&t.close()}).on("click.window","[role=kwin_ok]",function(){t._event.ok.call(t)!==!1&&t.close()}),this.options.btns&&this.options.btns.length>0)for(var e,i,o=0;o<this.options.btns.length;o++)e=this.options.btns[o],i=e.action.toLowerCase(),"ok"!=i&&"cancel"!=i&&"close"!=i&&!function(t,e,i){i.$win.off("click.window","[role=kwin_"+e+"]").on("click.window","[role=kwin_"+e+"]",function(){t.func&&t.func.call(i,i.$iframe)!==!1&&i.close()})}(e,i,this)},Window.prototype.on=function(t,e){return this._event[t]=e||$.noop,this},Window.prototype.setTitle=function(t){this.$header.find(".k-window-title").text(t)},Window.prototype.setContent=function(t){t=t||this.options.content,this.$container.html(t)},Window.prototype.setSize=function(t){this.options.width=t.width,this.options.height=t.height,this.$win.css(t)},Window.prototype.remote=function(){if("string"==typeof this.options.url&&null==this.options.content&&!this.options.iframe){var t=this,e=$.Deferred();return this.loading=!0,this.$container.load(this.options.url+"?rnd="+Math.random(),this.options.params,function(){t.loading=!1,e.resolve()}),e.promise()}},Window.prototype.open=function(){var t=this,e=$(".k-window");e.each(function(){var e=($(this),$.data(this,"window"));e&&e.identity!=t.identity&&e.isClose&&e.options.canDestory&&(e.destory(),e=null)}),this.show(),this.$footer.hide(),this.loadingShow(),$.when(this.remote()).done(function(){if(t.options.iframe){t.$iframe.attr("src","about:blank");var e=t.options.url;e+=e.indexOf("?")!=-1?"&rand="+Math.random():"?rand="+Math.random(),e+="&popWinId="+(t.options.id?t.options.id:t.identity),setTimeout(function(){t.$iframe.attr("src",e).show(),t.bindIframeLoad||t.$iframe.on("load",function(){var e=t.$iframe.attr("src");"about:blank"!=e&&(t.iframeTm&&clearTimeout(t.iframeTm),t.bindIframeLoad=!0,t.options.showFooter&&t.$footer.show(),t.loadingHide())})},100)}else t.options.showFooter&&t.$footer.show(),t.loadingHide()}).fail(function(){t.loadingHide()}).always(function(){})},Window.prototype.close=function(){var t=this;this.isClose=!0,this.$win.css({left:"-900px",top:"-900px"}),this.$backdrop.hide(),zIndex.pop(),this._event.afterClose.call(t),this.loadingHide(),util.isIE8()&&t.iconReset()},Window.prototype.iconReset=function(){var t=this,e=$(this.options.fontClass);e.addClass("k-content-empty"),setTimeout(function(){e.removeClass("k-content-empty")},t.options.fontRedrawDelay)},Window.prototype.destory=function(){this.isDestory||(this.$iframe&&this.$iframe.length>0&&(this.$iframe.remove(),this.$iframe=null),this.$backdrop.off("click.window").remove(),this.$win.off().remove(),this.$window.off("resize.window."+this.identity),this.$backdrop=null,this.$win=null,this.$window=null,this.$document=null,this.isDestory=!0)},Window.prototype.show=function(){this.isClose=!1,this.$win.show(),this.options.backdrop&&this.$backdrop.show(),this._event.open(this.$win);var t=zIndex.get();null!=this.options.zIndex&&(t=this.options.zIndex),this.$win.css("zIndex",t),this.$backdrop.css("zIndex",--t),this.layout()},Window.prototype.layout=function(){if(!this.isClose){var t,e,i=this.$window.height(),o=i-this.options.space,s=this.$header.height(),n=this.options.showFooter?this.$footer.height():4,a=o-s-n;this.options.height?o<this.options.height?(t=o,e=a):(t=this.options.height,e=t-s-n):(this.orgHeight=this.orgHeight||this.$win.height(),o<this.orgHeight?(t=o,e=a):(t=this.orgHeight,e=this.orgHeight-s-n)),this.$container.css("height",e),this.options.iframe&&this.$container.find("iframe").height(e),this.$win.css({left:"50%",top:"50%",height:t,marginLeft:-this.options.width/2,marginTop:-t/2})}},Window.prototype.build=function(){if(this.$win=$(this.template).css({width:this.options.width,height:this.options.height,borderRadius:this.options.borderRadius}),$.data(this.$win[0],"window",this),this.$backdrop=$(this.backdrop),this.$header=this.$win.find(".k-window-header"),this.$container=this.$win.find(".k-window-container"),this.$footer=this.$win.find(".k-window-footer"),this.$btnBox=this.$footer.find(".k-btn-box"),this.$appendBtnBox=this.$footer.find(".append-btn-box"),this.$insertBtnBox=this.$footer.find(".insert-btn-box"),this.$win.appendTo(this.options.appendTo),this.$backdrop.appendTo(this.options.appendTo),this.options.showFooter||this.$footer.hide(),this.options.btns&&this.options.btns.length>0){this.$footer.find(".k-btn-inner").hide();var t=this.getBtnHtml(this.options.btns);this.$footer.append(t)}},Window.prototype.setBtns=function(t){if(this.$footer.find(".k-btn-inner").show().end().find(".k-btn-custom").remove(),t&&0!=t.length){this.$footer.find(".k-btn-inner").hide().end().append(this.getBtnHtml(t,!0));for(var e,i,o=0;o<t.length;o++)e=t[o],i=e.action.toLowerCase(),"ok"!=i&&"close"!=i&&"cancel"!=i&&!function(t,e,i){i.$win.off("click.window","[role=kwin_"+e+"]").on("click.window","[role=kwin_"+e+"]",function(){t.func&&t.func.call(i,i.$iframe)!==!1&&i.close()})}(e,i,this)}},Window.prototype.getBtnHtml=function(t,e){for(var i,o,s,n,a=[],r=0;r<t.length;r++)i=t[r],o=i.action.toLowerCase(),s=i.className,n="k-btn-custom","ok"==o&&(n=e?n:"k-btn-inner",s||(s="k-btn-primary")),"close"!=o&&"cancel"!=o||(n=e?n:"k-btn-inner",s||(s="k-btn-default")),a.push('<button type="button" class="k-btn '+(s||"k-btn-primary")+" "+n+' " role="kwin_'+("cancel"==o?"close":o)+'">'+i.text+"</button>");return a.join("")},Window.prototype.loadingShow=function(){this.$container.addClass("k-window-loading")},Window.prototype.loadingHide=function(){this.$container.removeClass("k-window-loading")},Window.alert=function(t,e,i){$.isFunction(e)&&(i=e,e=t,t="提示");var o=window.winAlert;o||(o=new Window({width:400,backdropClose:!1,zIndex:9999,canDestory:!1}),o.$win.find(".window-cancel").hide(),window.winAlert=o),o.$win.find("button[role=kwin_close]").hide(),o.setTitle(t),o.setContent(e),o.on("ok",i||$.noop),o.open()},Window.confirm=function(t,e,i,o,s){$.isFunction(e)&&(o=i,i=e,e=t,t="确认提示");var n=window.winConfirm;n||(n=new Window({width:400,backdropClose:!1,zIndex:9999,canDestory:!1}),window.winConfirm=n),n.setTitle(t),n.setBtns(s),n.setContent(e),n.on("ok",i||$.noop),n.on("close",o||$.noop),n.open()},Window.close=function(t){if($win=$("#k-window-"+t),0!=$win.length){var e=$.data($win[0],"window");e&&e.close()}},Window.get=function(t){if($win=$("#k-window-"+t),0==$win.length)return null;var e=$.data($win[0],"window");return e?e:null},Window.open=function(t){var e=new Window(t);return e.open(),e},Window.Global=function($elms){$elms=$elms||$("[data-module=window]"),$elms.each(function(){var $elm=$(this),options=$elm.attr("data-options"),url=$elm.attr("data-url"),width=$elm.attr("data-width"),height=$elm.attr("data-height"),iframe=$elm.attr("data-iframe"),title=$elm.attr("data-title")||"模态窗口",content=$elm.attr("data-content"),showFooter=$elm.attr("data-showFooter"),buttons=$elm.attr("data-btns"),onOk=$elm.attr("data-onOk"),onClose=$elm.attr("data-onClose"),onAfterClose=$elm.attr("data-onAfterClose"),data=$.data($elm[0],"window");data||(onOk=onOk&&onOk.length>0?eval("(0,"+onOk+")"):$.noop,onClose=onClose&&onClose.length>0?eval("(0,"+onClose+")"):$.noop,onAfterClose=onAfterClose&&onAfterClose.length>0?eval("(0,"+onAfterClose+")"):$.noop,options=options&&options.length>0?eval("(0,"+options+")"):{url:url,title:title,content:content,width:width&&width.length>0?parseInt(width):680,height:height&&height.length>0?parseInt(height):480,showFooter:!showFooter||"false"!=showFooter,iframe:!iframe||"false"!=iframe,btns:buttons&&buttons.length>0?eval("(0,"+buttons+")"):[]},data=new Window(options),data.on("ok",function(){return onOk.call(this)}).on("close",function(){return onClose.call(this)}).on("afterClose",function(){return onAfterClose.call(this)}),$elm.parent(".k-input-group").off("click.window","button").on("click.window","button",function(){data.open()}),$elm.on("click.window",function(){data.open()}),$.data($elm[0],"window",data))})};var zIndex=function(){var t=[];return{get:function(){var e;return 0===t.length?(e=1e3,t.push(e)):(e=t[t.length-1],e+=2,t.push(e)),e},pop:function(){0!==t.length&&t.pop()}}}(),ids=function(){var t=[];return{get:function(){var e;return 0==t.length?(e=1,t.push(e)):(e=t[t.length-1],e+=1,t.push(e)),e}}}();return Window}),define("km/wordLimit",["jquery"],function($){var WordLimit=function(t,e){this.$element=t,this.options=$.extend(!0,{maxLength:140,feedback:".chars"},e),this.init()};return WordLimit.prototype.init=function(){var t=this;this.maxLength=parseInt(this.$element.attr("maxLength")||this.options.maxLength),this.$feedback=$(this.options.feedback),this.$element.on("keyup.wordlimit",function(){var e=$.trim($(this).val());t.update(e)}),this.update($.trim(this.$element.val()))},WordLimit.prototype.update=function(t){var e=t.length,i=this.maxLength,o=i-e;e>=i&&this.$element.val(t.substring(0,i)),this.$feedback.html(o<0?0:o)},WordLimit.prototype.reset=function(){this.$element.val(""),this.$feedback.html(this.options.maxLength)},WordLimit.Global=function($elements){$elements=$elements||$("input,textarea").filter('[data-module="wordlimit"]'),$elements.each(function(){var $this=$(this),options=$this.attr("data-options"),maxLength=$this.attr("maxLength"),wordLimit=WordLimit.Get($this);options=options&&options.length>0?eval("(0,"+options+")"):{maxLength:maxLength,feedback:$this.attr("data-feedback")},wordLimit||(wordLimit=new WordLimit($this,options),WordLimit.Set($this,wordLimit))})},WordLimit.Get=function(t){return $.data(t[0],"wordLimit")},WordLimit.Set=function(t,e){$.data(t[0],"wordLimit",e)},WordLimit.Reset=function(t){t=t||$("input,textarea").filter('[data-module="wordlimit"]'),t.each(function(){var t=WordLimit.Get($(this));t&&t.reset()})},WordLimit}),define("KM",["km/ajax","km/app","km/areaSelector","km/autoComplete","km/cache","km/clipZoom","km/contextMenu","km/datePicker","km/dragdrop","km/dropDownList","km/dropDownTree","km/event","km/focusMap","km/highlight","km/imgPreview","km/infiniteScroll","km/lang","km/layout","km/lazyload","km/loading","km/magnifier","km/mask","km/pager","km/panel","km/placeholder","km/popover","km/popTips","km/portlets","km/rating","km/resizable","km/router","km/scrollImg","km/slider","km/switch","km/tab","km/tagSelector","km/template","km/tooltips","km/tree","km/treeTable","km/upload","km/util","km/validate","km/validateTooltips","km/waterfall","km/window","km/wordLimit"],function(t,e,i,o,s,n,a,r,h,l,p,d,c,u,f,m,g,$,v,w,y,b,k,x,C,T,I,S,D,P,L,z,_,E,N,H,M,W,F,B,R,j,A,O,U,q,V){var Y={ajax:t,App:e,areaSelector:i,autoComplete:o,cache:s,ClipZoom:n,ContextMenu:a,DatePicker:r,Dragdrop:h,DropDownList:l,DropDownTree:p,event:d,focusMap:c,highlight:u,imgPreview:f,InfiniteScroll:m,Lang:g,Layout:$,lazyload:v,Loading:w,magnifier:y,Mask:b,Pager:k,Panel:x,placeholder:C,Popover:T,popTips:I,portlets:S,Rating:D,Resizable:P,
Router:L,scrollImg:z,slider:_,Switch:E,Tab:N,tagSelector:H,Template:M,Tooltips:W,Tree:F,TreeTable:B,Upload:R,Util:j,Validate:A,ValidateTooltips:O,Waterfall:U,Window:q,WordLimit:V};return window.KM=Y});